"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["985119"],{597685:function(e,t,n){n.r(t),n.d(t,{metadata:()=>a,contentTitle:()=>s,default:()=>p,assets:()=>o,toc:()=>d,frontMatter:()=>l});var a=JSON.parse('{"id":"data-operate/import/import-scenes/local-file-load","title":"\u5BFC\u5165\u672C\u5730\u6570\u636E","description":"\x3c!--","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-1.2/data-operate/import/import-scenes/local-file-load.md","sourceDirName":"data-operate/import/import-scenes","slug":"/data-operate/import/import-scenes/local-file-load","permalink":"/zh-CN/docs/1.2/data-operate/import/import-scenes/local-file-load","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"\u5BFC\u5165\u672C\u5730\u6570\u636E","language":"zh-CN"},"sidebar":"docs","previous":{"title":"\u5BFC\u5165\u603B\u89C8","permalink":"/zh-CN/docs/1.2/data-operate/import/load-manual"},"next":{"title":"\u5916\u90E8\u5B58\u50A8\u6570\u636E\u5BFC\u5165","permalink":"/zh-CN/docs/1.2/data-operate/import/import-scenes/external-storage-load"}}'),r=n("785893"),i=n("250065");let l={title:"\u5BFC\u5165\u672C\u5730\u6570\u636E",language:"zh-CN"},s="\u5BFC\u5165\u672C\u5730\u6570\u636E",o={},d=[{value:"\u4F7F\u7528 Stream Load \u5BFC\u5165\u672C\u5730\u6570\u636E",id:"\u4F7F\u7528-stream-load-\u5BFC\u5165\u672C\u5730\u6570\u636E",level:2},{value:"\u5BFC\u5165\u6570\u636E",id:"\u5BFC\u5165\u6570\u636E",level:3},{value:"\u5BFC\u5165\u5EFA\u8BAE",id:"\u5BFC\u5165\u5EFA\u8BAE",level:3},{value:"Java \u4EE3\u7801\u793A\u4F8B",id:"java-\u4EE3\u7801\u793A\u4F8B",level:3}];function c(e){let t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"\u5BFC\u5165\u672C\u5730\u6570\u636E",children:"\u5BFC\u5165\u672C\u5730\u6570\u636E"})}),"\n",(0,r.jsx)(t.p,{children:"\u672C\u6587\u6863\u4E3B\u8981\u4ECB\u7ECD\u5982\u4F55\u4ECE\u5BA2\u6237\u7AEF\u5BFC\u5165\u672C\u5730\u7684\u6570\u636E\u3002"}),"\n",(0,r.jsxs)(t.p,{children:["\u76EE\u524D Doris \u652F\u6301\u4ECE\u672C\u5730\u5BFC\u5165\u6570\u636E\u7684\u6A21\u5F0F\u4E3A ",(0,r.jsx)(t.a,{href:"/zh-CN/docs/1.2/data-operate/import/import-way/stream-load-manual",children:"Stream Load"}),"\u3002\u4E0B\u6587\u4ECB\u7ECD\u4E86\u4F7F\u7528 Stream Load \u5BFC\u5165\u672C\u5730\u6570\u636E\u7684\u65B9\u6CD5\u3002"]}),"\n",(0,r.jsx)(t.h2,{id:"\u4F7F\u7528-stream-load-\u5BFC\u5165\u672C\u5730\u6570\u636E",children:"\u4F7F\u7528 Stream Load \u5BFC\u5165\u672C\u5730\u6570\u636E"}),"\n",(0,r.jsx)(t.p,{children:"Stream Load \u7528\u4E8E\u5C06\u672C\u5730\u6587\u4EF6\u5BFC\u5165\u5230 Doris \u4E2D\u3002"}),"\n",(0,r.jsx)(t.p,{children:"\u4E0D\u540C\u4E8E\u5176\u4ED6\u547D\u4EE4\u7684\u63D0\u4EA4\u65B9\u5F0F\uFF0CStream Load \u662F\u901A\u8FC7 HTTP \u534F\u8BAE\u4E0E Doris \u8FDB\u884C\u8FDE\u63A5\u4EA4\u4E92\u7684\u3002"}),"\n",(0,r.jsx)(t.p,{children:"\u8BE5\u65B9\u5F0F\u4E2D\u6D89\u53CA HOST:PORT \u5E94\u4E3A HTTP \u534F\u8BAE\u7AEF\u53E3\u3002"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"BE \u7684 HTTP \u534F\u8BAE\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 8040\u3002"}),"\n",(0,r.jsx)(t.li,{children:"FE \u7684 HTTP \u534F\u8BAE\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 8030\u3002\u4F46\u987B\u4FDD\u8BC1\u5BA2\u6237\u7AEF\u6240\u5728\u673A\u5668\u7F51\u7EDC\u80FD\u591F\u8054\u901A BE \u6240\u5728\u673A\u5668\u3002"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["\u672C\u6587\u6587\u6863\u6211\u4EEC\u4EE5 ",(0,r.jsx)(t.a,{href:"https://curl.se/docs/manpage.html",children:"curl"})," \u547D\u4EE4\u4E3A\u4F8B\u6F14\u793A\u5982\u4F55\u8FDB\u884C\u6570\u636E\u5BFC\u5165\u3002"]}),"\n",(0,r.jsx)(t.p,{children:"\u6587\u6863\u6700\u540E\uFF0C\u6211\u4EEC\u7ED9\u51FA\u4E00\u4E2A\u4F7F\u7528 Java \u5BFC\u5165\u6570\u636E\u7684\u4EE3\u7801\u793A\u4F8B\u3002"}),"\n",(0,r.jsx)(t.h3,{id:"\u5BFC\u5165\u6570\u636E",children:"\u5BFC\u5165\u6570\u636E"}),"\n",(0,r.jsx)(t.p,{children:"Stream Load \u7684\u8BF7\u6C42\u4F53\u5982\u4E0B\uFF1A"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"PUT /api/{db}/{table}/_stream_load\n"})}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"\u521B\u5EFA\u4E00\u5F20\u8868"}),"\n",(0,r.jsxs)(t.p,{children:["\u901A\u8FC7 ",(0,r.jsx)(t.code,{children:"CREATE TABLE"})," \u547D\u4EE4\u5728",(0,r.jsx)(t.code,{children:"demo"}),"\u521B\u5EFA\u4E00\u5F20\u8868\u7528\u4E8E\u5B58\u50A8\u5F85\u5BFC\u5165\u7684\u6570\u636E\u3002\u5177\u4F53\u7684\u5BFC\u5165\u65B9\u5F0F\u8BF7\u67E5\u9605 ",(0,r.jsx)(t.a,{href:"/zh-CN/docs/1.2/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-TABLE",children:"CREATE TABLE"})," \u547D\u4EE4\u624B\u518C\u3002\u793A\u4F8B\u5982\u4E0B\uFF1A"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sql",children:"CREATE TABLE IF NOT EXISTS load_local_file_test\n(\n    id INT,\n    age TINYINT,\n    name VARCHAR(50)\n)\nunique key(id)\nDISTRIBUTED BY HASH(id) BUCKETS 3;\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"\u5BFC\u5165\u6570\u636E"}),"\n",(0,r.jsx)(t.p,{children:"\u6267\u884C\u4EE5\u4E0B curl \u547D\u4EE4\u5BFC\u5165\u672C\u5730\u6587\u4EF6\uFF1A"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:' curl -u user:passwd -H "label:load_local_file_test" -T /path/to/local/demo.txt http://host:port/api/demo/load_local_file_test/_stream_load\n'})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"user:passwd \u4E3A\u5728 Doris \u4E2D\u521B\u5EFA\u7684\u7528\u6237\u3002\u521D\u59CB\u7528\u6237\u4E3A admin / root\uFF0C\u5BC6\u7801\u521D\u59CB\u72B6\u6001\u4E0B\u4E3A\u7A7A\u3002"}),"\n",(0,r.jsx)(t.li,{children:"host:port \u4E3A BE \u7684 HTTP \u534F\u8BAE\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u662F 8040\uFF0C\u53EF\u4EE5\u5728 Doris \u96C6\u7FA4 WEB UI \u9875\u9762\u67E5\u770B\u3002"}),"\n",(0,r.jsx)(t.li,{children:"label: \u53EF\u4EE5\u5728 Header \u4E2D\u6307\u5B9A Label \u552F\u4E00\u6807\u8BC6\u8FD9\u4E2A\u5BFC\u5165\u4EFB\u52A1\u3002"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["\u5173\u4E8E Stream Load \u547D\u4EE4\u7684\u66F4\u591A\u9AD8\u7EA7\u64CD\u4F5C\uFF0C\u8BF7\u53C2\u9605 ",(0,r.jsx)(t.a,{href:"/zh-CN/docs/1.2/sql-manual/sql-reference/Data-Manipulation-Statements/Load/STREAM-LOAD",children:"Stream Load"})," \u547D\u4EE4\u6587\u6863\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"\u7B49\u5F85\u5BFC\u5165\u7ED3\u679C"}),"\n",(0,r.jsx)(t.p,{children:"Stream Load \u547D\u4EE4\u662F\u540C\u6B65\u547D\u4EE4\uFF0C\u8FD4\u56DE\u6210\u529F\u5373\u8868\u793A\u5BFC\u5165\u6210\u529F\u3002\u5982\u679C\u5BFC\u5165\u6570\u636E\u8F83\u5927\uFF0C\u53EF\u80FD\u9700\u8981\u8F83\u957F\u7684\u7B49\u5F85\u65F6\u95F4\u3002\u793A\u4F8B\u5982\u4E0B\uFF1A"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\n    "TxnId": 1003,\n    "Label": "load_local_file_test",\n    "Status": "Success",\n    "Message": "OK",\n    "NumberTotalRows": 1000000,\n    "NumberLoadedRows": 1000000,\n    "NumberFilteredRows": 1,\n    "NumberUnselectedRows": 0,\n    "LoadBytes": 40888898,\n    "LoadTimeMs": 2144,\n    "BeginTxnTimeMs": 1,\n    "StreamLoadPutTimeMs": 2,\n    "ReadDataTimeMs": 325,\n    "WriteDataTimeMs": 1933,\n    "CommitAndPublishTimeMs": 106,\n    "ErrorURL": "http://192.168.1.1:8042/api/_load_error_log?file=__shard_0/error_log_insert_stmt_db18266d4d9b4ee5-abb00ddd64bdf005_db18266d4d9b4ee5_abb00ddd64bdf005"\n}\n'})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"Status"})," \u5B57\u6BB5\u72B6\u6001\u4E3A ",(0,r.jsx)(t.code,{children:"Success"})," \u5373\u8868\u793A\u5BFC\u5165\u6210\u529F\u3002"]}),"\n",(0,r.jsxs)(t.li,{children:["\u5176\u4ED6\u5B57\u6BB5\u7684\u8BE6\u7EC6\u4ECB\u7ECD\uFF0C\u8BF7\u53C2\u9605 ",(0,r.jsx)(t.a,{href:"/zh-CN/docs/1.2/sql-manual/sql-reference/Data-Manipulation-Statements/Load/STREAM-LOAD",children:"Stream Load"})," \u547D\u4EE4\u6587\u6863\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"\u5BFC\u5165\u5EFA\u8BAE",children:"\u5BFC\u5165\u5EFA\u8BAE"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Stream Load \u53EA\u80FD\u5BFC\u5165\u672C\u5730\u6587\u4EF6\u3002"}),"\n",(0,r.jsx)(t.li,{children:"\u5EFA\u8BAE\u4E00\u4E2A\u5BFC\u5165\u8BF7\u6C42\u7684\u6570\u636E\u91CF\u63A7\u5236\u5728 1 - 2 GB \u4EE5\u5185\u3002\u5982\u679C\u6709\u5927\u91CF\u672C\u5730\u6587\u4EF6\uFF0C\u53EF\u4EE5\u5206\u6279\u5E76\u53D1\u63D0\u4EA4\u3002"}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"java-\u4EE3\u7801\u793A\u4F8B",children:"Java \u4EE3\u7801\u793A\u4F8B"}),"\n",(0,r.jsx)(t.p,{children:"\u8FD9\u91CC\u901A\u8FC7\u4E00\u4E2A\u7B80\u5355\u7684 JAVA \u793A\u4F8B\u6765\u6267\u884C Stream Load\uFF1A"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'package demo.doris;\n\nimport org.apache.commons.codec.binary.Base64;\nimport org.apache.http.HttpHeaders;\nimport org.apache.http.client.methods.CloseableHttpResponse;\nimport org.apache.http.client.methods.HttpPut;\nimport org.apache.http.entity.FileEntity;\nimport org.apache.http.impl.client.CloseableHttpClient;\nimport org.apache.http.impl.client.DefaultRedirectStrategy;\nimport org.apache.http.impl.client.HttpClientBuilder;\nimport org.apache.http.impl.client.HttpClients;\nimport org.apache.http.util.EntityUtils;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\n\n/*\n\u8FD9\u662F\u4E00\u4E2A Doris Stream Load \u793A\u4F8B\uFF0C\u9700\u8981\u4F9D\u8D56\n<dependency>\n    <groupId>org.apache.httpcomponents</groupId>\n    <artifactId>httpclient</artifactId>\n    <version>4.5.13</version>\n</dependency>\n */\npublic class DorisStreamLoader {\n    //\u53EF\u4EE5\u9009\u62E9\u586B\u5199 FE \u5730\u5740\u4EE5\u53CA FE \u7684 http_port\uFF0C\u4F46\u987B\u4FDD\u8BC1\u5BA2\u6237\u7AEF\u548C BE \u8282\u70B9\u7684\u8FDE\u901A\u6027\u3002\n    private final static String HOST = "your_host";\n    private final static int PORT = 8040;\n    private final static String DATABASE = "db1";   // \u8981\u5BFC\u5165\u7684\u6570\u636E\u5E93\n    private final static String TABLE = "tbl1";     // \u8981\u5BFC\u5165\u7684\u8868\n    private final static String USER = "root";      // Doris \u7528\u6237\u540D\n    private final static String PASSWD = "";        // Doris \u5BC6\u7801\n    private final static String LOAD_FILE_NAME = "/path/to/1.txt"; // \u8981\u5BFC\u5165\u7684\u672C\u5730\u6587\u4EF6\u8DEF\u5F84\n\n    private final static String loadUrl = String.format("http://%s:%s/api/%s/%s/_stream_load",\n            HOST, PORT, DATABASE, TABLE);\n\n    private final static HttpClientBuilder httpClientBuilder = HttpClients\n            .custom()\n            .setRedirectStrategy(new DefaultRedirectStrategy() {\n                @Override\n                protected boolean isRedirectable(String method) {\n                    // \u5982\u679C\u8FDE\u63A5\u76EE\u6807\u662F FE\uFF0C\u5219\u9700\u8981\u5904\u7406 307 redirect\u3002\n                    return true;\n                }\n            });\n\n    public void load(File file) throws Exception {\n        try (CloseableHttpClient client = httpClientBuilder.build()) {\n            HttpPut put = new HttpPut(loadUrl);\n            put.setHeader(HttpHeaders.EXPECT, "100-continue");\n            put.setHeader(HttpHeaders.AUTHORIZATION, basicAuthHeader(USER, PASSWD));\n\n            // \u53EF\u4EE5\u5728 Header \u4E2D\u8BBE\u7F6E stream load \u76F8\u5173\u5C5E\u6027\uFF0C\u8FD9\u91CC\u6211\u4EEC\u8BBE\u7F6E label \u548C column_separator\u3002\n            put.setHeader("label","label1");\n            put.setHeader("column_separator",",");\n\n            // \u8BBE\u7F6E\u5BFC\u5165\u6587\u4EF6\u3002\n            // \u8FD9\u91CC\u4E5F\u53EF\u4EE5\u4F7F\u7528 StringEntity \u6765\u4F20\u8F93\u4EFB\u610F\u6570\u636E\u3002\n            FileEntity entity = new FileEntity(file);\n            put.setEntity(entity);\n\n            try (CloseableHttpResponse response = client.execute(put)) {\n                String loadResult = "";\n                if (response.getEntity() != null) {\n                    loadResult = EntityUtils.toString(response.getEntity());\n                }\n\n                final int statusCode = response.getStatusLine().getStatusCode();\n                if (statusCode != 200) {\n                    throw new IOException(\n                            String.format("Stream load failed. status: %s load result: %s", statusCode, loadResult));\n                }\n\n                System.out.println("Get load result: " + loadResult);\n            }\n        }\n    }\n\n    private String basicAuthHeader(String username, String password) {\n        final String tobeEncode = username + ":" + password;\n        byte[] encoded = Base64.encodeBase64(tobeEncode.getBytes(StandardCharsets.UTF_8));\n        return "Basic " + new String(encoded);\n    }\n\n    public static void main(String[] args) throws Exception{\n        DorisStreamLoader loader = new DorisStreamLoader();\n        File file = new File(LOAD_FILE_NAME);\n        loader.load(file);\n    }\n}\n'})}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"\u6CE8\u610F\uFF1A\u8FD9\u91CC http client \u7684\u7248\u672C\u8981\u662F 4.5.13"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-xml",children:"<dependency>\n   <groupId>org.apache.httpcomponents</groupId>\n   <artifactId>httpclient</artifactId>\n   <version>4.5.13</version>\n</dependency>\n"})}),"\n"]})]})}function p(e={}){let{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return s},a:function(){return l}});var a=n(667294);let r={},i=a.createContext(r);function l(e){let t=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);