"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["934303"],{895676:function(n,e,i){i.r(e),i.d(e,{metadata:()=>o,contentTitle:()=>c,default:()=>u,assets:()=>l,toc:()=>d,frontMatter:()=>r});var o=JSON.parse('{"id":"sql-manual/sql-functions/window-functions/window-function","title":"\u7A97\u53E3\u51FD\u6570","description":"\x3c!--  Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file to you under the Apache License, Version 2.0 (the \\"License\\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-3.0/sql-manual/sql-functions/window-functions/window-function.md","sourceDirName":"sql-manual/sql-functions/window-functions","slug":"/sql-manual/sql-functions/window-functions/window-function","permalink":"/zh-CN/docs/3.0/sql-manual/sql-functions/window-functions/window-function","draft":false,"unlisted":false,"tags":[],"version":"3.0","frontMatter":{"title":"\u7A97\u53E3\u51FD\u6570","language":"zh-CN"},"sidebar":"docs","previous":{"title":"TASKS","permalink":"/zh-CN/docs/3.0/sql-manual/sql-functions/table-valued-functions/tasks"},"next":{"title":"WINDOW_FUNCTION_SUM","permalink":"/zh-CN/docs/3.0/sql-manual/sql-functions/window-functions/window-function-sum"}}'),t=i("785893"),s=i("250065");let r={title:"\u7A97\u53E3\u51FD\u6570",language:"zh-CN"},c=void 0,l={},d=[{value:"WINDOW FUNCTION",id:"window-function",level:2},{value:"description",id:"description",level:3},{value:"Function",id:"function",level:4},{value:"PARTITION BY \u4ECE\u53E5",id:"partition-by-\u4ECE\u53E5",level:4},{value:"ORDER BY \u4ECE\u53E5",id:"order-by-\u4ECE\u53E5",level:4},{value:"Window \u4ECE\u53E5",id:"window-\u4ECE\u53E5",level:4},{value:"example",id:"example",level:3},{value:"keywords",id:"keywords",level:3}];function a(n){let e={code:"code",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,s.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h2,{id:"window-function",children:"WINDOW FUNCTION"}),"\n",(0,t.jsx)(e.h3,{id:"description",children:"description"}),"\n",(0,t.jsx)(e.p,{children:"\u5206\u6790\u51FD\u6570\u662F\u4E00\u7C7B\u7279\u6B8A\u7684\u5185\u7F6E\u51FD\u6570\u3002\u548C\u805A\u5408\u51FD\u6570\u7C7B\u4F3C\uFF0C\u5206\u6790\u51FD\u6570\u4E5F\u662F\u5BF9\u4E8E\u591A\u4E2A\u8F93\u5165\u884C\u505A\u8BA1\u7B97\u5F97\u5230\u4E00\u4E2A\u6570\u636E\u503C\u3002\u4E0D\u540C\u7684\u662F\uFF0C\u5206\u6790\u51FD\u6570\u662F\u5728\u4E00\u4E2A\u7279\u5B9A\u7684\u7A97\u53E3\u5185\u5BF9\u8F93\u5165\u6570\u636E\u505A\u5904\u7406\uFF0C\u800C\u4E0D\u662F\u6309\u7167 group by \u6765\u5206\u7EC4\u8BA1\u7B97\u3002\u6BCF\u4E2A\u7A97\u53E3\u5185\u7684\u6570\u636E\u53EF\u4EE5\u7528 over() \u4ECE\u53E5\u8FDB\u884C\u6392\u5E8F\u548C\u5206\u7EC4\u3002\u5206\u6790\u51FD\u6570\u4F1A\u5BF9\u7ED3\u679C\u96C6\u7684\u6BCF\u4E00\u884C\u8BA1\u7B97\u51FA\u4E00\u4E2A\u5355\u72EC\u7684\u503C\uFF0C\u800C\u4E0D\u662F\u6BCF\u4E2A group by \u5206\u7EC4\u8BA1\u7B97\u4E00\u4E2A\u503C\u3002\u8FD9\u79CD\u7075\u6D3B\u7684\u65B9\u5F0F\u5141\u8BB8\u7528\u6237\u5728 select \u4ECE\u53E5\u4E2D\u589E\u52A0\u989D\u5916\u7684\u5217\uFF0C\u7ED9\u7528\u6237\u63D0\u4F9B\u4E86\u66F4\u591A\u7684\u673A\u4F1A\u6765\u5BF9\u7ED3\u679C\u96C6\u8FDB\u884C\u91CD\u65B0\u7EC4\u7EC7\u548C\u8FC7\u6EE4\u3002\u5206\u6790\u51FD\u6570\u53EA\u80FD\u51FA\u73B0\u5728 select \u5217\u8868\u548C\u6700\u5916\u5C42\u7684 order by \u4ECE\u53E5\u4E2D\u3002\u5728\u67E5\u8BE2\u8FC7\u7A0B\u4E2D\uFF0C\u5206\u6790\u51FD\u6570\u4F1A\u5728\u6700\u540E\u751F\u6548\uFF0C\u5C31\u662F\u8BF4\uFF0C\u5728\u6267\u884C\u5B8C join\uFF0Cwhere \u548C group by \u7B49\u64CD\u4F5C\u4E4B\u540E\u518D\u6267\u884C\u3002\u5206\u6790\u51FD\u6570\u5728\u91D1\u878D\u548C\u79D1\u5B66\u8BA1\u7B97\u9886\u57DF\u7ECF\u5E38\u88AB\u4F7F\u7528\u5230\uFF0C\u7528\u6765\u5206\u6790\u8D8B\u52BF\u3001\u8BA1\u7B97\u79BB\u7FA4\u503C\u4EE5\u53CA\u5BF9\u5927\u91CF\u6570\u636E\u8FDB\u884C\u5206\u6876\u5206\u6790\u7B49\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u5206\u6790\u51FD\u6570\u7684\u8BED\u6CD5\uFF1A"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"function(args) OVER(partition_by_clause order_by_clause [window_clause])    \npartition_by_clause ::= PARTITION BY expr [, expr ...]    \norder_by_clause ::= ORDER BY expr [ASC | DESC] [, expr [ASC | DESC] ...]\n"})}),"\n",(0,t.jsx)(e.h4,{id:"function",children:"Function"}),"\n",(0,t.jsx)(e.p,{children:"\u76EE\u524D\u652F\u6301\u7684 Function \u5305\u62EC AVG(), COUNT(), DENSE_RANK(), FIRST_VALUE(), LAG(), LAST_VALUE(), LEAD(), MAX(), MIN(), RANK(), ROW_NUMBER() \u548C SUM()\u3002"}),"\n",(0,t.jsx)(e.h4,{id:"partition-by-\u4ECE\u53E5",children:"PARTITION BY \u4ECE\u53E5"}),"\n",(0,t.jsx)(e.p,{children:"Partition By \u4ECE\u53E5\u548C Group By \u7C7B\u4F3C\u3002\u5B83\u628A\u8F93\u5165\u884C\u6309\u7167\u6307\u5B9A\u7684\u4E00\u5217\u6216\u591A\u5217\u5206\u7EC4\uFF0C\u76F8\u540C\u503C\u7684\u884C\u4F1A\u88AB\u5206\u5230\u4E00\u7EC4\u3002"}),"\n",(0,t.jsx)(e.h4,{id:"order-by-\u4ECE\u53E5",children:"ORDER BY \u4ECE\u53E5"}),"\n",(0,t.jsx)(e.p,{children:"Order By \u4ECE\u53E5\u548C\u5916\u5C42\u7684 Order By \u57FA\u672C\u4E00\u81F4\u3002\u5B83\u5B9A\u4E49\u4E86\u8F93\u5165\u884C\u7684\u6392\u5217\u987A\u5E8F\uFF0C\u5982\u679C\u6307\u5B9A\u4E86 Partition By\uFF0C\u5219 Order By \u5B9A\u4E49\u4E86\u6BCF\u4E2A Partition \u5206\u7EC4\u5185\u7684\u987A\u5E8F\u3002\u4E0E\u5916\u5C42 Order By \u7684\u552F\u4E00\u4E0D\u540C\u70B9\u662F\uFF0COVER \u4ECE\u53E5\u4E2D\u7684 Order By n\uFF08n \u662F\u6B63\u6574\u6570\uFF09\u76F8\u5F53\u4E8E\u4E0D\u505A\u4EFB\u4F55\u64CD\u4F5C\uFF0C\u800C\u5916\u5C42\u7684 Order By n \u8868\u793A\u6309\u7167\u7B2C n \u5217\u6392\u5E8F\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u4E3E\u4F8B\uFF1A"}),"\n",(0,t.jsx)(e.p,{children:"\u8FD9\u4E2A\u4F8B\u5B50\u5C55\u793A\u4E86\u5728 select \u5217\u8868\u4E2D\u589E\u52A0\u4E00\u4E2A id \u5217\uFF0C\u5B83\u7684\u503C\u662F 1\uFF0C2\uFF0C3 \u7B49\u7B49\uFF0C\u987A\u5E8F\u6309\u7167 events \u8868\u4E2D\u7684 date_and_time \u5217\u6392\u5E8F\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"SELECT   \nrow_number() OVER (ORDER BY date_and_time) AS id,   \nc1, c2, c3, c4   \nFROM events;\n"})}),"\n",(0,t.jsx)(e.h4,{id:"window-\u4ECE\u53E5",children:"Window \u4ECE\u53E5"}),"\n",(0,t.jsx)(e.p,{children:"Window \u4ECE\u53E5\u7528\u6765\u4E3A\u5206\u6790\u51FD\u6570\u6307\u5B9A\u4E00\u4E2A\u8FD0\u7B97\u8303\u56F4\uFF0C\u4EE5\u5F53\u524D\u884C\u4E3A\u51C6\uFF0C\u524D\u540E\u82E5\u5E72\u884C\u4F5C\u4E3A\u5206\u6790\u51FD\u6570\u8FD0\u7B97\u7684\u5BF9\u8C61\u3002Window \u4ECE\u53E5\u652F\u6301\u7684\u65B9\u6CD5\u6709\uFF1AAVG(), COUNT(), FIRST_VALUE(), LAST_VALUE() \u548C SUM()\u3002\u5BF9\u4E8E MAX() \u548C MIN(), window \u4ECE\u53E5\u53EF\u4EE5\u6307\u5B9A\u5F00\u59CB\u8303\u56F4 UNBOUNDED PRECEDING"}),"\n",(0,t.jsx)(e.p,{children:"\u8BED\u6CD5\uFF1A"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"ROWS BETWEEN [ { m | UNBOUNDED } PRECEDING | CURRENT ROW] [ AND [CURRENT ROW | { UNBOUNDED | n } FOLLOWING] ]\n"})}),"\n",(0,t.jsx)(e.h3,{id:"example",children:"example"}),"\n",(0,t.jsx)(e.p,{children:"\u5047\u8BBE\u6211\u4EEC\u6709\u5982\u4E0B\u7684\u80A1\u7968\u6570\u636E\uFF0C\u80A1\u7968\u4EE3\u7801\u662F JDR\uFF0Cclosing price \u662F\u6BCF\u5929\u7684\u6536\u76D8\u4EF7\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"create table stock_ticker (stock_symbol string, closing_price decimal(8,2), closing_date timestamp);    \n...load some data...    \nselect * from stock_ticker order by stock_symbol, closing_date\n | stock_symbol | closing_price | closing_date        |\n |--------------|---------------|---------------------|\n | JDR          | 12.86         | 2014-10-02 00:00:00 |\n | JDR          | 12.89         | 2014-10-03 00:00:00 |\n | JDR          | 12.94         | 2014-10-04 00:00:00 |\n | JDR          | 12.55         | 2014-10-05 00:00:00 |\n | JDR          | 14.03         | 2014-10-06 00:00:00 |\n | JDR          | 14.75         | 2014-10-07 00:00:00 |\n | JDR          | 13.98         | 2014-10-08 00:00:00 |\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u8FD9\u4E2A\u67E5\u8BE2\u4F7F\u7528\u5206\u6790\u51FD\u6570\u4EA7\u751F moving_average \u8FD9\u4E00\u5217\uFF0C\u5B83\u7684\u503C\u662F 3 \u5929\u7684\u80A1\u7968\u5747\u4EF7\uFF0C\u5373\u524D\u4E00\u5929\u3001\u5F53\u524D\u4EE5\u53CA\u540E\u4E00\u5929\u4E09\u5929\u7684\u5747\u4EF7\u3002\u7B2C\u4E00\u5929\u6CA1\u6709\u524D\u4E00\u5929\u7684\u503C\uFF0C\u6700\u540E\u4E00\u5929\u6CA1\u6709\u540E\u4E00\u5929\u7684\u503C\uFF0C\u6240\u4EE5\u8FD9\u4E24\u884C\u53EA\u8BA1\u7B97\u4E86\u4E24\u5929\u7684\u5747\u503C\u3002\u8FD9\u91CC Partition By \u6CA1\u6709\u8D77\u5230\u4F5C\u7528\uFF0C\u56E0\u4E3A\u6240\u6709\u7684\u6570\u636E\u90FD\u662F JDR \u7684\u6570\u636E\uFF0C\u4F46\u5982\u679C\u8FD8\u6709\u5176\u4ED6\u80A1\u7968\u4FE1\u606F\uFF0CPartition By \u4F1A\u4FDD\u8BC1\u5206\u6790\u51FD\u6570\u503C\u4F5C\u7528\u5728\u672C Partition \u4E4B\u5185\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"select stock_symbol, closing_date, closing_price,    \navg(closing_price) over (partition by stock_symbol order by closing_date    \nrows between 1 preceding and 1 following) as moving_average    \nfrom stock_ticker;\n | stock_symbol | closing_date        | closing_price | moving_average |\n |--------------|---------------------|---------------|----------------|\n | JDR          | 2014-10-02 00:00:00 | 12.86         | 12.87          |\n | JDR          | 2014-10-03 00:00:00 | 12.89         | 12.89          |\n | JDR          | 2014-10-04 00:00:00 | 12.94         | 12.79          |\n | JDR          | 2014-10-05 00:00:00 | 12.55         | 13.17          |\n | JDR          | 2014-10-06 00:00:00 | 14.03         | 13.77          |\n | JDR          | 2014-10-07 00:00:00 | 14.75         | 14.25          |\n | JDR          | 2014-10-08 00:00:00 | 13.98         | 14.36          |\n"})}),"\n",(0,t.jsx)(e.h3,{id:"keywords",children:"keywords"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"WINDOW,FUNCTION\n"})})]})}function u(n={}){let{wrapper:e}={...(0,s.a)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(a,{...n})}):a(n)}},250065:function(n,e,i){i.d(e,{Z:function(){return c},a:function(){return r}});var o=i(667294);let t={},s=o.createContext(t);function r(n){let e=o.useContext(s);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),o.createElement(s.Provider,{value:e},n.children)}}}]);