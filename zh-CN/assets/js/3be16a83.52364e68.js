"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["364529"],{647286:function(e,n,a){a.r(n),a.d(n,{metadata:()=>l,contentTitle:()=>o,default:()=>u,assets:()=>d,toc:()=>i,frontMatter:()=>t});var l=JSON.parse('{"id":"compute-storage-decoupled/managing-storage-vault","title":"\u7BA1\u7406 Storage Vault","description":"\x3c!--","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-3.0/compute-storage-decoupled/managing-storage-vault.md","sourceDirName":"compute-storage-decoupled","slug":"/compute-storage-decoupled/managing-storage-vault","permalink":"/zh-CN/docs/3.0/compute-storage-decoupled/managing-storage-vault","draft":false,"unlisted":false,"tags":[],"version":"3.0","frontMatter":{"title":"\u7BA1\u7406 Storage Vault","language":"zh-CN"},"sidebar":"docs","previous":{"title":"\u7F16\u8BD1\u90E8\u7F72","permalink":"/zh-CN/docs/3.0/compute-storage-decoupled/compilation-and-deployment"},"next":{"title":"\u8BA1\u7B97\u7EC4\u64CD\u4F5C","permalink":"/zh-CN/docs/3.0/compute-storage-decoupled/managing-compute-cluster"}}'),r=a("785893"),s=a("250065");let t={title:"\u7BA1\u7406 Storage Vault",language:"zh-CN"},o=void 0,d={},i=[{value:"\u521B\u5EFA Storage Vault",id:"\u521B\u5EFA-storage-vault",level:2},{value:"\u521B\u5EFA HDFS  Storage Vault",id:"\u521B\u5EFA-hdfs--storage-vault",level:3},{value:"\u521B\u5EFA S3  Storage Vault",id:"\u521B\u5EFA-s3--storage-vault",level:3},{value:"\u67E5\u770B Storage Vault",id:"\u67E5\u770B-storage-vault",level:2},{value:"\u8BBE\u7F6E\u9ED8\u8BA4 Storage Vault",id:"\u8BBE\u7F6E\u9ED8\u8BA4-storage-vault",level:3},{value:"\u5EFA\u8868\u65F6\u6307\u5B9A Storage Vault",id:"\u5EFA\u8868\u65F6\u6307\u5B9A-storage-vault",level:2},{value:"\u66F4\u6539 Storage Vault",id:"\u66F4\u6539-storage-vault",level:2},{value:"\u5220\u9664 Storage Vault",id:"\u5220\u9664-storage-vault",level:2},{value:"Storage Vault \u6743\u9650",id:"storage-vault-\u6743\u9650",level:2},{value:"\u6388\u4E88",id:"\u6388\u4E88",level:3},{value:"\u64A4\u9500",id:"\u64A4\u9500",level:3}];function c(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Storage Vault \u662F Doris \u5728\u5B58\u7B97\u5206\u79BB\u6A21\u5F0F\u4E2D\u6240\u4F7F\u7528\u7684\u8FDC\u7A0B\u5171\u4EAB\u5B58\u50A8\uFF0C\u53EF\u914D\u7F6E\u4E00\u4E2A\u6216\u591A\u4E2A Storage Vault\uFF0C\u53EF\u5C06\u4E0D\u540C\u8868\u5B58\u50A8\u5728\u4E0D\u540C Storage Vault \u4E0A\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u521B\u5EFA-storage-vault",children:"\u521B\u5EFA Storage Vault"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u8BED\u6CD5"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE STORAGE VAULT [IF NOT EXISTS] <vault_name>\nPROPERTIES\n("key" = "value",...)\n'})}),"\n",(0,r.jsx)(n.p,{children:"<vault_name> \u662F\u7528\u6237\u5B9A\u4E49\u7684 Storage Vault \u540D\u79F0\uFF0C\u662F\u7528\u6237\u63A5\u53E3\u7528\u4E8E\u8BBF\u95EE Storage Vault \u7684\u6807\u8BC6\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u521B\u5EFA-hdfs--storage-vault",children:"\u521B\u5EFA HDFS  Storage Vault"}),"\n",(0,r.jsx)(n.p,{children:"\u521B\u5EFA\u57FA\u4E8E HDFS \u7684\u5B58\u7B97\u5206\u79BB\u6A21\u5F0F Doris \u96C6\u7FA4\uFF0C\u9700\u8981\u786E\u4FDD\u6240\u6709\u7684\u8282\u70B9\uFF08\u5305\u62EC FE / BE \u8282\u70B9\u3001Meta Service) \u5747\u6709\u6743\u9650\u8BBF\u95EE\u6240\u6307\u5B9A\u7684 HDFS\uFF0C\u5305\u62EC\u63D0\u524D\u5B8C\u6210\u673A\u5668\u7684 Kerberos \u6388\u6743\u914D\u7F6E\u548C\u8FDE\u901A\u6027\u68C0\u67E5\uFF08\u53EF\u5728\u5BF9\u5E94\u7684\u6BCF\u4E2A\u8282\u70B9\u4E0A\u4F7F\u7528 Hadoop Client \u8FDB\u884C\u6D4B\u8BD5\uFF09\u7B49\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE STORAGE VAULT IF NOT EXISTS ssb_hdfs_vault\n    PROPERTIES (\n        "type"="hdfs",                                     -- required\n        "fs.defaultFS"="hdfs://127.0.0.1:8020",            -- required\n        "path_prefix"="big/data",                          -- optional,  \u4E00\u822C\u6309\u7167\u4E1A\u52A1\u540D\u79F0\u586B\u5199\n        "hadoop.username"="user"                           -- optional\n        "hadoop.security.authentication"="kerberos"        -- optional\n        "hadoop.kerberos.principal"="hadoop/127.0.0.1@XXX" -- optional\n        "hadoop.kerberos.keytab"="/etc/emr.keytab"         -- optional\n    );\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u521B\u5EFA-s3--storage-vault",children:"\u521B\u5EFA S3  Storage Vault"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:'CREATE STORAGE VAULT IF NOT EXISTS ssb_s3_vault\n    PROPERTIES (\n        "type"="S3",                                   -- required\n        "s3.endpoint" = "oss-cn-beijing.aliyuncs.com", -- required\n        "s3.region" = "bj",                            -- required\n        "s3.bucket" = "bucket",                        -- required\n        "s3.root.path" = "big/data/prefix",            -- required\n        "s3.access_key" = "ak",                        -- required\n        "s3.secret_key" = "sk",                        -- required\n        "provider" = "OSS"                             -- required\n    );\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u66F4\u591A\u53C2\u6570\u8BF4\u660E\u53CA\u793A\u4F8B\u53EF\u89C1 ",(0,r.jsx)(n.a,{href:"/zh-CN/docs/3.0/sql-manual/sql-statements/cluster-management/storage-management/CREATE-STORAGE-VAULT",children:"CREATE-STORAGE-VAULT"}),"\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u67E5\u770B-storage-vault",children:"\u67E5\u770B Storage Vault"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u8BED\u6CD5"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SHOW STORAGE VAULTS\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8FD4\u56DE\u7ED3\u679C\u5305\u542B 4 \u5217\uFF0C\u5206\u522B\u4E3A Storage Vault \u540D\u79F0\u3001 Storage Vault  ID\u3001\u5C5E\u6027\u4EE5\u53CA\u662F\u5426\u4E3A\u9ED8\u8BA4 Storage Vault \u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u8BBE\u7F6E\u9ED8\u8BA4-storage-vault",children:"\u8BBE\u7F6E\u9ED8\u8BA4 Storage Vault"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u8BED\u6CD5"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SET <vault_name> AS DEFAULT STORAGE VAULT\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5EFA\u8868\u65F6\u6307\u5B9A-storage-vault",children:"\u5EFA\u8868\u65F6\u6307\u5B9A Storage Vault"}),"\n",(0,r.jsxs)(n.p,{children:["\u5EFA\u8868\u65F6\u5728 ",(0,r.jsx)(n.code,{children:"PROPERTIES"})," \u4E2D\u6307\u5B9A ",(0,r.jsx)(n.code,{children:"storage_vault_name"}),"\uFF0C\u5219\u6570\u636E\u4F1A\u5B58\u50A8\u5728\u6307\u5B9A ",(0,r.jsx)(n.code,{children:"vault name"})," \u6240\u5BF9\u5E94\u7684 Storage Vault \u4E0A\u3002\u5EFA\u8868\u6210\u529F\u540E\uFF0C\u8BE5\u8868\u4E0D\u5141\u8BB8\u518D\u4FEE\u6539 ",(0,r.jsx)(n.code,{children:"storage_vault"}),"\uFF0C\u5373\u4E0D\u652F\u6301\u66F4\u6362 Storage Vault \u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u793A\u4F8B"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE IF NOT EXISTS supplier (\n  s_suppkey int(11) NOT NULL COMMENT "",\n  s_name varchar(26) NOT NULL COMMENT "",\n  s_address varchar(26) NOT NULL COMMENT "",\n  s_city varchar(11) NOT NULL COMMENT "",\n  s_nation varchar(16) NOT NULL COMMENT "",\n  s_region varchar(13) NOT NULL COMMENT "",\n  s_phone varchar(16) NOT NULL COMMENT ""\n)\nUNIQUE KEY (s_suppkey)\nDISTRIBUTED BY HASH(s_suppkey) BUCKETS 1\nPROPERTIES (\n"replication_num" = "1",\n"storage_vault_name" = "ssb_hdfs_vault"\n);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u66F4\u6539-storage-vault",children:"\u66F4\u6539 Storage Vault"}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u4E8E\u66F4\u65B0 Storage Vault \u914D\u7F6E\u7684\u53EF\u4FEE\u6539\u5C5E\u6027\u3002"}),"\n",(0,r.jsx)(n.p,{children:"S3 Storage Vault \u5141\u8BB8\u4FEE\u6539\u7684\u5C5E\u6027:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"VAULT_NAME"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"s3.access_key"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"s3.secret_key"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"use_path_style"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"HDFS Storage Vault \u7981\u6B62\u4FEE\u6539\u7684\u5C5E\u6027:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"path_prefix"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"fs.defaultFS"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u66F4\u591A\u5C5E\u6027\u8BF4\u660E\u89C1 ",(0,r.jsx)(n.a,{href:"/zh-CN/docs/3.0/sql-manual/sql-statements/cluster-management/storage-management/CREATE-STORAGE-VAULT",children:"CREATE-STORAGE-VAULT"}),"\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u793A\u4F8B"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'ALTER STORAGE VAULT old_s3_vault\nPROPERTIES (\n    "type" = "S3",\n    "VAULT_NAME" = "new_s3_vault",\n    "s3.access_key" = "new_ak"\n    "s3.secret_key" = "new_sk"\n);\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'ALTER STORAGE VAULT old_hdfs_vault\nPROPERTIES (\n    "type" = "hdfs",\n    "VAULT_NAME" = "new_hdfs_vault",\n    "hadoop.username" = "hdfs"\n);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5220\u9664-storage-vault",children:"\u5220\u9664 Storage Vault"}),"\n",(0,r.jsx)(n.p,{children:"\u6682\u4E0D\u652F\u6301"}),"\n",(0,r.jsx)(n.h2,{id:"storage-vault-\u6743\u9650",children:"Storage Vault \u6743\u9650"}),"\n",(0,r.jsx)(n.p,{children:"\u5411\u6307\u5B9A\u7684 MySQL \u7528\u6237\u6388\u4E88\u67D0\u4E2A Storage Vault \u7684\u4F7F\u7528\u6743\u9650\uFF0C\u4F7F\u8BE5\u7528\u6237\u53EF\u4EE5\u8FDB\u884C\u5EFA\u8868\u65F6\u6307\u5B9A\u8BE5 Storage Vault \u6216\u67E5\u770B Storage Vault \u7B49\u64CD\u4F5C\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u6388\u4E88",children:"\u6388\u4E88"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"GRANT\n    USAGE_PRIV\n    ON STORAGE VAULT <vault_name>\n    TO { ROLE | USER } {<role> | <user>}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4EC5 Admin \u7528\u6237\u6709\u6743\u9650\u6267\u884C ",(0,r.jsx)(n.code,{children:"GRANT"})," \u8BED\u53E5\uFF0C\u8BE5\u8BED\u53E5\u7528\u4E8E\u5411 User / Role \u6388\u4E88\u6307\u5B9A Storage Vault \u7684\u6743\u9650\u3002\u62E5\u6709\u67D0\u4E2A Storage Vault \u7684 ",(0,r.jsx)(n.code,{children:"USAGE_PRIV"})," \u6743\u9650\u7684 User / Role \u53EF\u8FDB\u884C\u4EE5\u4E0B\u64CD\u4F5C\uFF1A"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u901A\u8FC7 ",(0,r.jsx)(n.code,{children:"SHOW STORAGE VAULT"})," \u67E5\u770B\u8BE5 Storage Vault \u7684\u4FE1\u606F\uFF1B"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5EFA\u8868\u65F6\u5728 ",(0,r.jsx)(n.code,{children:"PROPERTIES"})," \u4E2D\u6307\u5B9A\u4F7F\u7528\u8BE5 Storage Vault \u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u64A4\u9500",children:"\u64A4\u9500"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"grant usage_priv on storage vault my_storage_vault to user1\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u64A4\u9500\u6307\u5B9A\u7684 MySQL \u7528\u6237\u7684 Storage Vault \u6743\u9650\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u8BED\u6CD5"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"REVOKE \n    USAGE_PRIV\n    ON STORAGE VAULT <vault_name>\n    FROM { ROLE | USER } {<role> | <user>}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4EC5 Admin \u7528\u6237\u6709\u6743\u9650\u6267\u884C ",(0,r.jsx)(n.code,{children:"REVOKE"})," \u8BED\u53E5\uFF0C\u7528\u4E8E\u64A4\u9500 User / Role \u62E5\u6709\u7684\u5BF9\u6307\u5B9A Storage Vault \u7684\u6743\u9650\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u793A\u4F8B"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"revoke usage_priv on storage vault my_storage_vault from user1\n"})})]})}function u(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},250065:function(e,n,a){a.d(n,{Z:function(){return o},a:function(){return t}});var l=a(667294);let r={},s=l.createContext(r);function t(e){let n=l.useContext(s);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);