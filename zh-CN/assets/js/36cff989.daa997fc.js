"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["361891"],{802330:function(e,n,a){a.r(n),a.d(n,{metadata:()=>l,contentTitle:()=>i,default:()=>u,assets:()=>c,toc:()=>d,frontMatter:()=>r});var l=JSON.parse('{"id":"sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-TABLE-AND-GENERATED-COLUMN","title":"CREATE-TABLE-AND-GENERATED-COLUMN","description":"\x3c!--","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-TABLE-AND-GENERATED-COLUMN.md","sourceDirName":"sql-manual/sql-statements/Data-Definition-Statements/Create","slug":"/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-TABLE-AND-GENERATED-COLUMN","permalink":"/zh-CN/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-TABLE-AND-GENERATED-COLUMN","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"CREATE-TABLE-AND-GENERATED-COLUMN","language":"zh-CN"},"sidebar":"docs","previous":{"title":"CREATE-TABLE","permalink":"/zh-CN/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-TABLE"},"next":{"title":"CREATE-TABLE-LIKE","permalink":"/zh-CN/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-TABLE-LIKE"}}'),s=a("785893"),t=a("250065");let r={title:"CREATE-TABLE-AND-GENERATED-COLUMN",language:"zh-CN"},i=void 0,c={},d=[{value:"\u8BED\u6CD5",id:"\u8BED\u6CD5",level:2},{value:"\u751F\u6210\u5217\u7684\u9650\u5236",id:"\u751F\u6210\u5217\u7684\u9650\u5236",level:2},{value:"\u5BFC\u5165\u6570\u636E",id:"\u5BFC\u5165\u6570\u636E",level:2},{value:"INSERT",id:"insert",level:3},{value:"Load",id:"load",level:3},{value:"Stream Load",id:"stream-load",level:4},{value:"HTTP Stream Load",id:"http-stream-load",level:4},{value:"MySQL Load",id:"mysql-load",level:4},{value:"\u5176\u5B83Load",id:"\u5176\u5B83load",level:4},{value:"\u751F\u6210\u5217\u4E0E\u90E8\u5206\u5217\u66F4\u65B0",id:"\u751F\u6210\u5217\u4E0E\u90E8\u5206\u5217\u66F4\u65B0",level:2}];function o(e){let n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"\u751F\u6210\u5217\u662F\u4E00\u79CD\u7279\u6B8A\u7684\u6570\u636E\u5E93\u8868\u5217\uFF0C\u5176\u503C\u7531\u5176\u4ED6\u5217\u7684\u503C\u8BA1\u7B97\u800C\u6765\uFF0C\u800C\u4E0D\u662F\u76F4\u63A5\u7531\u7528\u6237\u63D2\u5165\u6216\u66F4\u65B0\u3002\u8BE5\u529F\u80FD\u652F\u6301\u9884\u5148\u8BA1\u7B97\u8868\u8FBE\u5F0F\u7684\u7ED3\u679C\uFF0C\u5E76\u5B58\u50A8\u5728\u6570\u636E\u5E93\u4E2D\uFF0C\u9002\u7528\u4E8E\u9700\u8981\u9891\u7E41\u67E5\u8BE2\u6216\u8FDB\u884C\u590D\u6742\u8BA1\u7B97\u7684\u573A\u666F\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u751F\u6210\u5217\u53EF\u4EE5\u5728\u6570\u636E\u5BFC\u5165\u6216\u66F4\u65B0\u65F6\u81EA\u52A8\u6839\u636E\u9884\u5B9A\u4E49\u7684\u8868\u8FBE\u5F0F\u8BA1\u7B97\u7ED3\u679C\uFF0C\u5E76\u5C06\u8FD9\u4E9B\u7ED3\u679C\u6301\u4E45\u5316\u5B58\u50A8\u3002\u8FD9\u6837\uFF0C\u5728\u540E\u7EED\u7684\u67E5\u8BE2\u8FC7\u7A0B\u4E2D\uFF0C\u53EF\u4EE5\u76F4\u63A5\u8BBF\u95EE\u8FD9\u4E9B\u5DF2\u7ECF\u8BA1\u7B97\u597D\u7684\u7ED3\u679C\uFF0C\u800C\u65E0\u9700\u5728\u67E5\u8BE2\u65F6\u518D\u8FDB\u884C\u590D\u6742\u7684\u8BA1\u7B97\uFF0C\u4ECE\u800C\u663E\u8457\u51CF\u5C11\u67E5\u8BE2\u65F6\u7684\u8BA1\u7B97\u8D1F\u62C5\uFF0C\u63D0\u5347\u67E5\u8BE2\u6027\u80FD\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u4E0B\u9762\u662F\u4E00\u4E2A\u4F7F\u7528\u751F\u6210\u5217\u7684\u4F8B\u5B50\uFF1A"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE products (\nproduct_id INT,\nprice DECIMAL(10,2),\nquantity INT,\ntotal_value DECIMAL(10,2) GENERATED ALWAYS AS (price * quantity)\n) UNIQUE KEY(product_id) \nDISTRIBUTED BY HASH(product_id) PROPERTIES ("replication_num" = "1");\n\nINSERT INTO products VALUES(1, 10.00, 10, default);\nINSERT INTO products(product_id, price, quantity) VALUES(1, 20.00, 10);\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u4ECE\u8868\u4E2D\u67E5\u8BE2\u6570\u636E\uFF1A"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"mysql> SELECT * FROM products;\n+------------+-------+----------+-------------+\n| product_id | price | quantity | total_value |\n+------------+-------+----------+-------------+\n|          1 | 10.00 |       10 |      100.00 |\n|          1 | 20.00 |       10 |      200.00 |\n+------------+-------+----------+-------------+\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u8FD9\u4E2A\u793A\u4F8B\u4E2D, total_value \u5217\u662F\u4E00\u4E2A\u751F\u6210\u5217\uFF0C\u5176\u503C\u7531 price \u548C quantity \u5217\u7684\u503C\u76F8\u4E58\u8BA1\u7B97\u800C\u6765\u3002\n\u751F\u6210\u5217\u7684\u503C\u5728\u5BFC\u5165\u6216\u66F4\u65B0\u65F6\u8BA1\u7B97\u5E76\u5B58\u50A8\u5728\u8868\u4E2D\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u8BED\u6CD5",children:"\u8BED\u6CD5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"col_name data_type [GENERATED ALWAYS] AS (expr)\n[NOT NULL | NULL] [COMMENT 'string']\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u751F\u6210\u5217\u7684\u9650\u5236",children:"\u751F\u6210\u5217\u7684\u9650\u5236"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u4F7F\u7528\u7684\u51FD\u6570\u53EA\u80FD\u662F\u5185\u7F6E\u7684\u6807\u91CF\u51FD\u6570\u548C\u8FD0\u7B97\u7B26\uFF0C\u4E0D\u5141\u8BB8\u4F7F\u7528udf\uFF0C\u805A\u5408\u51FD\u6570\u7B49\u5176\u5B83\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u4E0D\u5141\u8BB8\u4F7F\u7528\u53D8\u91CF\uFF0C\u5B50\u67E5\u8BE2\uFF0CLambda\u8868\u8FBE\u5F0F\u3002"}),"\n",(0,s.jsx)(n.li,{children:"AUTO_INCREMENT\u5217\u4E0D\u80FD\u7528\u4F5C\u751F\u6210\u7684\u5217\u5B9A\u4E49\u4E2D\u7684\u57FA\u5217\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u751F\u6210\u7684\u5217\u5B9A\u4E49\u53EF\u4EE5\u5F15\u7528\u5176\u4ED6\u751F\u6210\u7684\u5217\uFF0C\u4F46\u53EA\u80FD\u5F15\u7528\u8868\u5B9A\u4E49\u4E2D\u8F83\u65E9\u51FA\u73B0\u7684\u5217\u3002 \u751F\u6210\u7684\u5217\u5B9A\u4E49\u53EF\u4EE5\u5F15\u7528\u8868\u4E2D\u7684\u4EFB\u4F55\u57FA\u672C\uFF08\u975E\u751F\u6210\uFF09\u5217\uFF0C\u65E0\u8BBA\u5176\u5B9A\u4E49\u53D1\u751F\u5F97\u65E9\u8FD8\u662F\u665A\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u805A\u5408\u6A21\u578B\u4E2D\uFF0C\u751F\u6210\u5217\u662FVALUE\u5217\u65F6\uFF0C\u4EC5\u5141\u8BB8\u4F7F\u7528REPLACE\u548CREPLACE_IF_NOT_NULL\u805A\u5408\u7C7B\u578B\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u5BFC\u5165\u6570\u636E",children:"\u5BFC\u5165\u6570\u636E"}),"\n",(0,s.jsx)(n.p,{children:"\u5BFC\u5165\u6570\u636E\u65F6\uFF0C\u5982\u679C\u8FDD\u53CD\u4E86\u751F\u6210\u5217\u7684NOT NULL\u9650\u5236\uFF0C\u4F8B\u5982\u5BFC\u5165\u6570\u636E\u65F6\uFF0C\u6CA1\u6709\u6307\u5B9A\u751F\u6210\u5217\u5F15\u7528\u7684\u5217\uFF0C\u5E76\u4E14\u6B64\u5217\u6CA1\u6709\u9ED8\u8BA4\u503C\uFF0C\u5C06\u5BFC\u81F4\u5BFC\u5165\u5931\u8D25\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"insert",children:"INSERT"}),"\n",(0,s.jsx)(n.p,{children:"\u6307\u5B9A\u5217\u65F6\uFF0C\u6307\u5B9A\u7684\u5217\u4E0D\u80FD\u5305\u542B\u751F\u6210\u5217\uFF0C\u5426\u5219\u5C06\u62A5\u9519\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"INSERT INTO products(product_id, price, quantity) VALUES(1, 20.00, 10);\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6CA1\u6709\u6307\u5B9A\u5217\u65F6\uFF0C\u751F\u6210\u5217\u9700\u8981\u4F7F\u7528DEFAULT\u5173\u952E\u5B57\u8FDB\u884C\u5360\u4F4D\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"INSERT INTO products VALUES(1, 10.00, 10, default);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"load",children:"Load"}),"\n",(0,s.jsx)(n.p,{children:"\u4F7F\u7528load\u65B9\u5F0F\u8FDB\u884C\u6570\u636E\u5BFC\u5165\u65F6\uFF0C\u9700\u8981\u663E\u5F0F\u6307\u5B9A\u5BFC\u5165\u5217\u3002\u4E0D\u5E94\u5F53\u6307\u5B9A\u751F\u6210\u5217\u4E3A\u5BFC\u5165\u5217\uFF0C\u5F53\u6307\u5B9A\u5BFC\u5165\u751F\u6210\u5217\u5E76\u5728\u6570\u636E\u6587\u4EF6\u4E2D\u6709\u5BF9\u5E94\u7684\u6570\u636E\u65F6\uFF0C\u751F\u6210\u5217\u4E0D\u4F1A\u4F7F\u7528\u6570\u636E\u6587\u4EF6\u4E2D\u7684\u503C\uFF0C\u751F\u6210\u5217\u7684\u503C\u4ECD\u7136\u662F\u6839\u636E\u8868\u8FBE\u5F0F\u8BA1\u7B97\u5F97\u5230\u7684\u7ED3\u679C\u3002"}),"\n",(0,s.jsx)(n.h4,{id:"stream-load",children:"Stream Load"}),"\n",(0,s.jsx)(n.p,{children:"\u521B\u5EFA\u8868:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'mysql> CREATE TABLE gen_col_stream_load(a INT,b INT,c DOUBLE GENERATED ALWAYS AS (abs(a+b)) not null)\nDISTRIBUTED BY HASH(a)\nPROPERTIES("replication_num" = "1");\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u51C6\u5907\u6570\u636E\uFF0C\u5E76\u8FDB\u884Cstream load:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'cat gen_col_data.csv \n1,2\n3,5\n2,9\n\ncurl --location-trusted -u root: \\\n-H "Expect:100-continue" \\\n-H "column_separator:," \\\n-H "columns:a,b" \\\n-T gen_col_data.csv \\\n-XPUT http://127.0.0.1:8030/api/testdb/gen_col_stream_load/_stream_load\n{\n    "TxnId": 223227,\n    "Label": "d4a615c9-6e73-4d95-a8a4-e4c30d3b2262",\n    "Comment": "",\n    "TwoPhaseCommit": "false",\n    "Status": "Success",\n    "Message": "OK",\n    "NumberTotalRows": 3,\n    "NumberLoadedRows": 3,\n    "NumberFilteredRows": 0,\n    "NumberUnselectedRows": 0,\n    "LoadBytes": 12,\n    "LoadTimeMs": 152,\n    "BeginTxnTimeMs": 5,\n    "StreamLoadPutTimeMs": 39,\n    "ReadDataTimeMs": 0,\n    "WriteDataTimeMs": 66,\n    "CommitAndPublishTimeMs": 37\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u67E5\u770B\u6570\u636E\u5BFC\u5165\u7ED3\u679C:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"mysql> SELECT * FROM gen_col_stream_load;\n+------+------+------+\n| a    | b    | c    |\n+------+------+------+\n|    1 |    2 |    3 |\n|    2 |    9 |   11 |\n|    3 |    5 |    8 |\n+------+------+------+\n3 rows in set (0.07 sec)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"http-stream-load",children:"HTTP Stream Load"}),"\n",(0,s.jsx)(n.p,{children:"\u521B\u5EFA\u8868:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'mysql> CREATE TABLE gencol_refer_gencol_http_load(a INT,c DOUBLE GENERATED ALWAYS AS (abs(a+b)) NOT NULL,b INT, d INT GENERATED ALWAYS AS(c+1))\nDISTRIBUTED BY HASH(a)\nPROPERTIES("replication_num" = "1");\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u51C6\u5907\u6570\u636E\uFF0C\u5E76\u8FDB\u884Chttp stream load:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'curl  --location-trusted -u root: -T gen_col_data.csv  -H "Expect: 100-Continue" \\\n-H "sql:insert into testdb.gencol_refer_gencol_http_load(a, b) select * from http_stream(\\"format\\" = \\"CSV\\", \\"column_separator\\" = \\",\\" )" \\\nhttp://127.0.0.1:8030/api/_http_stream\n{\n    "TxnId": 223244,\n    "Label": "label_824464cba2a1eabc_bee78e427ea55e81",\n    "Comment": "",\n    "TwoPhaseCommit": "false",\n    "Status": "Success",\n    "Message": "OK",\n    "NumberTotalRows": 3,\n    "NumberLoadedRows": 3,\n    "NumberFilteredRows": 0,\n    "NumberUnselectedRows": 0,\n    "LoadBytes": 12,\n    "LoadTimeMs": 142,\n    "BeginTxnTimeMs": 0,\n    "StreamLoadPutTimeMs": 45,\n    "ReadDataTimeMs": 46,\n    "WriteDataTimeMs": 59,\n    "CommitAndPublishTimeMs": 36\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u67E5\u770B\u6570\u636E\u5BFC\u5165\u7ED3\u679C:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"mysql> SELECT * FROM gencol_refer_gencol_http_load;                                                                                                                          +------+------+------+------+\n| a    | c    | b    | d    |\n+------+------+------+------+\n|    2 |   11 |    9 |   12 |\n|    1 |    3 |    2 |    4 |\n|    3 |    8 |    5 |    9 |\n+------+------+------+------+\n3 rows in set (0.04 sec)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"mysql-load",children:"MySQL Load"}),"\n",(0,s.jsx)(n.p,{children:"\u5EFA\u8868\uFF0C\u52A0\u8F7D\u6570\u636E\u548C\u67E5\u8BE2\u7684\u8FC7\u7A0B\u5982\u4E0B:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"mysql> CREATE TABLE gen_col_mysql_load(a INT,b INT,c DOUBLE GENERATED ALWAYS AS (abs(a+b)) NOT NULL)\nDISTRIBUTED BY HASH(a)\nPROPERTIES(\"replication_num\" = \"1\");\n\nmysql> LOAD DATA LOCAL\nINFILE '/path_to_data/gen_col_data.csv'\nINTO TABLE gen_col_mysql_load\nCOLUMNS TERMINATED BY ','\n(a,b);\nQuery OK, 3 rows affected (0.14 sec)\nRecords: 3  Deleted: 0  Skipped: 0  Warnings: 0\n\nmysql> SELECT * FROM gen_col_mysql_load;\n+------+------+------+\n| a    | b    | c    |\n+------+------+------+\n|    2 |    9 |   11 |\n|    3 |    5 |    8 |\n|    1 |    2 |    3 |\n+------+------+------+\n3 rows in set (0.06 sec)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u5176\u5B83load",children:"\u5176\u5B83Load"}),"\n",(0,s.jsx)(n.p,{children:"BROKER LOAD, ROUTINE LOAD\u7B49\u65B9\u5F0F\u90FD\u53EF\u4EE5\u5C06\u6570\u636E\u5BFC\u5165\u6709\u751F\u6210\u5217\u7684\u8868\uFF0C\u4E0D\u518D\u4E00\u4E00\u5217\u4E3E\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u751F\u6210\u5217\u4E0E\u90E8\u5206\u5217\u66F4\u65B0",children:"\u751F\u6210\u5217\u4E0E\u90E8\u5206\u5217\u66F4\u65B0"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u8FDB\u884C\u90E8\u5206\u5217\u66F4\u65B0\u65F6\uFF0C\u5FC5\u987B\u5728columns\u4E2D\u6307\u5B9A\u751F\u6210\u5217\u5F15\u7528\u7684\u6240\u6709\u666E\u901A\u5217\uFF0C\u5426\u5219\u4F1A\u62A5\u9519\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u4E0B\u9762\u662F\u4E00\u4E2A\u793A\u4F8B\uFF0C \u5EFA\u8868\u548C\u63D2\u5165\u4E00\u884C\u6570\u636E\uFF0C\u5E76\u8BBE\u7F6Esession\u53D8\u91CF:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE test_partial_column_unique_gen_col (a INT, b INT, c INT AS (a+b), d INT AS (c+1), e INT)\nUNIQUE KEY(a) DISTRIBUTED BY HASH(a) PROPERTIES(\n "enable_unique_key_merge_on_write" = "true",\n "replication_num"="1"\n);\nSET enable_unique_key_partial_update=true;\nSET enable_insert_strict=false;\nSET enable_fallback_to_original_planner=false;\nINSERT INTO test_partial_column_unique_gen_col(a,b,e) VALUES(1,2,7);\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679C\u6CA1\u6709\u6307\u5B9A\u6240\u6709\u88AB\u5F15\u7528\u7684\u666E\u901A\u5217\u4F1A\u62A5\u9519:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"mysql> INSERT INTO test_partial_column_unique_gen_col(a) VALUES(3);\nERROR 1105 (HY000): errCode = 2, detailMessage = Partial update should include all ordinary columns referenced by generated columns, missing: b\n"})}),"\n",(0,s.jsx)(n.p,{children:'LOAD\u4E5F\u662F\u8FD9\u6837\uFF0C-H "columns: a, b"\u4E2D\u9700\u8981\u6307\u5B9A\u6240\u6709\u88AB\u5F15\u7528\u7684\u666E\u901A\u5217\uFF0C\u4E0B\u9762\u662F\u4F7F\u7528stream load\u7684\u793A\u4F8B:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'curl --location-trusted -u root: -H "Expect:100-continue" -H "column_separator:," \\\n-H "columns: a, b" -H "partial_columns:true" \\\n-T /Users/moailing/Documents/tmp/gen_col_data.csv \\\nhttp://127.0.0.1:8030/api/testdb/partial_column_unique_gen_col/_stream_load\n'})})]})}function u(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},250065:function(e,n,a){a.d(n,{Z:function(){return i},a:function(){return r}});var l=a(667294);let s={},t=l.createContext(s);function r(e){let n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);