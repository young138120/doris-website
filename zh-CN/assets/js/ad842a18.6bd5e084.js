"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["139481"],{3946:function(e,n,s){s.r(n),s.d(n,{metadata:()=>r,contentTitle:()=>d,default:()=>h,assets:()=>a,toc:()=>c,frontMatter:()=>t});var r=JSON.parse('{"id":"lakehouse/multi-catalog/iceberg","title":"Iceberg","description":"\x3c!--","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-1.2/lakehouse/multi-catalog/iceberg.md","sourceDirName":"lakehouse/multi-catalog","slug":"/lakehouse/multi-catalog/iceberg","permalink":"/zh-CN/docs/1.2/lakehouse/multi-catalog/iceberg","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"Iceberg","language":"zh-CN"},"sidebar":"docs","previous":{"title":"Hive","permalink":"/zh-CN/docs/1.2/lakehouse/multi-catalog/hive"},"next":{"title":"Hudi","permalink":"/zh-CN/docs/1.2/lakehouse/multi-catalog/hudi"}}'),i=s("785893"),l=s("250065");let t={title:"Iceberg",language:"zh-CN"},d="Iceberg",a={},c=[{value:"\u4F7F\u7528\u9650\u5236",id:"\u4F7F\u7528\u9650\u5236",level:2},{value:"\u521B\u5EFA Catalog",id:"\u521B\u5EFA-catalog",level:2},{value:"\u57FA\u4E8EHive Metastore\u521B\u5EFACatalog",id:"\u57FA\u4E8Ehive-metastore\u521B\u5EFAcatalog",level:3},{value:"\u57FA\u4E8EIceberg API\u521B\u5EFACatalog",id:"\u57FA\u4E8Eiceberg-api\u521B\u5EFAcatalog",level:3},{value:"Hive Metastore\u4F5C\u4E3A\u5143\u6570\u636E\u670D\u52A1",id:"hive-metastore\u4F5C\u4E3A\u5143\u6570\u636E\u670D\u52A1",level:4},{value:"Glue Catalog\u4F5C\u4E3A\u5143\u6570\u636E\u670D\u52A1",id:"glue-catalog\u4F5C\u4E3A\u5143\u6570\u636E\u670D\u52A1",level:4},{value:"\u5217\u7C7B\u578B\u6620\u5C04",id:"\u5217\u7C7B\u578B\u6620\u5C04",level:2},{value:"Time Travel",id:"time-travel",level:2}];function o(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",version:"version",...(0,l.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"iceberg",children:"Iceberg"})}),"\n",(0,i.jsx)(n.h2,{id:"\u4F7F\u7528\u9650\u5236",children:"\u4F7F\u7528\u9650\u5236"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u652F\u6301 Iceberg V1/V2 \u8868\u683C\u5F0F\u3002"}),"\n",(0,i.jsx)(n.li,{children:"V2 \u683C\u5F0F\u4EC5\u652F\u6301 Position Delete \u65B9\u5F0F\uFF0C\u4E0D\u652F\u6301 Equality Delete\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u652F\u6301 Parquet \u6587\u4EF6\u683C\u5F0F"}),"\n"]}),"\n",(0,i.jsxs)(n.version,{since:"dev",children:["\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["\u652F\u6301\u6570\u636E\u5B58\u5728\u5728 GooseFS(GFS) \u4E0A\u7684 iceberg\u8868\u3002\u9700\u914D\u7F6E\u73AF\u5883\uFF1A\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u628Agoosefs-x.x.x-client.jar \u653E\u5728 fe/lib/ \u548C apache_hdfs_broker/lib/ \u4E0B"}),"\n",(0,i.jsx)(n.li,{children:"\u521B\u5EFA catalog \u65F6\u589E\u52A0\u5C5E\u6027\uFF1A'fs.AbstractFileSystem.gfs.impl' = 'com.qcloud.cos.goosefs.hadoop.GooseFileSystem'\uFF0C 'fs.gfs.impl' = 'com.qcloud.cos.goosefs.hadoop.FileSystem'"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u521B\u5EFA-catalog",children:"\u521B\u5EFA Catalog"}),"\n",(0,i.jsx)(n.h3,{id:"\u57FA\u4E8Ehive-metastore\u521B\u5EFAcatalog",children:"\u57FA\u4E8EHive Metastore\u521B\u5EFACatalog"}),"\n",(0,i.jsxs)(n.p,{children:["\u548C Hive Catalog \u57FA\u672C\u4E00\u81F4\uFF0C\u8FD9\u91CC\u4EC5\u7ED9\u51FA\u7B80\u5355\u793A\u4F8B\u3002\u5176\u4ED6\u793A\u4F8B\u53EF\u53C2\u9605 ",(0,i.jsx)(n.a,{href:"/zh-CN/docs/1.2/lakehouse/multi-catalog/hive",children:"Hive Catalog"}),"\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.21.0.1:7004',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:4007',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:4007',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u57FA\u4E8Eiceberg-api\u521B\u5EFAcatalog",children:"\u57FA\u4E8EIceberg API\u521B\u5EFACatalog"}),"\n",(0,i.jsxs)(n.version,{since:"dev",children:["\n",(0,i.jsx)(n.p,{children:"\u4F7F\u7528Iceberg API\u8BBF\u95EE\u5143\u6570\u636E\u7684\u65B9\u5F0F\uFF0C\u652F\u6301Hive\u3001REST\u3001Glue\u7B49\u670D\u52A1\u4F5C\u4E3AIceberg\u7684Catalog\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"hive-metastore\u4F5C\u4E3A\u5143\u6570\u636E\u670D\u52A1",children:"Hive Metastore\u4F5C\u4E3A\u5143\u6570\u636E\u670D\u52A1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type'='hms',\n    'hive.metastore.uris' = 'thrift://172.21.0.1:7004',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:4007',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:4007',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,i.jsx)(n.h4,{id:"glue-catalog\u4F5C\u4E3A\u5143\u6570\u636E\u670D\u52A1",children:"Glue Catalog\u4F5C\u4E3A\u5143\u6570\u636E\u670D\u52A1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE CATALOG glue PROPERTIES (\n"type"="iceberg",\n"iceberg.catalog.type" = "glue",\n"glue.endpoint" = "https://glue.us-east-1.amazonaws.com",\n"warehouse" = "s3://bucket/warehouse",\n"AWS_ENDPOINT" = "s3.us-east-1.amazonaws.com",\n"AWS_REGION" = "us-east-1",\n"AWS_ACCESS_KEY" = "ak",\n"AWS_SECRET_KEY" = "sk",\n"use_path_style" = "true"\n);\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"glue.endpoint"}),": Glue Endpoint. \u53C2\u9605\uFF1A",(0,i.jsx)(n.a,{href:"https://docs.aws.amazon.com/general/latest/gr/glue.html",children:"AWS Glue endpoints and quotas"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"warehouse"}),": Glue Warehouse Location. Glue Catalog\u7684\u6839\u8DEF\u5F84\uFF0C\u7528\u4E8E\u6307\u5B9A\u6570\u636E\u5B58\u653E\u4F4D\u7F6E\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5C5E\u6027\u8BE6\u60C5\u53C2\u89C1 ",(0,i.jsx)(n.a,{href:"https://iceberg.apache.org/docs/latest/aws/#glue-catalog",children:"Iceberg Glue Catalog"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"REST Catalog\u4F5C\u4E3A\u5143\u6570\u636E\u670D\u52A1"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u8BE5\u65B9\u5F0F\u9700\u8981\u9884\u5148\u63D0\u4F9BREST\u670D\u52A1\uFF0C\u7528\u6237\u9700\u5B9E\u73B0\u83B7\u53D6Iceberg\u5143\u6570\u636E\u7684REST\u63A5\u53E3\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type'='rest',\n    'uri' = 'http://172.21.0.1:8181',\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u82E5\u6570\u636E\u5B58\u653E\u5728S3\u4E0A\uFF0Cproperties\u4E2D\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B\u53C2\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'"AWS_ACCESS_KEY" = "ak"\n"AWS_SECRET_KEY" = "sk"\n"AWS_REGION" = "region-name"\n"AWS_ENDPOINT" = "http://endpoint-uri"\n"AWS_CREDENTIALS_PROVIDER" = "provider-class-name" // \u53EF\u9009\uFF0C\u9ED8\u8BA4\u51ED\u8BC1\u7C7B\u57FA\u4E8EBasicAWSCredentials\u5B9E\u73B0\u3002\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5217\u7C7B\u578B\u6620\u5C04",children:"\u5217\u7C7B\u578B\u6620\u5C04"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Iceberg Type"}),(0,i.jsx)(n.th,{children:"Doris Type"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"boolean"}),(0,i.jsx)(n.td,{children:"boolean"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"int"}),(0,i.jsx)(n.td,{children:"int"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"long"}),(0,i.jsx)(n.td,{children:"bigint"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"float"}),(0,i.jsx)(n.td,{children:"float"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"double"}),(0,i.jsx)(n.td,{children:"double"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"decimal(p,s)"}),(0,i.jsx)(n.td,{children:"decimal(p,s)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"date"}),(0,i.jsx)(n.td,{children:"date"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"uuid"}),(0,i.jsx)(n.td,{children:"string"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"timestamp (Timestamp without timezone)"}),(0,i.jsx)(n.td,{children:"datetime(6)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"timestamptz (Timestamp with timezone)"}),(0,i.jsx)(n.td,{children:"datetime(6)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"string"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"fixed(L)"}),(0,i.jsx)(n.td,{children:"char(L)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"binary"}),(0,i.jsx)(n.td,{children:"string"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"list"}),(0,i.jsx)(n.td,{children:"array"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"struct"}),(0,i.jsx)(n.td,{children:"\u4E0D\u652F\u6301"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"map"}),(0,i.jsx)(n.td,{children:"\u4E0D\u652F\u6301"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"time"}),(0,i.jsx)(n.td,{children:"\u4E0D\u652F\u6301"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"time-travel",children:"Time Travel"}),"\n",(0,i.jsxs)(n.version,{since:"1.2.2",children:["\n",(0,i.jsx)(n.p,{children:"\u652F\u6301\u8BFB\u53D6 Iceberg \u8868\u6307\u5B9A\u7684 Snapshot\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u6BCF\u4E00\u6B21\u5BF9iceberg\u8868\u7684\u5199\u64CD\u4F5C\u90FD\u4F1A\u4EA7\u751F\u4E00\u4E2A\u65B0\u7684\u5FEB\u7167\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u8BFB\u53D6\u8BF7\u6C42\u53EA\u4F1A\u8BFB\u53D6\u6700\u65B0\u7248\u672C\u7684\u5FEB\u7167\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u53EF\u4EE5\u4F7F\u7528 ",(0,i.jsx)(n.code,{children:"FOR TIME AS OF"})," \u548C ",(0,i.jsx)(n.code,{children:"FOR VERSION AS OF"})," \u8BED\u53E5\uFF0C\u6839\u636E\u5FEB\u7167 ID \u6216\u8005\u5FEB\u7167\u4EA7\u751F\u7684\u65F6\u95F4\u8BFB\u53D6\u5386\u53F2\u7248\u672C\u7684\u6570\u636E\u3002\u793A\u4F8B\u5982\u4E0B\uFF1A"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:'SELECT * FROM iceberg_tbl FOR TIME AS OF "2022-10-07 17:20:37";'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"SELECT * FROM iceberg_tbl FOR VERSION AS OF 868895038966572;"})}),"\n",(0,i.jsxs)(n.p,{children:["\u53E6\u5916\uFF0C\u53EF\u4EE5\u4F7F\u7528 ",(0,i.jsx)(n.a,{href:"/zh-CN/docs/1.2/sql-manual/sql-functions/table-functions/iceberg_meta",children:"iceberg_meta"})," \u8868\u51FD\u6570\u67E5\u8BE2\u6307\u5B9A\u8868\u7684 snapshot \u4FE1\u606F\u3002"]})]})}function h(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return d},a:function(){return t}});var r=s(667294);let i={},l=r.createContext(i);function t(e){let n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);