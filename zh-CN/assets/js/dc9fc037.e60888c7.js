"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["203466"],{366281:function(e,n,r){r.r(n),r.d(n,{metadata:()=>t,contentTitle:()=>i,default:()=>d,assets:()=>s,toc:()=>a,frontMatter:()=>o});var t=JSON.parse('{"id":"admin-manual/tracing","title":"\u94FE\u8DEF\u8FFD\u8E2A","description":"\x3c!--","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-1.2/admin-manual/tracing.md","sourceDirName":"admin-manual","slug":"/admin-manual/tracing","permalink":"/zh-CN/docs/1.2/admin-manual/tracing","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"\u94FE\u8DEF\u8FFD\u8E2A","language":"zh-CN"},"sidebar":"docs","previous":{"title":"\u67E5\u8BE2\u5206\u6790","permalink":"/zh-CN/docs/1.2/admin-manual/query-profile"},"next":{"title":"\u6027\u80FD\u4F18\u5316","permalink":"/zh-CN/docs/1.2/admin-manual/optimization"}}'),l=r("785893"),c=r("250065");let o={title:"\u94FE\u8DEF\u8FFD\u8E2A",language:"zh-CN"},i=void 0,s={},a=[{value:"\u539F\u7406",id:"\u539F\u7406",level:2},{value:"\u5FEB\u901F\u642D\u5EFA",id:"\u5FEB\u901F\u642D\u5EFA",level:2},{value:"\u90E8\u7F72 zipkin",id:"\u90E8\u7F72-zipkin",level:3},{value:"\u914D\u7F6E\u53CA\u542F\u52A8 Doris",id:"\u914D\u7F6E\u53CA\u542F\u52A8-doris",level:3},{value:"\u6DFB\u52A0\u914D\u7F6E\u5230 fe.conf",id:"\u6DFB\u52A0\u914D\u7F6E\u5230-feconf",level:4},{value:"\u6DFB\u52A0\u914D\u7F6E\u5230 be.conf",id:"\u6DFB\u52A0\u914D\u7F6E\u5230-beconf",level:4},{value:"\u542F\u52A8 fe \u548C be",id:"\u542F\u52A8-fe-\u548C-be",level:4},{value:"\u6267\u884C\u67E5\u8BE2",id:"\u6267\u884C\u67E5\u8BE2",level:3},{value:"\u67E5\u770B zipkin UI",id:"\u67E5\u770B-zipkin-ui",level:3},{value:"\u4F7F\u7528 opentelemetry collector",id:"\u4F7F\u7528-opentelemetry-collector",level:2},{value:"\u90E8\u7F72 opentelemetry collector",id:"\u90E8\u7F72-opentelemetry-collector",level:3},{value:"\u4E0B\u8F7D collector",id:"\u4E0B\u8F7D-collector",level:4},{value:"\u751F\u6210\u914D\u7F6E\u6587\u4EF6",id:"\u751F\u6210\u914D\u7F6E\u6587\u4EF6",level:4},{value:"\u542F\u52A8 collector",id:"\u542F\u52A8-collector",level:4},{value:"\u914D\u7F6E\u53CA\u542F\u52A8 Doris",id:"\u914D\u7F6E\u53CA\u542F\u52A8-doris-1",level:3},{value:"\u6DFB\u52A0\u914D\u7F6E\u5230 fe.conf",id:"\u6DFB\u52A0\u914D\u7F6E\u5230-feconf-1",level:4},{value:"\u6DFB\u52A0\u914D\u7F6E\u5230 be.conf",id:"\u6DFB\u52A0\u914D\u7F6E\u5230-beconf-1",level:4},{value:"\u542F\u52A8 fe \u548C be",id:"\u542F\u52A8-fe-\u548C-be-1",level:4},{value:"\u6267\u884C\u67E5\u8BE2",id:"\u6267\u884C\u67E5\u8BE2-1",level:3},{value:"\u67E5\u770B traces",id:"\u67E5\u770B-traces",level:3}];function p(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,c.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"\u94FE\u8DEF\u8FFD\u8E2A\uFF08tracing\uFF09\u8BB0\u5F55\u4E86\u4E00\u6B21\u8BF7\u6C42\u5728\u7CFB\u7EDF\u4E2D\u7684\u6267\u884C\u7684\u751F\u547D\u5468\u671F\uFF0C\u5305\u62EC\u8BF7\u6C42\u53CA\u5176\u5B50\u8FC7\u7A0B\u8C03\u7528\u94FE\u8DEF\u3001\u6267\u884C\u65F6\u95F4\u53CA\u7EDF\u8BA1\u4FE1\u606F\uFF0C\u53EF\u7528\u4E8E\u6162\u67E5\u8BE2\u5B9A\u4F4D\u3001\u6027\u80FD\u74F6\u9888\u5206\u6790\u7B49\u3002"}),"\n",(0,l.jsx)(n.admonition,{title:"\u6CE8\u610F",type:"caution",children:(0,l.jsx)(n.p,{children:"\u8BE5\u529F\u80FD\u53EA\u7EF4\u62A4\u4E8E Doris 1.2 \u7248\u672C\uFF0C\u81EA Doris 2.0 \u7248\u672C\u8D77\u5DF2\u4E0D\u518D\u652F\u6301\u3002"})}),"\n",(0,l.jsx)(n.h2,{id:"\u539F\u7406",children:"\u539F\u7406"}),"\n",(0,l.jsx)(n.p,{children:"Doris \u8D1F\u8D23\u6536\u96C6 traces\uFF0C\u5E76\u5BFC\u51FA\u5230\u7B2C\u4E09\u65B9\u94FE\u8DEF\u5206\u6790\u7CFB\u7EDF\uFF0C\u7531\u94FE\u8DEF\u5206\u6790\u7CFB\u7EDF\u8D1F\u8D23 traces \u7684\u5C55\u793A\u548C\u5B58\u50A8\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"\u5FEB\u901F\u642D\u5EFA",children:"\u5FEB\u901F\u642D\u5EFA"}),"\n",(0,l.jsxs)(n.p,{children:["Doris \u76EE\u524D\u652F\u6301\u76F4\u63A5\u5C06 traces \u5BFC\u51FA\u5230 ",(0,l.jsx)(n.a,{href:"https://zipkin.io/",children:"zipkin"})," \u4E2D\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"\u90E8\u7F72-zipkin",children:"\u90E8\u7F72 zipkin"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"curl -sSL https://zipkin.io/quickstart.sh | bash -s\njava -jar zipkin.jar\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u914D\u7F6E\u53CA\u542F\u52A8-doris",children:"\u914D\u7F6E\u53CA\u542F\u52A8 Doris"}),"\n",(0,l.jsx)(n.h4,{id:"\u6DFB\u52A0\u914D\u7F6E\u5230-feconf",children:"\u6DFB\u52A0\u914D\u7F6E\u5230 fe.conf"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"# \u5F00\u542F\u94FE\u8DEF\u8FFD\u8E2A\nenable_tracing = true\n\n# \u914D\u7F6Etraces\u5BFC\u51FA\u5230zipkin\ntrace_export_url = http://127.0.0.1:9411/api/v2/spans\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u6DFB\u52A0\u914D\u7F6E\u5230-beconf",children:"\u6DFB\u52A0\u914D\u7F6E\u5230 be.conf"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"# \u5F00\u542F\u94FE\u8DEF\u8FFD\u8E2A\u3002\nenable_tracing = true\n\n# \u914D\u7F6Etraces\u5BFC\u51FA\u5230zipkin\u3002\ntrace_export_url = http://127.0.0.1:9411/api/v2/spans\n\n# \u53EF\u9009\u3002\u7F13\u5B58span\u7684\u961F\u5217\u5927\u5C0F\u3002span\u6570\u91CF\u8FBE\u5230\u961F\u5217\u5BB9\u91CF\u4E00\u534A\u65F6\u5C06\u89E6\u53D1\u4E00\u6B21span\u5BFC\u51FA\uFF0C\u961F\u5217\u6EE1\u540E\u5230\u8FBE\u961F\u5217\u7684span\u5C06\u88AB\u4E22\u5F03\u3002\nmax_span_queue_size=2048\n\n# \u53EF\u9009\u3002\u5355\u6B21\u5BFC\u51FAspan\u7684\u6700\u5927\u6570\u91CF\u3002\nmax_span_export_batch_size=512\n\n# \u53EF\u9009\u3002\u5BFC\u51FAspan\u7684\u6700\u5927\u95F4\u9694\u65F6\u95F4\u3002\nexport_span_schedule_delay_millis=500\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u542F\u52A8-fe-\u548C-be",children:"\u542F\u52A8 fe \u548C be"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sh fe/bin/start_fe.sh --daemon\nsh be/bin/start_be.sh --daemon\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u6267\u884C\u67E5\u8BE2",children:"\u6267\u884C\u67E5\u8BE2"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"...\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u67E5\u770B-zipkin-ui",children:"\u67E5\u770B zipkin UI"}),"\n",(0,l.jsxs)(n.p,{children:["\u6D4F\u89C8\u5668\u6253\u5F00",(0,l.jsx)(n.code,{children:"http://127.0.0.1:9411/zipkin/"})," \u53EF\u67E5\u770B\u67E5\u8BE2\u94FE\u8DEF\u3002"]}),"\n",(0,l.jsx)(n.h2,{id:"\u4F7F\u7528-opentelemetry-collector",children:"\u4F7F\u7528 opentelemetry collector"}),"\n",(0,l.jsxs)(n.p,{children:["\u4F7F\u7528 opentelemetry collector \u53EF\u5C06 traces \u5BFC\u51FA\u5230\u5176\u4ED6\u7CFB\u7EDF\u4F8B\u5982 zipkin\u3001jaeger\u3001skywalking\uFF0C\u6216\u8005\u6570\u636E\u5E93\u7CFB\u7EDF\u548C\u6587\u4EF6\u4E2D\u3002\u8BE6\u60C5\u53C2\u8003 ",(0,l.jsx)(n.a,{href:"https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter",children:"collector exporter"})," \u3002"]}),"\n",(0,l.jsxs)(n.p,{children:["\u540C\u65F6 opentelemetry collector \u63D0\u4F9B\u4E86\u4E30\u5BCC\u7684\u7B97\u5B50\u7528\u6765\u5904\u7406 traces\u3002\u4F8B\u5982",(0,l.jsx)(n.a,{href:"https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/filterprocessor",children:"\u8FC7\u6EE4 spans"})," \u3001",(0,l.jsx)(n.a,{href:"hhttps://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/tailsamplingprocessor",children:"\u5C3E\u91C7\u6837"}),"\u3002\u8BE6\u60C5\u53C2\u8003",(0,l.jsx)(n.a,{href:"https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor",children:"collector processor"}),"\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"traces \u5BFC\u51FA\u7684\u8DEF\u5F84\uFF1Adoris -> collector -> zipkin \u7B49\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"\u90E8\u7F72-opentelemetry-collector",children:"\u90E8\u7F72 opentelemetry collector"}),"\n",(0,l.jsxs)(n.p,{children:["opentelemetry \u53D1\u5E03\u4E86 collector ",(0,l.jsx)(n.a,{href:"https://github.com/open-telemetry/opentelemetry-collector",children:"core"})," \u548C ",(0,l.jsx)(n.a,{href:"https://github.com/open-telemetry/opentelemetry-collector-contrib",children:"contrib"}),", contrib \u63D0\u4F9B\u4E86\u66F4\u4E30\u5BCC\u7684\u529F\u80FD\uFF0C\u8FD9\u91CC\u4EE5 contrib \u7248\u4E3E\u4F8B\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"\u4E0B\u8F7D-collector",children:"\u4E0B\u8F7D collector"}),"\n",(0,l.jsxs)(n.p,{children:["\u4E0B\u8F7D otelcol-contrib\uFF0C\u53EF\u5728\u5B98\u7F51\u4E0B\u8F7D",(0,l.jsx)(n.a,{href:"https://github.com/open-telemetry/opentelemetry-collector-releases/releases",children:"\u66F4\u591A\u5E73\u53F0\u9884\u7F16\u8BD1\u7248"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v0.55.0/otelcol-contrib_0.55.0_linux_amd64.tar.gz\n\ntar -zxvf otelcol-contrib_0.55.0_linux_amd64.tar.gz\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u751F\u6210\u914D\u7F6E\u6587\u4EF6",children:"\u751F\u6210\u914D\u7F6E\u6587\u4EF6"}),"\n",(0,l.jsxs)(n.p,{children:["collector \u914D\u7F6E\u6587\u4EF6\u5206\u4E3A 5 \u90E8\u5206\uFF1A",(0,l.jsx)(n.code,{children:"receivers"}),"\u3001",(0,l.jsx)(n.code,{children:"processors"}),"\u3001",(0,l.jsx)(n.code,{children:"exporters"}),"\u3001",(0,l.jsx)(n.code,{children:"extensions"}),"\u3001",(0,l.jsx)(n.code,{children:"service"}),"\u3002\u5176\u4E2D receivers\u3001processors\u3001exporters \u5206\u522B\u5B9A\u4E49\u4E86\u63A5\u6536\u3001\u5904\u7406\u3001\u5BFC\u51FA\u6570\u636E\u7684\u65B9\u5F0F\uFF1Bextensions \u662F\u53EF\u9009\u7684\uFF0C\u7528\u4E8E\u6269\u5C55\u4E3B\u8981\u7528\u4E8E\u4E0D\u6D89\u53CA\u5904\u7406\u9065\u6D4B\u6570\u636E\u7684\u4EFB\u52A1\uFF1Bservice \u6307\u5B9A\u5728 collector \u4E2D\u4F7F\u7528\u54EA\u4E9B\u7EC4\u4EF6\u3002\u53EF\u53C2\u8003 ",(0,l.jsx)(n.a,{href:"https://opentelemetry.io/docs/collector/deployment/",children:"collector configuration"}),"\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u4E0B\u9762\u914D\u7F6E\u6587\u4EF6\u4F7F\u7528 otlp(OpenTelemetry Protocol) \u534F\u8BAE\u63A5\u6536 traces \u6570\u636E\uFF0C\u8FDB\u884C\u6279\u5904\u7406\u5E76\u8FC7\u6EE4\u6389\u65F6\u95F4\u8D85\u8FC7 50ms \u7684 traces, \u6700\u7EC8\u5BFC\u51FA\u5230 zipkin \u548C\u6587\u4EF6\u4E2D\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'cat > otel-collector-config.yaml << EOF\nreceivers:\n  otlp:\n    protocols:\n      http:\n\nexporters:\n  zipkin:\n    endpoint: "http://10.81.85.90:8791/api/v2/spans"\n  file:\n    path: ./filename.json\n\nprocessors:\n  batch:\n  tail_sampling:\n    policies:\n      {\n        name: duration_policy,\n        type: latency,\n        latency: {threshold_ms: 50}\n      }\n\nextensions:\n\nservice:\n  pipelines:\n    traces:\n      receivers: [otlp]\n      processors: [batch, tail_sampling]\n      exporters: [zipkin, file]\nEOF\n'})}),"\n",(0,l.jsx)(n.h4,{id:"\u542F\u52A8-collector",children:"\u542F\u52A8 collector"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"nohup ./otelcol-contrib --config=otel-collector-config.yaml &\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u914D\u7F6E\u53CA\u542F\u52A8-doris-1",children:"\u914D\u7F6E\u53CA\u542F\u52A8 Doris"}),"\n",(0,l.jsx)(n.h4,{id:"\u6DFB\u52A0\u914D\u7F6E\u5230-feconf-1",children:"\u6DFB\u52A0\u914D\u7F6E\u5230 fe.conf"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"# \u5F00\u542F\u94FE\u8DEF\u8FFD\u8E2A\nenable_tracing = true\n\n# \u542F\u7528opentelemetry collector\u3002\ntrace_exporter = collector\n\n# \u914D\u7F6Etraces\u5BFC\u51FA\u5230collector\uFF0C4318\u4E3Acollector otlp http\u9ED8\u8BA4\u7AEF\u53E3\u3002\ntrace_export_url = http://127.0.0.1:4318/v1/traces\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u6DFB\u52A0\u914D\u7F6E\u5230-beconf-1",children:"\u6DFB\u52A0\u914D\u7F6E\u5230 be.conf"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"# \u5F00\u542F\u94FE\u8DEF\u8FFD\u8E2A\u3002\nenable_tracing = true\n\n# \u542F\u7528opentelemetry collector\u3002\ntrace_exporter = collector\n\n# \u914D\u7F6Etraces\u5BFC\u51FA\u5230collector\uFF0C4318\u4E3Acollector otlp http\u9ED8\u8BA4\u7AEF\u53E3\u3002\ntrace_export_url = http://127.0.0.1:4318/v1/traces\n\n# \u53EF\u9009\u3002\u7F13\u5B58span\u7684\u961F\u5217\u5927\u5C0F\u3002span\u6570\u91CF\u8FBE\u5230\u961F\u5217\u5BB9\u91CF\u4E00\u534A\u65F6\u5C06\u89E6\u53D1\u4E00\u6B21span\u5BFC\u51FA\uFF0C\u961F\u5217\u6EE1\u540E\u5230\u8FBE\u961F\u5217\u7684span\u5C06\u88AB\u4E22\u5F03\u3002\nmax_span_queue_size=2048\n\n# \u53EF\u9009\u3002\u5355\u6B21\u5BFC\u51FAspan\u7684\u6700\u5927\u6570\u91CF\u3002\nmax_span_export_batch_size=512\n\n# \u53EF\u9009\u3002\u5BFC\u51FAspan\u7684\u6700\u5927\u95F4\u9694\u65F6\u95F4\u3002\nexport_span_schedule_delay_millis=500\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u542F\u52A8-fe-\u548C-be-1",children:"\u542F\u52A8 fe \u548C be"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sh fe/bin/start_fe.sh --daemon\nsh be/bin/start_be.sh --daemon\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u6267\u884C\u67E5\u8BE2-1",children:"\u6267\u884C\u67E5\u8BE2"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"...\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u67E5\u770B-traces",children:"\u67E5\u770B traces"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"...\n"})})]})}function d(e={}){let{wrapper:n}={...(0,c.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(p,{...e})}):p(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return i},a:function(){return o}});var t=r(667294);let l={},c=t.createContext(l);function o(e){let n=t.useContext(c);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);