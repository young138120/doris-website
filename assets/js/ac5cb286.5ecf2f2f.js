"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["259983"],{569104:function(e,t,n){n.r(t),n.d(t,{metadata:()=>r,contentTitle:()=>o,default:()=>h,assets:()=>d,toc:()=>l,frontMatter:()=>s});var r=JSON.parse('{"id":"data-operate/update-delete/update","title":"update","description":"\x3c!--","source":"@site/versioned_docs/version-1.2/data-operate/update-delete/update.md","sourceDirName":"data-operate/update-delete","slug":"/data-operate/update-delete/update","permalink":"/docs/1.2/data-operate/update-delete/update","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"update","language":"en"},"sidebar":"docs","previous":{"title":"Batch Delete","permalink":"/docs/1.2/data-operate/update-delete/batch-delete-manual"},"next":{"title":"Delete","permalink":"/docs/1.2/data-operate/update-delete/delete-manual"}}'),a=n("785893"),i=n("250065");let s={title:"update",language:"en"},o="Update",d={},l=[{value:"Applicable scenarios",id:"applicable-scenarios",level:2},{value:"Fundamentals",id:"fundamentals",level:2},{value:"Synchronization",id:"synchronization",level:3},{value:"Performance",id:"performance",level:3},{value:"Concurrency Control",id:"concurrency-control",level:3},{value:"Risks of use",id:"risks-of-use",level:2},{value:"Usage example",id:"usage-example",level:2},{value:"Update primary key column",id:"update-primary-key-column",level:2},{value:"More Help",id:"more-help",level:2}];function c(e){let t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"update",children:"Update"})}),"\n",(0,a.jsxs)(t.p,{children:["This article mainly describes how to use the UPDATE command to operate if we need to modify or update the data in Doris. The data update is limited to the version of Doris and can only be used in Doris ",(0,a.jsx)(t.strong,{children:"Version 0.15.x +"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"applicable-scenarios",children:"Applicable scenarios"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Modify its value for rows that meet certain conditions;"}),"\n",(0,a.jsx)(t.li,{children:"Point update, small range update, the row to be updated is preferably a very small part of the entire table;"}),"\n",(0,a.jsx)(t.li,{children:"The update command can only be executed on a table with a Unique data model."}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"fundamentals",children:"Fundamentals"}),"\n",(0,a.jsx)(t.p,{children:"Use the query engine's own where filtering logic to filter the rows that need to be updated from the table to be updated. Then use the Unique model's own Value column replacement logic to change the rows to be updated and reinsert them into the table. This enables row-level updates."}),"\n",(0,a.jsx)(t.h3,{id:"synchronization",children:"Synchronization"}),"\n",(0,a.jsx)(t.p,{children:"The Update syntax is a synchronization syntax in Doris. If the Update statement succeeds, the update succeeds and the data is visible."}),"\n",(0,a.jsx)(t.h3,{id:"performance",children:"Performance"}),"\n",(0,a.jsx)(t.p,{children:"The performance of the Update statement is closely related to the number of rows to be updated and the retrieval efficiency of the condition."}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Number of rows to be updated: The more rows to be updated, the slower the Update statement will be. This is consistent with the principle of importing.\nDoris updates are more suitable for occasional update scenarios, such as changing the values of individual rows.\nDoris is not suitable for large batches of data changes. Large modifications can make Update statements take a long time to run."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Condition retrieval efficiency: Doris Update implements the principle of reading the rows that satisfy the condition first, so if the condition retrieval efficiency is high, the Update will be faster.\nThe condition column should ideally be hit, indexed, or bucket clipped. This way Doris does not need to scan the entire table and can quickly locate the rows that need to be updated. This improves update efficiency.\nIt is strongly discouraged to include the UNIQUE model value column in the condition column."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"concurrency-control",children:"Concurrency Control"}),"\n",(0,a.jsx)(t.p,{children:"By default, multiple concurrent Update operations on the same table are not allowed at the same time."}),"\n",(0,a.jsxs)(t.p,{children:["The main reason for this is that Doris currently supports row updates, which means that even if the user declares ",(0,a.jsx)(t.code,{children:"SET v2 = 1"}),", virtually all other Value columns will be overwritten (even though the values are not changed)."]}),"\n",(0,a.jsx)(t.p,{children:"This presents a problem in that if two Update operations update the same row at the same time, the behavior may be indeterminate. That is, there may be dirty data."}),"\n",(0,a.jsxs)(t.p,{children:["However, in practice, the concurrency limit can be turned on manually if the user himself can guarantee that even if concurrent updates are performed, they will not operate on the same row at the same time. This is done by modifying the FE configuration ",(0,a.jsx)(t.code,{children:"enable_concurrent_update"}),". When the configuration value is true, there is no limit on concurrent updates."]}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsx)(t.p,{children:"Note: After enabling the configuration, there will be certain performance risks. You can refer to the performance section above to improve update efficiency."}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"risks-of-use",children:"Risks of use"}),"\n",(0,a.jsx)(t.p,{children:"Since Doris currently supports row updates and uses a two-step read-and-write operation, there is uncertainty about the outcome of an Update statement if it modifies the same row as another Import or Delete statement."}),"\n",(0,a.jsxs)(t.p,{children:["Therefore, when using Doris, you must be careful to control the concurrency of Update statements and other DML statements on the ",(0,a.jsx)(t.strong,{children:"user side itself"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"usage-example",children:"Usage example"}),"\n",(0,a.jsx)(t.p,{children:"Suppose there is an order table in Doris, where the order id is the Key column, the order status and the order amount are the Value column. The data status is as follows:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"order id"}),(0,a.jsx)(t.th,{children:"order amount"}),(0,a.jsx)(t.th,{children:"order status"})]})}),(0,a.jsx)(t.tbody,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"1"}),(0,a.jsx)(t.td,{children:"100"}),(0,a.jsx)(t.td,{children:"Pending Payment"})]})})]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:"+----------+--------------+--------------+\n| order_id | order_amount | order_status |\n+----------+--------------+--------------+\n| 1        |          100 | \u5F85\u4ED8\u6B3E       |\n+----------+--------------+--------------+\n1 row in set (0.01 sec)\n"})}),"\n",(0,a.jsx)(t.p,{children:"At this time, after the user clicks to pay, the Doris system needs to change the status of the order with the order id '1' to 'Pending Shipping', and the Update function needs to be used."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:"mysql> UPDATE test_order SET order_status = 'Pending Shipping' WHERE order_id = 1;\nQuery OK, 1 row affected (0.11 sec)\n{'label':'update_20ae22daf0354fe0-b5aceeaaddc666c5', 'status':'VISIBLE', 'txnId':'33', 'queryId':'20ae22daf0354fe0-b5aceeaaddc666c5'}\n"})}),"\n",(0,a.jsx)(t.p,{children:"The result after the update is as follows"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:"+----------+--------------+------------------+\n| order_id | order_amount | order_status     |\n+----------+--------------+------------------+\n| 1        |          100 | Pending Shipping |\n+----------+--------------+------------------+\n1 row in set (0.01 sec)\n"})}),"\n",(0,a.jsx)(t.p,{children:"After the user executes the UPDATE command, the system performs the following three steps."}),"\n",(0,a.jsx)(t.p,{children:"Step 1: Read the rows that satisfy WHERE order id=1 (1, 100, 'pending payment')\nStep 2: Change the order status of the row from 'Pending Payment' to 'Pending Shipping' (1, 100, 'Pending shipment')\nStep 3: Insert the updated row back into the table to achieve the updated effect."}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"order id"}),(0,a.jsx)(t.th,{children:"order amount"}),(0,a.jsx)(t.th,{children:"order status"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"1"}),(0,a.jsx)(t.td,{children:"100"}),(0,a.jsx)(t.td,{children:"Pending Payment"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"1"}),(0,a.jsx)(t.td,{children:"100"}),(0,a.jsx)(t.td,{children:"Pending shipments"})]})]})]}),"\n",(0,a.jsx)(t.p,{children:"Since the table order is a UNIQUE model, the rows with the same Key, after which the latter will take effect, so the final effect is as follows."}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"order id"}),(0,a.jsx)(t.th,{children:"order amount"}),(0,a.jsx)(t.th,{children:"order status"})]})}),(0,a.jsx)(t.tbody,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"1"}),(0,a.jsx)(t.td,{children:"100"}),(0,a.jsx)(t.td,{children:"Pending shipments"})]})})]}),"\n",(0,a.jsx)(t.h2,{id:"update-primary-key-column",children:"Update primary key column"}),"\n",(0,a.jsxs)(t.p,{children:["Currently, the Update operation only supports updating the Value column, and the update of the Key column can refer to ",(0,a.jsx)(t.a,{href:"/docs/1.2/ecosystem/flink-doris-connector#Use-FlinkCDC-to-update-Key-column",children:"Using FlinkCDC to update key column"})]}),"\n",(0,a.jsx)(t.h2,{id:"more-help",children:"More Help"}),"\n",(0,a.jsxs)(t.p,{children:["For more detailed syntax used by ",(0,a.jsx)(t.strong,{children:"data update"}),", please refer to the ",(0,a.jsx)(t.a,{href:"/docs/1.2/sql-manual/sql-reference/Data-Manipulation-Statements/Manipulation/UPDATE",children:"update"})," command manual , you can also enter ",(0,a.jsx)(t.code,{children:"HELP UPDATE"})," in the Mysql client command line to get more help information."]})]})}function h(e={}){let{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return o},a:function(){return s}});var r=n(667294);let a={},i=r.createContext(a);function s(e){let t=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);