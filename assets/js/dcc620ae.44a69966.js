"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["929148"],{570708:function(e,n,i){i.r(n),i.d(n,{metadata:()=>r,contentTitle:()=>a,default:()=>h,assets:()=>d,toc:()=>o,frontMatter:()=>l});var r=JSON.parse('{"id":"query-acceleration/materialized-view/async-materialized-view/functions-and-demands","title":"Functions and Demands","description":"\x3c!--","source":"@site/docs/query-acceleration/materialized-view/async-materialized-view/functions-and-demands.md","sourceDirName":"query-acceleration/materialized-view/async-materialized-view","slug":"/query-acceleration/materialized-view/async-materialized-view/functions-and-demands","permalink":"/docs/dev/query-acceleration/materialized-view/async-materialized-view/functions-and-demands","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Functions and Demands","language":"en"},"sidebar":"docs","previous":{"title":"Overview","permalink":"/docs/dev/query-acceleration/materialized-view/async-materialized-view/overview"},"next":{"title":"Use Guide","permalink":"/docs/dev/query-acceleration/materialized-view/async-materialized-view/use-guide"}}'),t=i("785893"),s=i("250065");let l={title:"Functions and Demands",language:"en"},a=void 0,d={},o=[{value:"DDL and Basic Operations",id:"ddl-and-basic-operations",level:2},{value:"Create Materialized View:",id:"create-materialized-view",level:3},{value:"2 Alter Materialized View",id:"2-alter-materialized-view",level:3},{value:"3 Drop Materialized View",id:"3-drop-materialized-view",level:3},{value:"4 Refresh Materialized View",id:"4-refresh-materialized-view",level:3},{value:"5 Pause Materialized View",id:"5-pause-materialized-view",level:3},{value:"6 Resume Materialized View",id:"6-resume-materialized-view",level:3},{value:"7 Cancel Refresh Task",id:"7-cancel-refresh-task",level:3},{value:"Metadata Querying",id:"metadata-querying",level:2},{value:"Permission",id:"permission",level:2},{value:"Materialized Refresh Support in Data Lakes",id:"materialized-refresh-support-in-data-lakes",level:2},{value:"Materialized Views and OLAP Internal Tables",id:"materialized-views-and-olap-internal-tables",level:2},{value:"Direct Querying",id:"direct-querying",level:2},{value:"Rewriting Query",id:"rewriting-query",level:2},{value:"Condition Compensation",id:"condition-compensation",level:3},{value:"JOIN Rewriting",id:"join-rewriting",level:3},{value:"JOIN Derivation",id:"join-derivation",level:3},{value:"Aggregation Rewriting",id:"aggregation-rewriting",level:3},{value:"Roll-Up Aggregation Rewriting",id:"roll-up-aggregation-rewriting",level:3},{value:"Multi-Dimensional Aggregation Rewriting",id:"multi-dimensional-aggregation-rewriting",level:3},{value:"Partition Compensation Rewriting",id:"partition-compensation-rewriting",level:3},{value:"Nested Materialized View Rewriting",id:"nested-materialized-view-rewriting",level:3},{value:"Explain Query Rewriting",id:"explain-query-rewriting",level:2},{value:"Reference",id:"reference",level:2},{value:"Materialized View Related Configuration",id:"materialized-view-related-configuration",level:3}];function c(e){let n={a:"a",admonition:"admonition",code:"code",div:"div",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"This document provides a comprehensive overview of Materialized View DDL (Data Definition Language) operations, metadata querying, permission requirements, data lake refresh support, relationships with OLAP internal tables, direct querying, query rewriting capabilities, and basic commands."}),"\n",(0,t.jsx)(n.h2,{id:"ddl-and-basic-operations",children:"DDL and Basic Operations"}),"\n",(0,t.jsx)(n.h3,{id:"create-materialized-view",children:"Create Materialized View:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["1. Refer to ",(0,t.jsx)(n.a,{href:"../../../sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-ASYNC-MATERIALIZED-VIEW",children:"CREATE ASYNC MATERIALIZED VIEW"})]})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. New Attribute"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"use_for_rewrite:: Indicates whether this materialized view participates in transparent rewriting. If set to false, it does not participate in transparent rewriting; the default is true. In data modeling scenarios, if the materialized view is only used for direct queries, this attribute can be set for the materialized view to prevent it from participating in transparent rewriting, thereby improving query response speed."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"3. Partitioned Materialized Views"})}),"\n",(0,t.jsxs)(n.p,{children:["When creating a partitioned materialized view, only the ",(0,t.jsx)(n.code,{children:"date_trunc"})," function and constants are allowed for expressions referencing the partition field. The following statement meets the requirements:"]}),"\n",(0,t.jsxs)(n.p,{children:["The column referenced by the partition field only uses the ",(0,t.jsx)(n.code,{children:"date_trunc"})," function."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW mv_1 BUILD IMMEDIATE REFRESH AUTO ON MANUAL     \nPARTITION BY (date_alias)     \nDISTRIBUTED BY RANDOM BUCKETS 2     \nPROPERTIES ('replication_num' = '1')     \nAS     \nSELECT     \n  l_linestatus,     \n  date_trunc(o_orderdate) AS date_alias,     \n  o_shippriority     \nFROM     \n  orders     \n  LEFT JOIN lineitem ON l_orderkey = o_orderkey;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The following example cannot create a partitioned materialized view because the expression referencing the partition field uses the ",(0,t.jsx)(n.code,{children:"to_date"})," function:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW mv_1 BUILD IMMEDIATE REFRESH AUTO ON MANUAL     \nPARTITION BY (date_alias)     \nDISTRIBUTED BY RANDOM BUCKETS 2     \nPROPERTIES ('replication_num' = '1')     \nAS     \nSELECT     \n  l_linestatus,     \n  to_date(o_orderdate) AS date_alias,     \n  o_shippriority     \nFROM     \n  orders     \n  LEFT JOIN lineitem ON l_orderkey = o_orderkey;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-alter-materialized-view",children:"2 Alter Materialized View"}),"\n",(0,t.jsxs)(n.p,{children:["Refer to ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/docs/sql-manual/sql-statements/Data-Definition-Statements/Alter/ALTER-ASYNC-MATERIALIZED-VIEW",children:"ALTER ASYNC MATERIALIZED VIEW"})]}),"\n",(0,t.jsx)(n.h3,{id:"3-drop-materialized-view",children:"3 Drop Materialized View"}),"\n",(0,t.jsxs)(n.p,{children:["Refer to ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/docs/sql-manual/sql-statements/Data-Definition-Statements/Drop/DROP-ASYNC-MATERIALIZED-VIEW",children:"DROP ASYNC MATERIALIZED VIEW"})]}),"\n",(0,t.jsx)(n.h3,{id:"4-refresh-materialized-view",children:"4 Refresh Materialized View"}),"\n",(0,t.jsxs)(n.p,{children:["Refer to ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/docs/sql-manual/sql-statements/Utility-Statements/REFRESH-MATERIALIZED-VIEW/",children:"REFRESH MATERIALIZED VIEW"})]}),"\n",(0,t.jsx)(n.h3,{id:"5-pause-materialized-view",children:"5 Pause Materialized View"}),"\n",(0,t.jsxs)(n.p,{children:["Refer to ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/docs/sql-manual/sql-statements/Utility-Statements/PAUSE-MATERIALIZED-VIEW",children:"PAUSE MATERIALIZED VIEW"})]}),"\n",(0,t.jsx)(n.h3,{id:"6-resume-materialized-view",children:"6 Resume Materialized View"}),"\n",(0,t.jsxs)(n.p,{children:["Refer to ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/docs/sql-manual/sql-statements/Utility-Statements/RESUME-MATERIALIZED-VIEW",children:"RESUME MATERIALIZED VIEW"})]}),"\n",(0,t.jsx)(n.h3,{id:"7-cancel-refresh-task",children:"7 Cancel Refresh Task"}),"\n",(0,t.jsxs)(n.p,{children:["Refer to ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/docs/sql-manual/sql-statements/Utility-Statements/CANCEL-MATERIALIZED-VIEW-TASK",children:"CANCEL MATERIALIZED VIEW TASK"})]}),"\n",(0,t.jsx)(n.h2,{id:"metadata-querying",children:"Metadata Querying"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Query Materialized View Information: use ",(0,t.jsx)(n.a,{href:"../../../sql-manual/sql-functions/table-valued-functions/mv-infos",children:"MV_INFOS"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Query Task Information: use ",(0,t.jsx)(n.a,{href:"../../../sql-manual/sql-functions/table-valued-functions/tasks?_highlight=task",children:"TASKS"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Query Job Information Related to Materialized View: use ",(0,t.jsx)(n.a,{href:"../../../sql-manual/sql-functions/table-valued-functions/jobs",children:"JOBS"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Query Partition Information: use ",(0,t.jsx)(n.a,{href:"../../../sql-manual/sql-statements/Show-Statements/SHOW-PARTITIONS",children:"SHOW PARTITIONS"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["View Table Structure: use ",(0,t.jsx)(n.a,{href:"../../../sql-manual/sql-statements/Utility-Statements/DESCRIBE",children:"DESCRIBE"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["View Creation Statement: use ",(0,t.jsx)(n.a,{href:"../../../sql-manual/sql-statements/Show-Statements/SHOW-CREATE-MATERIALIZED-VIEW/",children:"SHOW CREATE MATERIALIZED VIEW"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"permission",children:"Permission"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create Materialized View: requires permission to create materialized views (similar to creating tables) and execute the underlying SELECT query (similar to SELECT permission)."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Delete Materialized View: requires permission to delete materialized views (similar to deleting tables)."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Alter Materialized View: requires permission to modify materialized views (similar to modifying tables)."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Pause/Resume/Cancel/Refresh Materialized View: requires permission to create materialized views."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"materialized-refresh-support-in-data-lakes",children:"Materialized Refresh Support in Data Lakes"}),"\n",(0,t.jsx)(n.p,{children:"The level of support for materialized refresh varies by table type and catalog:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Table Type"}),(0,t.jsx)(n.th,{children:"Catalog Type"}),(0,t.jsx)(n.th,{children:"Full Refresh"}),(0,t.jsx)(n.th,{children:"Partition Refresh"}),(0,t.jsx)(n.th,{children:"Triggered Refresh"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Internal"}),(0,t.jsx)(n.td,{children:"Internal"}),(0,t.jsx)(n.td,{children:"Supported since 2.1"}),(0,t.jsx)(n.td,{children:"Supported since 2.1"}),(0,t.jsx)(n.td,{children:"Supported since 2.1.4"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"External"}),(0,t.jsx)(n.td,{children:"Hive"}),(0,t.jsx)(n.td,{children:"Supported since 2.1"}),(0,t.jsx)(n.td,{children:"Supported since 2.1"}),(0,t.jsx)(n.td,{children:"Not Supported"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Iceberg"}),(0,t.jsx)(n.td,{children:"Supported"}),(0,t.jsx)(n.td,{children:"Not Supported"}),(0,t.jsx)(n.td,{children:"Not Supported"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Paimon"}),(0,t.jsx)(n.td,{children:"Supported"}),(0,t.jsx)(n.td,{children:"Not Supported"}),(0,t.jsx)(n.td,{children:"Not Supported"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Hudi"}),(0,t.jsx)(n.td,{children:"Supported"}),(0,t.jsx)(n.td,{children:"Not Supported"}),(0,t.jsx)(n.td,{children:"Not Supported"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"JDBC"}),(0,t.jsx)(n.td,{children:"Supported"}),(0,t.jsx)(n.td,{children:"Not Supported"}),(0,t.jsx)(n.td,{children:"Not Supported"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"ES"}),(0,t.jsx)(n.td,{children:"Supported"}),(0,t.jsx)(n.td,{children:"Not Supported"}),(0,t.jsx)(n.td,{children:"Not Supported"}),(0,t.jsx)(n.td,{})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"materialized-views-and-olap-internal-tables",children:"Materialized Views and OLAP Internal Tables"}),"\n",(0,t.jsx)(n.div,{children:(0,t.jsx)(n.p,{children:"Since version 2.1.4, materialized views support the Duplicate model."})}),"\n",(0,t.jsx)(n.p,{children:"Materialized views are implemented as OLAP tables using the Duplicate model. This means they theoretically support all DUPLICATE model features. However, certain restrictions apply to ensure efficient data refreshes:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Materialized view partitions are automatically created and maintained based on their base tables; manual partitioning is not allowed."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Operations like ",(0,t.jsx)(n.code,{children:"DELETE TABLE"})," or ",(0,t.jsx)(n.code,{children:"RENAME TABLE"})," cannot be used directly on materialized views due to associated jobs; use materialized view-specific commands instead."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Column data types are derived from the query and cannot be modified, as this may cause refresh tasks to fail."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Materialized views have properties unique to them, which must be modified using materialized view commands. Common properties are modified using ",(0,t.jsx)(n.code,{children:"ALTER TABLE"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Commands like ",(0,t.jsx)(n.code,{children:"DESC"})," and ",(0,t.jsx)(n.code,{children:"SHOW PARTITIONS"})," can be used to view materialized view descriptions and partition information."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Materialized views support index creation."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Synchronous materialized views can be created based on existing materialized views."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"direct-querying",children:"Direct Querying"}),"\n",(0,t.jsx)(n.p,{children:"The create table statement is as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE IF NOT EXISTS lineitem (\n    l_orderkey    integer not null,\n    l_partkey     integer not null,\n    l_suppkey     integer not null,\n    l_linenumber  integer not null,\n    l_quantity    decimalv3(15,2) not null,\n    l_extendedprice  decimalv3(15,2) not null,\n    l_discount    decimalv3(15,2) not null,\n    l_tax         decimalv3(15,2) not null,\n    l_returnflag  char(1) not null,\n    l_linestatus  char(1) not null,\n    l_shipdate    date not null,\n    l_commitdate  date not null,\n    l_receiptdate date not null,\n    l_shipinstruct char(25) not null,\n    l_shipmode     char(10) not null,\n    l_comment      varchar(44) not null\n    )\n    DUPLICATE KEY(l_orderkey, l_partkey, l_suppkey, l_linenumber)\n    PARTITION BY RANGE(l_shipdate)\n(FROM ('2023-10-17') TO ('2023-11-01') INTERVAL 1 DAY)\n    DISTRIBUTED BY HASH(l_orderkey) BUCKETS 3\n    PROPERTIES (\"replication_num\" = \"1\");\n\ninsert into lineitem values\n(1, 2, 3, 4, 5.5, 6.5, 7.5, 8.5, 'o', 'k', '2023-10-17', '2023-10-17', '2023-10-17', 'a', 'b', 'yyyyyyyyy'),\n(2, 4, 3, 4, 5.5, 6.5, 7.5, 8.5, 'o', 'k', '2023-10-18', '2023-10-18', '2023-10-18', 'a', 'b', 'yyyyyyyyy'),\n(3, 2, 4, 4, 5.5, 6.5, 7.5, 8.5, 'o', 'k', '2023-10-19', '2023-10-19', '2023-10-19', 'a', 'b', 'yyyyyyyyy');\nCREATE TABLE IF NOT EXISTS orders  (\n    o_orderkey       integer not null,\n    o_custkey        integer not null,\n    o_orderstatus    char(1) not null,\n    o_totalprice     decimalv3(15,2) not null,\n    o_orderdate      date not null,\n    o_orderpriority  char(15) not null,\n    o_clerk          char(15) not null,\n    o_shippriority   integer not null,\n    o_comment        varchar(79) not null\n    )\n    DUPLICATE KEY(o_orderkey, o_custkey)\n    PARTITION BY RANGE(o_orderdate)(\n    FROM ('2023-10-17') TO ('2023-11-01') INTERVAL 1 DAY)\n    DISTRIBUTED BY HASH(o_orderkey) BUCKETS 3\n    PROPERTIES (\"replication_num\" = \"1\");\n\n    insert into orders values\n    (1, 1, 'o', 9.5, '2023-10-17', 'a', 'b', 1, 'yy'),\n    (1, 1, 'o', 10.5, '2023-10-18', 'a', 'b', 1, 'yy'),\n    (2, 1, 'o', 11.5, '2023-10-19', 'a', 'b', 1, 'yy'),\n    (3, 1, 'o', 12.5, '2023-10-19', 'a', 'b', 1, 'yy');\n    CREATE TABLE IF NOT EXISTS partsupp (\n      ps_partkey     INTEGER NOT NULL,\n      ps_suppkey     INTEGER NOT NULL,\n      ps_availqty    INTEGER NOT NULL,\n      ps_supplycost  DECIMALV3(15,2)  NOT NULL,\n      ps_comment     VARCHAR(199) NOT NULL \n    )\n    DUPLICATE KEY(ps_partkey, ps_suppkey)\n    DISTRIBUTED BY HASH(ps_partkey) BUCKETS 3\n    PROPERTIES (\n      \"replication_num\" = \"1\"\n    );\n\n    insert into partsupp values\n    (2, 3, 9, 10.01, 'supply1'),\n    (4, 3, 10, 11.01, 'supply2'),\n    (2, 3, 10, 11.01, 'supply3');\n"})}),"\n",(0,t.jsx)(n.p,{children:"Materialized Views can be queried directly like tables."}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. Materialized View Definition:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW mv1\nBUILD IMMEDIATE REFRESH AUTO ON SCHEDULE EVERY 1 hour\nDISTRIBUTED BY RANDOM BUCKETS 3\nPROPERTIES ('replication_num' = '1')\nAS\nSELECT t1.l_linenumber,\n       o_custkey,\n       o_orderdate\nFROM (SELECT * FROM lineitem WHERE l_linenumber > 1) t1\nLEFT OUTER JOIN orders\nON l_orderkey = o_orderkey;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For more details, refer to  ",(0,t.jsx)(n.a,{href:"../../../sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-ASYNC-MATERIALIZED-VIEW",children:"CREATE-ASYNC-MATERIALIZED-VIEW"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. Query Statement:"})}),"\n",(0,t.jsx)(n.p,{children:"Materialized Views allow the addition of filter conditions and aggregate/rollup commands for direct querying"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT\nl_linenumber,\no_custkey\nFROM mv1\nWHERE l_linenumber > 1 and o_orderdate = '2023-10-18';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"rewriting-query",children:"Rewriting Query"}),"\n",(0,t.jsx)(n.h3,{id:"condition-compensation",children:"Condition Compensation"}),"\n",(0,t.jsxs)(n.p,{children:["When the ",(0,t.jsx)(n.code,{children:"WHERE"})," conditions of the materialized view and query are connected by ",(0,t.jsx)(n.code,{children:"AND"}),":"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. If the query's conditions contain those of the materialized view:"})}),"\n",(0,t.jsx)(n.p,{children:"Compensation is possible."}),"\n",(0,t.jsxs)(n.p,{children:["For example, if the query is ",(0,t.jsx)(n.code,{children:"a > 5 AND b > 10 AND c = 7"})," and the materialized view's conditions are ",(0,t.jsx)(n.code,{children:"a > 5 AND b > 10"}),", only ",(0,t.jsx)(n.code,{children:"c = 7"})," needs to be added."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. If the query's conditions can be derived from the materialized view's conditions:"})}),"\n",(0,t.jsx)(n.p,{children:"Compensation is also possible."}),"\n",(0,t.jsxs)(n.p,{children:["For example, if the query is ",(0,t.jsx)(n.code,{children:"a > 5 AND b = 10"})," and the materialized view is ",(0,t.jsx)(n.code,{children:"a > 1 AND b > 8"}),", compensation is feasible since the materialized view's conditions encompass the query's."]}),"\n",(0,t.jsx)(n.p,{children:"Limitations:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Conditions connected by OR cannot be compensated; they must match exactly."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Non-comparative and range expressions like LIKE cannot be compensated; they must match exactly."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"join-rewriting",children:"JOIN Rewriting"}),"\n",(0,t.jsx)(n.p,{children:"JOIN rewriting applies when the query and materialized view use the same tables. The optimizer attempts transparent rewriting for such queries."}),"\n",(0,t.jsx)(n.p,{children:"Supported JOIN types include:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"INNER JOIN"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"LEFT OUTER JOIN"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"RIGHT OUTER JOIN"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"FULL OUTER JOIN"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"LEFT SEMI JOIN"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"RIGHT SEMI JOIN"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"LEFT ANTI JOIN"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"RIGHT ANTI JOIN"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"join-derivation",children:"JOIN Derivation"}),"\n",(0,t.jsx)(n.p,{children:"When JOIN types differ but the materialized view provides all necessary data, rewriting is possible with predicate compensation outside the JOIN."}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. Create Materialized view"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW mv3\nBUILD IMMEDIATE REFRESH AUTO ON SCHEDULE EVERY 1 hour\nDISTRIBUTED BY RANDOM BUCKETS 3\nPROPERTIES ('replication_num' = '1')\nAS\nSELECT\n    l_shipdate, l_suppkey, o_orderdate,\n    sum(o_totalprice) AS sum_total,\n    max(o_totalprice) AS max_total,\n    min(o_totalprice) AS min_total,\n    count(*) AS count_all,\n    count(distinct CASE WHEN o_shippriority > 1 AND o_orderkey IN (1, 3) THEN o_custkey ELSE null END) AS bitmap_union_basic\nFROM lineitem\nLEFT OUTER JOIN orders ON lineitem.l_orderkey = orders.o_orderkey AND l_shipdate = o_orderdate\nGROUP BY\nl_shipdate,\nl_suppkey,\no_orderdate;\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. Query statement"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT\n    l_shipdate, l_suppkey, o_orderdate,\n    sum(o_totalprice) AS sum_total,\n    max(o_totalprice) AS max_total,\n    min(o_totalprice) AS min_total,\n    count(*) AS count_all,\n    count(distinct CASE WHEN o_shippriority > 1 AND o_orderkey IN (1, 3) THEN o_custkey ELSE null END) AS bitmap_union_basic\nFROM lineitem\nINNER JOIN orders ON lineitem.l_orderkey = orders.o_orderkey AND l_shipdate = o_orderdate\nWHERE o_orderdate = '2023-10-18' AND l_suppkey = 3\nGROUP BY\nl_shipdate,\nl_suppkey,\no_orderdate;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"aggregation-rewriting",children:"Aggregation Rewriting"}),"\n",(0,t.jsx)(n.p,{children:"Rewriting occurs when the group dimensions match between the query and materialized view, and the aggregation functions are compatible."}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsxs)(n.p,{children:["The following query can be transparently rewritten because the aggregation dimensions used in the query and the materialized view are consistent. The materialized view's ",(0,t.jsx)(n.code,{children:"o_shippriority"})," field can be used to filter the results. The ",(0,t.jsx)(n.code,{children:"GROUP BY"})," dimensions and aggregation functions in the query can be rewritten using the ",(0,t.jsx)(n.code,{children:"GROUP BY"})," dimensions and aggregation functions of the materialized view."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. Create Materialized View"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW mv4\nBUILD IMMEDIATE REFRESH AUTO ON SCHEDULE EVERY 1 hour\nDISTRIBUTED BY RANDOM BUCKETS 3\nPROPERTIES ('replication_num' = '1')\nAS\nSELECT\n    o_shippriority, o_comment,\n    count(distinct CASE WHEN o_shippriority > 1 AND o_orderkey IN (1, 3) THEN o_custkey ELSE null END) AS cnt_1,\n    count(distinct CASE WHEN O_SHIPPRIORITY > 2 AND o_orderkey IN (2) THEN o_custkey ELSE null END) AS cnt_2,\n    sum(o_totalprice),\n    max(o_totalprice),\n    min(o_totalprice),\n    count(*)\nFROM orders\nGROUP BY\no_shippriority,\no_comment;\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. Query Statement"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT \n    o_shippriority, o_comment,\n    count(distinct CASE WHEN o_shippriority > 1 AND o_orderkey IN (1, 3) THEN o_custkey ELSE null END) AS cnt_1,\n    count(distinct CASE WHEN O_SHIPPRIORITY > 2 AND o_orderkey IN (2) THEN o_custkey ELSE null END) AS cnt_2,\n    sum(o_totalprice),\n    max(o_totalprice),\n    min(o_totalprice),\n    count(*)\nFROM orders\nWHERE o_shippriority in (1, 2)\nGROUP BY\no_shippriority,\no_comment;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"roll-up-aggregation-rewriting",children:"Roll-Up Aggregation Rewriting"}),"\n",(0,t.jsxs)(n.p,{children:["In the definition of a query and a materialized view, even if the aggregation dimensions do not align, rewriting is still possible. The ",(0,t.jsx)(n.code,{children:"GROUP BY"})," dimensions used in the materialized view need to encompass those used in the query, though the query itself may not contain a ",(0,t.jsx)(n.code,{children:"GROUP BY"})," clause. Additionally, the aggregation functions used in the query can be represented using the aggregation functions from the materialized view."]}),"\n",(0,t.jsx)(n.p,{children:"Here is an example:"}),"\n",(0,t.jsxs)(n.p,{children:["The following query can be transparently rewritten. The aggregation dimensions used in the query and the materialized view do not align, but the dimensions used in the materialized view encompass those in the query. The query can filter results using fields within the dimensions. The query will attempt to roll up functions after the ",(0,t.jsx)(n.code,{children:"SELECT"})," in the materialized view. For instance, ",(0,t.jsx)(n.code,{children:"bitmap_union"})," in the materialized view can be rolled up to ",(0,t.jsx)(n.code,{children:"bitmap_union_count"}),", which aligns with the semantics of ",(0,t.jsx)(n.code,{children:"count(distinct)"})," in the query."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. Create Materialized View:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW mv5\nBUILD IMMEDIATE REFRESH AUTO ON SCHEDULE EVERY 1 hour\nDISTRIBUTED BY RANDOM BUCKETS 3\nPROPERTIES ('replication_num' = '1')\nAS\nSELECT\n    l_shipdate, o_orderdate, l_partkey, l_suppkey,\n    sum(o_totalprice) AS sum_total,\n    max(o_totalprice) AS max_total,\n    min(o_totalprice) AS min_total,\n    count(*) AS count_all,\n    bitmap_union(to_bitmap(CASE WHEN o_shippriority > 1 AND o_orderkey IN (1, 3) THEN o_custkey ELSE null END)) AS bitmap_union_basic\nFROM lineitem\nLEFT OUTER JOIN orders ON lineitem.l_orderkey = orders.o_orderkey AND l_shipdate = o_orderdate\nGROUP BY\nl_shipdate,\no_orderdate,\nl_partkey,\nl_suppkey;\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. Query Statement:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT\n    l_shipdate, l_suppkey,\n    sum(o_totalprice) AS sum_total,\n    max(o_totalprice) AS max_total,\n    min(o_totalprice) AS min_total,\n    count(*) AS count_all,\n    count(distinct CASE WHEN o_shippriority > 1 AND o_orderkey IN (1, 3) THEN o_custkey ELSE null END) AS bitmap_union_basic\nFROM lineitem\nLEFT OUTER JOIN orders ON lineitem.l_orderkey = orders.o_orderkey AND l_shipdate = o_orderdate\nWHERE o_orderdate = '2023-10-18' AND l_partkey = 3\nGROUP BY\nl_shipdate,\nl_suppkey;\n"})}),"\n",(0,t.jsx)(n.p,{children:"The currently supported list of aggregation roll-up functions is as follows:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Function in Querying"}),(0,t.jsx)(n.th,{children:"Function in MV"}),(0,t.jsx)(n.th,{children:"\u51FD\u6570\u4E0A\u5377\u540E"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"max"}),(0,t.jsx)(n.td,{children:"max"}),(0,t.jsx)(n.td,{children:"max"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"min"}),(0,t.jsx)(n.td,{children:"min"}),(0,t.jsx)(n.td,{children:"min"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"sum"}),(0,t.jsx)(n.td,{children:"sum"}),(0,t.jsx)(n.td,{children:"sum"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"count"}),(0,t.jsx)(n.td,{children:"count"}),(0,t.jsx)(n.td,{children:"sum"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"count(distinct)"}),(0,t.jsx)(n.td,{children:"bitmap_union"}),(0,t.jsx)(n.td,{children:"bitmap_union_count"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"bitmap_union"}),(0,t.jsx)(n.td,{children:"bitmap_union"}),(0,t.jsx)(n.td,{children:"bitmap_union"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"bitmap_union_count"}),(0,t.jsx)(n.td,{children:"bitmap_union"}),(0,t.jsx)(n.td,{children:"bitmap_union_count"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"hll_union_agg, approx_count_distinct, hll_cardinality"}),(0,t.jsx)(n.td,{children:"hll_union \u6216\u8005 hll_raw_agg"}),(0,t.jsx)(n.td,{children:"hll_union_agg"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"multi-dimensional-aggregation-rewriting",children:"Multi-Dimensional Aggregation Rewriting"}),"\n",(0,t.jsx)(n.p,{children:"Rewriting is supported for multi-dimensional aggregations if the materialized view's GROUP BY fields cover all those in the query."}),"\n",(0,t.jsx)(n.p,{children:"Here is an example:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. Create Materialized View:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW mv5_1\nBUILD IMMEDIATE REFRESH AUTO ON SCHEDULE EVERY 1 hour\nDISTRIBUTED BY RANDOM BUCKETS 3\nPROPERTIES ('replication_num' = '1')\nAS\nselect o_orderstatus, o_orderdate, o_orderpriority,\n       sum(o_totalprice) as sum_total,\n       max(o_totalprice) as max_total,\n       min(o_totalprice) as min_total,\n       count(*) as count_all\nfrom orders\ngroup by\no_orderstatus, o_orderdate, o_orderpriority;\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. Query Statement:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"select o_orderstatus, o_orderdate, o_orderpriority,\n       sum(o_totalprice),\n       max(o_totalprice),\n       min(o_totalprice),\n       count(*)\nfrom orders\ngroup by\nGROUPING SETS ((o_orderstatus, o_orderdate), (o_orderpriority), (o_orderstatus), ());\n"})}),"\n",(0,t.jsx)(n.h3,{id:"partition-compensation-rewriting",children:"Partition Compensation Rewriting"}),"\n",(0,t.jsxs)(n.p,{children:["When a partitioned materialized view does not provide all the data required for a query, the ",(0,t.jsx)(n.code,{children:"UNION ALL"})," operation can be used to combine the data from the original query table and the materialized view, with the result of this union serving as the final output."]}),"\n",(0,t.jsx)(n.p,{children:"For example"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. Create Materialized view"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW mv7\nBUILD IMMEDIATE REFRESH AUTO ON MANUAL\npartition by(l_shipdate)\nDISTRIBUTED BY RANDOM BUCKETS 2\nPROPERTIES ('replication_num' = '1') \nas\nselect l_shipdate, o_orderdate, l_partkey,\n       l_suppkey, sum(o_totalprice) as sum_total\nfrom lineitem\n         left join orders on lineitem.l_orderkey = orders.o_orderkey and l_shipdate = o_orderdate\ngroup by\n    l_shipdate,\n    o_orderdate,\n    l_partkey,\n    l_suppkey;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5F53\u57FA\u8868\u65B0\u589E\u5206\u533A ",(0,t.jsx)(n.code,{children:"2023-10-21"})," \u65F6\uFF0C\u5E76\u4E14\u7269\u5316\u89C6\u56FE\u8FD8\u672A\u5237\u65B0\u65F6\uFF0C\u53EF\u4EE5\u901A\u8FC7\u7269\u5316\u89C6\u56FE ",(0,t.jsx)(n.code,{children:"union all"})," \u539F\u8868\u7684\u65B9\u5F0F\u8FD4\u56DE\u7ED3\u679C\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"insert into lineitem values\n    (1, 2, 3, 4, 5.5, 6.5, 7.5, 8.5, 'o', 'k', '2023-10-21', '2023-10-21', '2023-10-21', 'a', 'b', 'yyyyyyyyy');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. Run Query"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"select l_shipdate, o_orderdate, l_partkey, l_suppkey, sum(o_totalprice) as sum_total\nfrom lineitem\n         left join orders on lineitem.l_orderkey = orders.o_orderkey and l_shipdate = o_orderdate\ngroup by\n    l_shipdate,\n    o_orderdate,\n    l_partkey,\n    l_suppkey;\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"3. Result"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT *\nFROM mv7\nunion all\nselect t1.l_shipdate, o_orderdate, t1.l_partkey, t1.l_suppkey, sum(o_totalprice) as sum_total\nfrom (select * from lineitem where l_shipdate = '2023-10-21') t1\n         left join orders on t1.l_orderkey = orders.o_orderkey and t1.l_shipdate = o_orderdate\ngroup by\n    t1.l_shipdate,\n    o_orderdate,\n    t1.l_partkey,\n    t1.l_suppkey;\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"caution",children:[(0,t.jsx)(n.p,{children:"Currently, partition compensation is supported, but conditional UNION ALL compensation is not yet supported."}),(0,t.jsxs)(n.p,{children:["For example, if the materialized view has a WHERE condition, taking the previous example, if the materialized view's filtering condition includes ",(0,t.jsx)(n.code,{children:"WHERE l_shipdate > '2023-10-19'"}),", but the query condition is ",(0,t.jsx)(n.code,{children:"WHERE l_shipdate > '2023-10-18'"}),", currently, this scenario cannot be compensated using UNION ALL. This feature is pending support."]})]}),"\n",(0,t.jsx)(n.h3,{id:"nested-materialized-view-rewriting",children:"Nested Materialized View Rewriting"}),"\n",(0,t.jsx)(n.p,{children:"The SQL definition of a materialized view can utilize other materialized views, referred to as nested materialized views. There is theoretically no limit to the number of nesting levels, and such materialized views can be queried directly or transparently rewritten. Nested materialized views are also eligible for transparent rewriting."}),"\n",(0,t.jsx)(n.p,{children:"Here's an example:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["1. Create the inner nested materialized view ",(0,t.jsx)(n.code,{children:"mv8_0_inner_mv"}),":"]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW mv8_0_inner_mv\nBUILD IMMEDIATE REFRESH COMPLETE ON MANUAL\nDISTRIBUTED BY RANDOM BUCKETS 2\nPROPERTIES ('replication_num' = '1')\nAS\nselect\nl_linenumber,\no_custkey,\no_orderkey,\no_orderstatus,\nl_partkey,\nl_suppkey,\nl_orderkey\nfrom lineitem\ninner join orders on lineitem.l_orderkey = orders.o_orderkey;\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["2. Create the outer nested materialized view ",(0,t.jsx)(n.code,{children:"mv8_0"}),":"]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW mv8_0\nBUILD IMMEDIATE REFRESH COMPLETE ON MANUAL\nDISTRIBUTED BY RANDOM BUCKETS 2\nPROPERTIES ('replication_num' = '1') \nAS\nselect\nl_linenumber,\no_custkey,\no_orderkey,\no_orderstatus,\nl_partkey,\nl_suppkey,\nl_orderkey,\nps_availqty\nfrom mv8_0_inner_mv\ninner join partsupp on l_partkey = ps_partkey AND l_suppkey = ps_suppkey;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For the following query, both ",(0,t.jsx)(n.code,{children:"mv8_0_inner_mv"})," and ",(0,t.jsx)(n.code,{children:"mv8_0"})," will be successfully rewritten, with the cost-based optimizer ultimately selecting ",(0,t.jsx)(n.code,{children:"mv8_0"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"select lineitem.l_linenumber\nfrom lineitem\ninner join orders on l_orderkey = o_orderkey\ninner join partsupp on  l_partkey = ps_partkey AND l_suppkey = ps_suppkey\nwhere o_orderstatus = 'o'\n"})}),"\n",(0,t.jsx)(n.p,{children:"Notes:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"As the number of nesting levels increases, the time required for transparent rewriting also increases. It is recommended to limit nested materialized views to no more than 3 levels."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Transparent rewriting for nested materialized views is disabled by default. Refer to the switch settings below for enabling it."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"explain-query-rewriting",children:"Explain Query Rewriting"}),"\n",(0,t.jsx)(n.p,{children:"Query Rewrite Hit Analysis for Debugging and Inspection"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"1. To view the hit analysis of materialized view rewrite for debugging and inspection, execute the following statement, which provides a brief overview of the query rewrite process."})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"explain <query_sql> \n"})}),"\n",(0,t.jsx)(n.p,{children:"The returned information is shown below, with a snippet focusing on materialized view-related details:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"| MaterializedView                                                                                             |\n| MaterializedViewRewriteSuccessAndChose:                                                                      |\n|   Names: mv5                                                                                                 |\n| MaterializedViewRewriteSuccessButNotChose:                                                                   |\n|                                                                                                              |\n| MaterializedViewRewriteFail:                                                                                 |\n|   Name: mv4                                                                                                  |\n|   FailSummary: Match mode is invalid, View struct info is invalid                                            |\n|   Name: mv3                                                                                                  |\n|   FailSummary: Match mode is invalid, Rewrite compensate predicate by view fail, View struct info is invalid |\n|   Name: mv1                                                                                                  |\n|   FailSummary: The columns used by query are not in view, View struct info is invalid                        |\n|   Name: mv2                                                                                                  |\n|   FailSummary: The columns used by query are not in view, View struct info is invalid                        |\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"MaterializedViewRewriteSuccessAndChose: Indicates successful rewrite where the Cost-Based Optimizer (CBO) selected a materialized view. Lists the names of the materialized views chosen by the CBO."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"MaterializedViewRewriteSuccessButNotChose: Indicates successful rewrite but the CBO ultimately did not select any of these materialized views. Lists the names of these materialized views."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"MaterializedViewRewriteFail: Summarizes the instances where rewrite failed, including the reasons for failure."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"2. To gain a detailed understanding of the candidate selection, rewrite process, and final choice made by the CBO for materialized views, execute the following statement:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"explain memo plan <query_sql>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,t.jsx)(n.h3,{id:"materialized-view-related-configuration",children:"Materialized View Related Configuration"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Configuration"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SET enable_nereids_planner = true;"}),(0,t.jsx)(n.td,{children:"Enables the new optimizer required for materialized view rewriting."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SET enable_materialized_view_rewrite = true;"}),(0,t.jsx)(n.td,{children:"Enables or disables query rewriting. Default: Enabled."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SET materialized_view_rewrite_enable_contain_external_table = true;"}),(0,t.jsx)(n.td,{children:"Allows materialized views containing external tables to participate in rewriting. Default: Disabled."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SET materialized_view_rewrite_success_candidate_num = 3;"}),(0,t.jsx)(n.td,{children:"Maximum number of successful rewrite candidates considered by CBO. Default: 3."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SET enable_materialized_view_union_rewrite = true;"}),(0,t.jsx)(n.td,{children:"Allows UNION ALL between base tables and materialized views when data is insufficient. Default: Enabled."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SET enable_materialized_view_nest_rewrite = true;"}),(0,t.jsx)(n.td,{children:"Enables nested materialized view rewriting. Default: Disabled."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SET materialized_view_relation_mapping_max_count = 8;"}),(0,t.jsx)(n.td,{children:"Maximum number of relation mappings during rewriting. Default: 8."})]})]})]})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return a},a:function(){return l}});var r=i(667294);let t={},s=r.createContext(t);function l(e){let n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);