"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["827539"],{324602:function(e,t,n){n.r(t),n.d(t,{metadata:()=>i,contentTitle:()=>a,default:()=>h,assets:()=>r,toc:()=>o,frontMatter:()=>d});var i=JSON.parse('{"id":"data-operate/update-delete/delete-manual","title":"Delete","description":"\x3c!--","source":"@site/versioned_docs/version-1.2/data-operate/update-delete/delete-manual.md","sourceDirName":"data-operate/update-delete","slug":"/data-operate/update-delete/delete-manual","permalink":"/docs/1.2/data-operate/update-delete/delete-manual","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"Delete","language":"en"},"sidebar":"docs","previous":{"title":"update","permalink":"/docs/1.2/data-operate/update-delete/update"},"next":{"title":"Sequence Column","permalink":"/docs/1.2/data-operate/update-delete/sequence-column-manual"}}'),s=n("785893"),l=n("250065");let d={title:"Delete",language:"en"},a="Delete",r={},o=[{value:"Syntax",id:"syntax",level:2},{value:"Delete Result",id:"delete-result",level:2},{value:"Delete operation related FE configuration",id:"delete-operation-related-fe-configuration",level:2},{value:"Show delete history",id:"show-delete-history",level:2},{value:"Note",id:"note",level:3},{value:"More Help",id:"more-help",level:2}];function c(e){let t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"delete",children:"Delete"})}),"\n",(0,s.jsx)(t.p,{children:"Delete is different from other import methods. It is a synchronization process, similar to Insert into. All Delete operations are an independent import job in Doris. Generally, the Delete statement needs to specify the table and partition and delete conditions to filter the data to be deleted. , and will delete the data of the base table and the rollup table at the same time."}),"\n",(0,s.jsx)(t.h2,{id:"syntax",children:"Syntax"}),"\n",(0,s.jsxs)(t.p,{children:["Please refer to the official website for the ",(0,s.jsx)(t.a,{href:"/docs/1.2/sql-manual/sql-reference/Data-Manipulation-Statements/Manipulation/DELETE",children:"DELETE"})," syntax of the delete operation."]}),"\n",(0,s.jsx)(t.h2,{id:"delete-result",children:"Delete Result"}),"\n",(0,s.jsx)(t.p,{children:"The delete command is an SQL command, and the returned results are synchronous. It can be divided into the following types:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Successful visible"}),"\n",(0,s.jsxs)(t.p,{children:["If delete completes successfully and is visible, the following results will be returned, ",(0,s.jsx)(t.code,{children:"query OK"})," indicates success."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"mysql> delete from test_tbl PARTITION p1 where k1 = 1;\n Query OK, 0 rows affected (0.04 sec)\n {'label':'delete_e7830c72-eb14-4cb9-bbb6-eebd4511d251', 'status':'VISIBLE', 'txnId':'4005'}\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Submitted successfully, but not visible"}),"\n",(0,s.jsx)(t.p,{children:"The transaction submission of Doris is divided into two steps: submission and publish version. Only after the publish version step is completed, the result will be visible to the user. If it has been submitted successfully, then it can be considered that the publish version step will eventually success. Doris will try to wait for publishing for a period of time after submitting. If it has timed out, even if the publishing version has not been completed, it will return to the user in priority and prompt the user that the submission has been completed but not visible. If delete has been committed and executed, but has not been published and visible, the following results will be returned."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"mysql> delete from test_tbl PARTITION p1 where k1 = 1;\nQuery OK, 0 rows affected (0.04 sec)\n{'label':'delete_e7830c72-eb14-4cb9-bbb6-eebd4511d251', 'status':'COMMITTED', 'txnId':'4005', 'err':'delete job is committed but may be taking effect later' }\n"})}),"\n",(0,s.jsx)(t.p,{children:"The result will return a JSON string at the same time:"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"affected rows"}),": Indicates the row affected by this deletion. Since the deletion of Doris is currently a logical deletion, the value is always 0."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"label"}),": The label generated automatically to be the signature of the delete jobs. Each job has a unique label within a single database."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"status"}),": Indicates whether the data deletion is visible. If it is visible, ",(0,s.jsx)(t.code,{children:"visible"})," will be displayed. If it is not visible, ",(0,s.jsx)(t.code,{children:"committed"})," will be displayed."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"txnId"}),": The transaction ID corresponding to the delete job"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"err"}),": Field will display some details of this deletion"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Commit failed, transaction cancelled"}),"\n",(0,s.jsx)(t.p,{children:"If the delete statement is not submitted successfully, it will be automatically aborted by Doris and the following results will be returned"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"mysql> delete from test_tbl partition p1 where k1 > 80;\nERROR 1064 (HY000): errCode = 2, detailMessage = {\u9519\u8BEF\u539F\u56E0}\n"})}),"\n",(0,s.jsx)(t.p,{children:"example:"}),"\n",(0,s.jsxs)(t.p,{children:["A timeout deletion will return the timeout and unfinished replicas displayed as ",(0,s.jsx)(t.code,{children:" (tablet = replica)"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"mysql> delete from test_tbl partition p1 where k1 > 80;\nERROR 1064 (HY000): errCode = 2, detailMessage = failed to delete replicas from job: 4005, Unfinished replicas:10000=60000, 10001=60000, 10002=60000\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"The correct processing logic for the returned results of the delete operation is as follows:"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["If ",(0,s.jsx)(t.code,{children:"Error 1064 (HY000)"})," is returned, deletion fails"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["If the returned result is ",(0,s.jsx)(t.code,{children:"Query OK"}),", the deletion is successful"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["If ",(0,s.jsx)(t.code,{children:"status"})," is ",(0,s.jsx)(t.code,{children:"committed"}),", the data deletion is committed and will be eventually invisible. Users can wait for a while and then use the ",(0,s.jsx)(t.code,{children:"show delete"})," command to view the results."]}),"\n",(0,s.jsxs)(t.li,{children:["If ",(0,s.jsx)(t.code,{children:"status"})," is ",(0,s.jsx)(t.code,{children:"visible"}),", the data have been deleted successfully."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"delete-operation-related-fe-configuration",children:"Delete operation related FE configuration"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"TIMEOUT configuration"})}),"\n",(0,s.jsx)(t.p,{children:"In general, Doris's deletion timeout is limited from 30 seconds to 5 minutes. The specific time can be adjusted through the following configuration items"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.code,{children:"tablet_delete_timeout_second"})}),"\n",(0,s.jsx)(t.p,{children:"The timeout of delete itself can be elastically changed by the number of tablets in the specified partition. This configuration represents the average timeout contributed by a tablet. The default value is 2."}),"\n",(0,s.jsx)(t.p,{children:"Assuming that there are 5 tablets under the specified partition for this deletion, the timeout time available for the deletion is 10 seconds. Because the minimum timeout is 30 seconds which is higher than former timeout time, the final timeout is 30 seconds."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.code,{children:"load_straggler_wait_second"})}),"\n",(0,s.jsx)(t.p,{children:"If the user estimates a large amount of data, so that the upper limit of 5 minutes is insufficient, the user can adjust the upper limit of timeout through this item, and the default value is 300."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"The specific calculation rule of timeout(seconds)"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.code,{children:"TIMEOUT = MIN(load_straggler_wait_second, MAX(30, tablet_delete_timeout_second * tablet_num))"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.code,{children:"query_timeout"})}),"\n",(0,s.jsxs)(t.p,{children:["Because delete itself is an SQL command, the deletion statement is also limited by the session variables, and the timeout is also affected by the session value ",(0,s.jsx)(t.code,{children:"query'timeout"}),". You can increase the value by ",(0,s.jsx)(t.code,{children:"set query'timeout = xxx"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"InPredicate configuration"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.code,{children:"max_allowed_in_element_num_of_delete"})}),"\n",(0,s.jsx)(t.p,{children:"If the user needs to take a lot of elements when using the in predicate, the user can adjust the upper limit of the allowed in elements number, and the default value is 1024."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"show-delete-history",children:"Show delete history"}),"\n",(0,s.jsx)(t.p,{children:"The user can view the deletion completed in history through the show delete statement."}),"\n",(0,s.jsx)(t.p,{children:"Syntax"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"SHOW DELETE [FROM db_name]\n"})}),"\n",(0,s.jsx)(t.p,{children:"example"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:'mysql> show delete from test_db;\n+-----------+---------------+---------------------+-----------------+----------+\n| TableName | PartitionName | CreateTime          | DeleteCondition | State    |\n+-----------+---------------+---------------------+-----------------+----------+\n| empty_tbl | p3            | 2020-04-15 23:09:35 | k1 EQ "1"       | FINISHED |\n| test_tbl  | p4            | 2020-04-15 23:09:53 | k1 GT "80"      | FINISHED |\n+-----------+---------------+---------------------+-----------------+----------+\n2 rows in set (0.00 sec)\n'})}),"\n",(0,s.jsx)(t.h3,{id:"note",children:"Note"}),"\n",(0,s.jsxs)(t.p,{children:["Unlike the Insert into command, delete cannot specify ",(0,s.jsx)(t.code,{children:"label"})," manually. For the concept of label, see the ",(0,s.jsx)(t.a,{href:"/docs/1.2/data-operate/import/import-way/insert-into-manual",children:"Insert Into"})," documentation."]}),"\n",(0,s.jsx)(t.h2,{id:"more-help",children:"More Help"}),"\n",(0,s.jsxs)(t.p,{children:["For more detailed syntax used by ",(0,s.jsx)(t.strong,{children:"delete"}),", see the ",(0,s.jsx)(t.a,{href:"/docs/1.2/sql-manual/sql-reference/Data-Manipulation-Statements/Manipulation/DELETE",children:"delete"})," command manual, You can also enter ",(0,s.jsx)(t.code,{children:"HELP DELETE"})," in the Mysql client command line to get more help information"]})]})}function h(e={}){let{wrapper:t}={...(0,l.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return a},a:function(){return d}});var i=n(667294);let s={},l=i.createContext(s);function d(e){let t=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),i.createElement(l.Provider,{value:t},e.children)}}}]);