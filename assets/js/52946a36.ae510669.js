"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["717681"],{509430:function(e,n,o){o.r(n),o.d(n,{metadata:()=>t,contentTitle:()=>a,default:()=>u,assets:()=>d,toc:()=>l,frontMatter:()=>i});var t=JSON.parse('{"id":"install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-fdb","title":"Install FoundationDB","description":"\x3c!--","source":"@site/docs/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-fdb.md","sourceDirName":"install/cluster-deployment/k8s-deploy/compute-storage-decoupled","slug":"/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-fdb","permalink":"/docs/dev/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-fdb","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Install FoundationDB","language":"en"},"sidebar":"docs","previous":{"title":"Deploy on Kubernetes","permalink":"/docs/dev/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-quickstart"},"next":{"title":"Config Metaservice","permalink":"/docs/dev/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/config-ms"}}'),r=o("785893"),s=o("250065");let i={title:"Install FoundationDB",language:"en"},a=void 0,d={},l=[{value:"Deploy FoundationDB on Kubernetes",id:"deploy-foundationdb-on-kubernetes",level:2},{value:"Step 1: Create FoundationDBCluster CRDs",id:"step-1-create-foundationdbcluster-crds",level:3},{value:"Step 2: Deploy fdb-kubernetes-operator service",id:"step-2-deploy-fdb-kubernetes-operator-service",level:3},{value:"Step 3: Deploy FoundationDB cluster",id:"step-3-deploy-foundationdb-cluster",level:3},{value:"Step 4: Check FoundationDB status",id:"step-4-check-foundationdb-status",level:3},{value:"Retrieve the ConfigMap containing FoundationDB access information",id:"retrieve-the-configmap-containing-foundationdb-access-information",level:2}];function c(e){let n={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"FoundationDB is a distributed database developed by Apple that provides strong consistency for structured data storage. In the Doris compute-storage decoupling model, FoundationDB is used as the metadata store, with the meta-service component managing the metadata within FoundationDB. When deploying a compute-storage decoupled cluster on Kubernetes, FoundationDB must be deployed in advance. Two deployment options are recommended:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Deploying FoundationDB directly on virtual machines (including physical machines)."}),"\n",(0,r.jsxs)(n.li,{children:["Using the ",(0,r.jsx)(n.a,{href:"https://github.com/FoundationDB/fdb-kubernetes-operator",children:"fdb-kubernetes-operator"})," to deploy FoundationDB on Kubernetes."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For VM deployments, refer to the Doris ",(0,r.jsx)(n.a,{href:"/docs/dev/compute-storage-decoupled/before-deployment",children:"compute-storage decoupling documentation's Pre-deployment section"})," to set up the FoundationDB cluster. Before deployment, ensure that FoundationDB can be accessed by the Doris Kubernetes cluster, i.e., the Kubernetes nodes should be on the same subnet as the machine where FoundationDB is deployed."]}),"\n",(0,r.jsx)(n.h2,{id:"deploy-foundationdb-on-kubernetes",children:"Deploy FoundationDB on Kubernetes"}),"\n",(0,r.jsx)(n.p,{children:"The deployment of a FoundationDB cluster on Kubernetes involves four main steps:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Create FoundationDBCluster CRDs."}),"\n",(0,r.jsx)(n.li,{children:"Deploy fdb-kubernetes-operator service."}),"\n",(0,r.jsx)(n.li,{children:"Deploy FoundationDB cluster."}),"\n",(0,r.jsx)(n.li,{children:"Check FoundationDB status."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-foundationdbcluster-crds",children:"Step 1: Create FoundationDBCluster CRDs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl create -f https://raw.githubusercontent.com/FoundationDB/fdb-kubernetes-operator/main/config/crd/bases/apps.foundationdb.org_foundationdbclusters.yaml\nkubectl create -f https://raw.githubusercontent.com/FoundationDB/fdb-kubernetes-operator/main/config/crd/bases/apps.foundationdb.org_foundationdbbackups.yaml\nkubectl create -f https://raw.githubusercontent.com/FoundationDB/fdb-kubernetes-operator/main/config/crd/bases/apps.foundationdb.org_foundationdbrestores.yaml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-deploy-fdb-kubernetes-operator-service",children:"Step 2: Deploy fdb-kubernetes-operator service"}),"\n",(0,r.jsxs)(n.p,{children:["The fdb-kubernetes-operator repository provides deployment samples for setting up an FoundationDB cluster in IP mode. The Doris-operator repository offers FoundationDB cluster deployment examples in ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-sethostnameasfqdn-field",children:"FQDN mode"}),", which can be downloaded as needed."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Download the deployment sample:"}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["From the fdb-kubernetes-operator official repository:",(0,r.jsx)(n.br,{}),"\nThe fdb-kubernetes-operator by default deploys FoundationDB in IP mode. You can download the ",(0,r.jsx)(n.a,{href:"https://raw.githubusercontent.com/foundationdb/fdb-kubernetes-operator/main/config/samples/deployment.yaml",children:"default deployment configuration"})," in YAML format. If you wish to deploy using FQDN mode, refer to the ",(0,r.jsx)(n.a,{href:"https://github.com/FoundationDB/fdb-kubernetes-operator/blob/main/docs/manual/customization.md#using-dns",children:"official documentation's DNS section"})," for customization.\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"wget -O fdb-operator.yaml https://raw.githubusercontent.com/foundationdb/fdb-kubernetes-operator/main/config/samples/deployment.yaml\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["From the doris-operator repository:",(0,r.jsx)(n.br,{}),"\nThe doris-operator repository provides deployment examples based on fdb-kubernetes-operator version 1.46.0. These examples can be used directly to deploy FoundationDB clusters.\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"wget https://raw.githubusercontent.com/apache/doris-operator/master/config/operator/fdb-operator.yaml\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["Deploy the fdb-kubernetes-operator Service:",(0,r.jsx)(n.br,{}),"\nAfter customizing the fdb-kubernetes-operator deployment YAML, use the following command to deploy the ",(0,r.jsx)(n.code,{children:"fdb-kubernetes-operator"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f fdb-operator.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Expected Results:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"serviceaccount/fdb-kubernetes-operator-controller-manager created\nclusterrole.rbac.authorization.k8s.io/fdb-kubernetes-operator-manager-clusterrole created\nclusterrole.rbac.authorization.k8s.io/fdb-kubernetes-operator-manager-role created\nrolebinding.rbac.authorization.k8s.io/fdb-kubernetes-operator-manager-rolebinding created\nclusterrolebinding.rbac.authorization.k8s.io/fdb-kubernetes-operator-manager-clusterrolebinding created\ndeployment.apps/fdb-kubernetes-operator-controller-manager created\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-deploy-foundationdb-cluster",children:"Step 3: Deploy FoundationDB cluster"}),"\n",(0,r.jsx)(n.p,{children:"Deployment examples for FoundationDB are available in the fdb-kubernetes-operator repository. You can download and use them directly."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Download the IP mode deployment sample from the FoundationDB official website:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"wget https://raw.githubusercontent.com/foundationdb/fdb-kubernetes-operator/main/config/samples/cluster.yaml\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Customized deployment example:"}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["For environments with access to Docker Hub:",(0,r.jsx)(n.br,{}),"\nCustomize the final deployment state according to the ",(0,r.jsx)(n.a,{href:"https://github.com/FoundationDB/fdb-kubernetes-operator/blob/main/docs/manual/index.md",children:"User Manual"})," provided by the official website. If you use FQDN deployment, please set the ",(0,r.jsx)(n.code,{children:"routing.useDNSInClusterFile"})," field to true and configure as follows:",(0,r.jsx)(n.br,{}),"\nDoris Operator's official repository provides a sample for deploying FoundationDB with ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-sethostnameasfqdn-field",children:"FQDN"}),", which can be downloaded directly from ",(0,r.jsx)(n.a,{href:"https://github.com/apache/doris-operator/blob/master/doc/examples/disaggregated/fdb/cluster.yaml",children:"here"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  routing:\n  useDNSInClusterFile: true\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["For private networks:",(0,r.jsx)(n.br,{}),"\nIf the environment cannot directly access Docker Hub, download the necessary images from the official FoundationDB repository and push them to a private registry.",(0,r.jsx)(n.br,{}),"\nThe fdb-kubernetes-operator depends on the following Docker images:",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.a,{href:"https://hub.docker.com/r/foundationdb/fdb-kubernetes-operator",children:"foundationdb/fdb-kubernetes-operator"}),(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.a,{href:"https://hub.docker.com/r/foundationdb/foundationdb-kubernetes-sidecar",children:"foundationdb/foundationdb-kubernetes-sidecar"}),(0,r.jsx)(n.br,{}),"\nThe FoundationDB images include:",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.a,{href:"https://hub.docker.com/r/foundationdb/foundationdb",children:"foundationdb/foundationdb"}),(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.a,{href:"https://hub.docker.com/r/foundationdb/foundationdb-kubernetes-sidecar",children:"foundationdb/foundationdb-kubernetes-sidecar"}),(0,r.jsx)(n.br,{}),"\nAfter pushing the images to your private registry, follow the official fdb-kubernetes-operator documentation to ",(0,r.jsx)(n.a,{href:"https://github.com/FoundationDB/fdb-kubernetes-operator/blob/main/docs/manual/customization.md#customizing-the-foundationdb-image",children:"customize the image configuration"}),".\nExample configuration to add private registry image configurations:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  mainContainer:\n    imageConfigs:\n    - baseImage: foundationdb/foundationdb\n      tag: 7.1.38\n  sidecarContainer:\n    imageConfigs:\n    - baseImage: foundationdb/foundationdb-kubernetes-sidecar\n      tag: 7.1.36-1\n  version: 7.1.38\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{title:"Tip",type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"In a private environment, when FoundationDB is pushed to a private repository, the tag must be consistent with the official one, for example: 7.1.38."}),"\n",(0,r.jsxs)(n.li,{children:["When deploying FoundationDB, FoundationDBCluster resources, ",(0,r.jsx)(n.code,{children:".spec.version"})," must be configured."]}),"\n",(0,r.jsx)(n.li,{children:"When FoundationDB is deployed based on fdb-kubernetes-operator, at least three hosts are required to meet the high availability requirements of the production environment."}),"\n"]})}),"\n",(0,r.jsx)(n.h3,{id:"step-4-check-foundationdb-status",children:"Step 4: Check FoundationDB status"}),"\n",(0,r.jsx)(n.p,{children:"After deploying FoundationDB via the fdb-kubernetes-operator, check the status of the FoundationDB cluster with the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl get fdb\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The expected results are as follows. If ",(0,r.jsx)(n.code,{children:"AVAILABLE"})," is ",(0,r.jsx)(n.code,{children:"true"}),", the cluster is available:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"NAME           GENERATION   RECONCILED   AVAILABLE   FULLREPLICATION   VERSION   AGE\ntest-cluster   1            1            true        true              7.1.26    13m\n"})}),"\n",(0,r.jsx)(n.h2,{id:"retrieve-the-configmap-containing-foundationdb-access-information",children:"Retrieve the ConfigMap containing FoundationDB access information"}),"\n",(0,r.jsx)(n.p,{children:'When using the fdb-kubernetes-operator to deploy FoundationDB, a specific ConfigMap containing the access information for FoundationDB will be created in the namespace where FoundationDB is deployed. The name of this ConfigMap will be the resource name of the FoundationDB deployment, with "-config" appended. Use the following command to view the ConfigMap:'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl get configmap\n"})}),"\n",(0,r.jsx)(n.p,{children:"Expected output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"test-cluster-config   5      15d\n"})})]})}function u(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},250065:function(e,n,o){o.d(n,{Z:function(){return a},a:function(){return i}});var t=o(667294);let r={},s=t.createContext(r);function i(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);