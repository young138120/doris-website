"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["758310"],{321280:function(e,n,t){t.r(n),t.d(n,{metadata:()=>r,contentTitle:()=>a,default:()=>u,assets:()=>l,toc:()=>c,frontMatter:()=>i});var r=JSON.parse('{"id":"admin-manual/resource-admin/use-workload-remote-io-limit","title":"Use Workload Group limit remote IO","description":"\x3c!--","source":"@site/versioned_docs/version-3.0/admin-manual/resource-admin/use-workload-remote-io-limit.md","sourceDirName":"admin-manual/resource-admin","slug":"/admin-manual/resource-admin/use-workload-remote-io-limit","permalink":"/docs/3.0/admin-manual/resource-admin/use-workload-remote-io-limit","draft":false,"unlisted":false,"tags":[],"version":"3.0","frontMatter":{"title":"Use Workload Group limit remote IO","language":"en"},"sidebar":"docs","previous":{"title":"Use Workload Group limit local IO","permalink":"/docs/3.0/admin-manual/resource-admin/use-workload-local-io-limit"},"next":{"title":"SQL Interception","permalink":"/docs/3.0/admin-manual/query-admin/sql-interception"}}'),o=t("785893"),s=t("250065");let i={title:"Use Workload Group limit remote IO",language:"en"},a=void 0,l={},c=[{value:"Test limit remote IO",id:"test-limit-remote-io",level:2},{value:"Test env",id:"test-env",level:3},{value:"Test not limit remote IO",id:"test-not-limit-remote-io",level:3},{value:"Test limit remote IO",id:"test-limit-remote-io-1",level:3}];function d(e){let n={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"BrokerLoad and S3Load are commonly used methods for importing large volumes of data. Users can first upload data to HDFS or S3 and then use BrokerLoad and S3Load for parallel data imports. To speed up the import process, Doris uses multithreading to pull data from HDFS/S3 in parallel. This can put significant pressure on HDFS/S3, potentially causing instability for other jobs running on HDFS/S3."}),"\n",(0,o.jsx)(n.p,{children:"You can use the remote I/O limitation feature of Workload Groups to limit the bandwidth used during the import process, thereby reducing the impact on other operations."}),"\n",(0,o.jsx)(n.h2,{id:"test-limit-remote-io",children:"Test limit remote IO"}),"\n",(0,o.jsx)(n.h3,{id:"test-env",children:"Test env"}),"\n",(0,o.jsx)(n.p,{children:"1FE,1BE(16 cores, 64G), test data is clickbench,Before testing, the dataset needs to be uploaded to S3. To save time, we will upload only 10 million rows of data, and then use the TVF (Table-Valued Function) feature to query the data from S3."}),"\n",(0,o.jsx)(n.p,{children:"Show schema info after upload."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'DESC FUNCTION s3 (\n    "URI" = "https://bucketname/1kw.tsv",\n    "s3.access_key"= "ak",\n    "s3.secret_key" = "sk",\n    "format" = "csv",\n    "use_path_style"="true"\n);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"test-not-limit-remote-io",children:"Test not limit remote IO"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Run query one by one."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'// just scan, not return value.\nset dry_run_query = true;\n\nSELECT * FROM s3(\n    "URI" = "https://bucketname/1kw.tsv",\n    "s3.access_key"= "ak",\n    "s3.secret_key" = "sk",\n    "format" = "csv",\n    "use_path_style"="true"\n);\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsx)(n.li,{children:"Show remote IO by system table,it's about 837M/s, It should be noted that the actual I/O throughput here is significantly affected by the environment. If the machine hosting the BE has a low bandwidth connection to external storage, the actual throughput may be lower."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"MySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     837 |\n+---------+\n1 row in set (0.104 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     867 |\n+---------+\n1 row in set (0.070 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     867 |\n+---------+\n1 row in set (0.186 sec)\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:"Using sar(sar -n DEV 1 3600) to show network bandwidth of the machine, the max value is about 1033M/s.The first column of the output is the number of bytes received per second by a certain network card of the current machine, in KB per second."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"use workload group rio",src:t(716653).Z+"",width:"960",height:"436"})}),"\n",(0,o.jsx)(n.h3,{id:"test-limit-remote-io-1",children:"Test limit remote IO"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Alter workload group."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"alter workload group normal properties('remote_read_bytes_per_second'='104857600');\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsx)(n.li,{children:"Run query one by one."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'// just scan not return.\nset dry_run_query = true;\n\n\nSELECT * FROM s3(\n    "URI" = "https://bucketname/1kw.tsv",\n    "s3.access_key"= "ak",\n    "s3.secret_key" = "sk",\n    "format" = "csv",\n    "use_path_style"="true"\n);\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:"Use the system table to check the current remote read I/O throughput. At this moment, the I/O throughput is around 100M, with some fluctuation. This fluctuation is influenced by the current algorithm design and typically includes a peak, but it does not last long and is considered normal."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"MySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|      56 |\n+---------+\n1 row in set (0.010 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     131 |\n+---------+\n1 row in set (0.009 sec)\n\nMySQL [(none)]> select cast(REMOTE_SCAN_BYTES_PER_SECOND/1024/1024 as int) as read_mb from information_schema.workload_group_resource_usage;\n+---------+\n| read_mb |\n+---------+\n|     111 |\n+---------+\n1 row in set (0.009 sec)\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"4",children:["\n",(0,o.jsx)(n.li,{children:"Using sar(sar -n DEV 1 3600) to show network bandwidth, the max IO is about 207M, This indicates that remote limit IO works. However, since the sar command shows machine-level traffic, the values may be higher than those reported by Doris."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"use workload group rio",src:t(674967).Z+"",width:"864",height:"472"})})]})}function u(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},716653:function(e,n,t){t.d(n,{Z:function(){return r}});let r=t.p+"assets/images/use_wg_rio_1-e3ae321d5e709bb0ba21b9572d2bce1f.png"},674967:function(e,n,t){t.d(n,{Z:function(){return r}});let r=t.p+"assets/images/use_wg_rio_2-7511c9afedf43b931909b18e529f00ea.png"},250065:function(e,n,t){t.d(n,{Z:function(){return a},a:function(){return i}});var r=t(667294);let o={},s=r.createContext(o);function i(e){let n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);