"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["504430"],{126026:function(e,n,s){s.r(n),s.d(n,{metadata:()=>t,contentTitle:()=>a,default:()=>h,assets:()=>l,toc:()=>c,frontMatter:()=>i});var t=JSON.parse('{"id":"install/cluster-deployment/k8s-deploy/install-config-cluster","title":"Config Doris to Deploy","description":"\x3c!--","source":"@site/versioned_docs/version-2.1/install/cluster-deployment/k8s-deploy/install-config-cluster.md","sourceDirName":"install/cluster-deployment/k8s-deploy","slug":"/install/cluster-deployment/k8s-deploy/install-config-cluster","permalink":"/docs/install/cluster-deployment/k8s-deploy/install-config-cluster","draft":false,"unlisted":false,"tags":[],"version":"2.1","frontMatter":{"title":"Config Doris to Deploy","language":"en"},"sidebar":"docs","previous":{"title":"Deploy on Kubernetes","permalink":"/docs/install/cluster-deployment/k8s-deploy/install-quickstart"},"next":{"title":"Cluster Operation","permalink":"/docs/install/cluster-deployment/k8s-deploy/cluster-operation"}}'),r=s("785893"),o=s("250065");let i={title:"Config Doris to Deploy",language:"en"},a=void 0,l={},c=[{value:"Cluster planning",id:"cluster-planning",level:2},{value:"Image configuration",id:"image-configuration",level:3},{value:"Replicas configuration",id:"replicas-configuration",level:3},{value:"Computing resource configuration",id:"computing-resource-configuration",level:3},{value:"Custom startup configuration",id:"custom-startup-configuration",level:2},{value:"Custom FE startup configuration",id:"custom-fe-startup-configuration",level:3},{value:"Step 1:  Create and deploy the FE ConfigMap",id:"step-1--create-and-deploy-the-fe-configmap",level:4},{value:"step 2: Update the DorisCluster resource",id:"step-2-update-the-doriscluster-resource",level:4},{value:"Custom BE startup configuration",id:"custom-be-startup-configuration",level:3},{value:"Step 1: Create and deploy the BE ConfigMap",id:"step-1-create-and-deploy-the-be-configmap",level:4},{value:"step 2: Update the DorisCluster resource",id:"step-2-update-the-doriscluster-resource-1",level:4},{value:"Mounting multiple ConfigMaps",id:"mounting-multiple-configmaps",level:3},{value:"Persistent storage",id:"persistent-storage",level:2},{value:"Persistent storage for FE",id:"persistent-storage-for-fe",level:3},{value:"Persistent metadata for FE",id:"persistent-metadata-for-fe",level:4},{value:"Persistent FE log",id:"persistent-fe-log",level:4},{value:"Persistent storage for BE",id:"persistent-storage-for-be",level:3},{value:"Persistent data",id:"persistent-data",level:4},{value:"Persistent BE log",id:"persistent-be-log",level:4},{value:"Access configuration",id:"access-configuration",level:2},{value:"ClusterIP",id:"clusterip",level:3},{value:"Step 1: Configure ClusterIP",id:"step-1-configure-clusterip",level:4},{value:"Step 2: Obtain the Service",id:"step-2-obtain-the-service",level:4},{value:"Step 3: Access doris from inside the container",id:"step-3-access-doris-from-inside-the-container",level:4},{value:"NodePort",id:"nodeport",level:3},{value:"Step 1: Configure NodePort",id:"step-1-configure-nodeport",level:4},{value:"Step 2: Obtain the service",id:"step-2-obtain-the-service-1",level:4},{value:"Step 3: Access service using NodePort",id:"step-3-access-service-using-nodeport",level:4},{value:"LoadBalancer",id:"loadbalancer",level:3},{value:"Step 1: Configure the LoadBalancer mode",id:"step-1-configure-the-loadbalancer-mode",level:4},{value:"Step 2: Obtain the service",id:"step-2-obtain-the-service-2",level:4},{value:"Step 3: Access service using LoadBalancer",id:"step-3-access-service-using-loadbalancer",level:4},{value:"Configuring the username and password for the management cluster",id:"configuring-the-username-and-password-for-the-management-cluster",level:2},{value:"Configuring the root user password during cluster deployment",id:"configuring-the-root-user-password-during-cluster-deployment",level:3},{value:"Step 1: Generate the root encrypted password",id:"step-1-generate-the-root-encrypted-password",level:4},{value:"Step 2: Configure the DorisCluster resource",id:"step-2-configure-the-doriscluster-resource",level:4},{value:"Automatically creating non-root management users and psswords during deployment (Recommended)",id:"automatically-creating-non-root-management-users-and-psswords-during-deployment-recommended",level:3},{value:"Setting the root user password after cluster deployment",id:"setting-the-root-user-password-after-cluster-deployment",level:3},{value:"Step 1: Create a user with Node_priv permission",id:"step-1-create-a-user-with-node_priv-permission",level:4},{value:"step 2: Grant Node_priv permission to the new user",id:"step-2-grant-node_priv-permission-to-the-new-user",level:4},{value:"step 3: Configure DorisCluster",id:"step-3-configure-doriscluster",level:4}];function d(e){let n={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"cluster-planning",children:"Cluster planning"}),"\n",(0,r.jsx)(n.p,{children:"In the default DorisCluster resource deployment, the FE and BE images may not be the latest versions, and  the default replica count for both FE and BE is set to 3. Additionally, Additionally, the default resource configuration for FE is 6 CPUs and 12Gi of memory, while for BE, it is 8 CPUs and 16Gi of memory. This section describes how to modify these default configurations according to your requirements."}),"\n",(0,r.jsx)(n.h3,{id:"image-configuration",children:"Image configuration"}),"\n",(0,r.jsx)(n.p,{children:"Doris Operator is decoupled from the Doris version and supports deploying Doris versions 2.0 and above."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"FE image configuration"}),(0,r.jsx)(n.br,{}),"\nTo specify the FE image version, use the following configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  feSpec:\n    image: ${image}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ${image} with the desired image name, then update the configuration in the target ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"}),".  Official FE images are available at ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/repository/docker/selectdb/doris.fe-ubuntu",children:"FE Image"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"BE image configuration"}),(0,r.jsx)(n.br,{}),"\nTo specify the BE image version, use the following configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  beSpec:\n    image: ${image}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ${image} with the desired image name, then update the configuration in the target ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"}),".  Official BE images are available at ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/repository/docker/selectdb/doris.be-ubuntu",children:"BE Image"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"replicas-configuration",children:"Replicas configuration"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"FE Replicas configuration"}),(0,r.jsx)(n.br,{}),"\nTo modify the default FE replica count of 3 to 5, use the following configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  feSpec:\n    replicas: 5\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Update the configuration in the target ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"BE replicas configuration"}),(0,r.jsx)(n.br,{}),"\nTo modify the default FE replica count of 3 to 5, use the following configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  beSpec:\n    replicas: 5\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Update the configuration to the ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"})," that needs to be deployed."]}),"\n",(0,r.jsx)(n.h3,{id:"computing-resource-configuration",children:"Computing resource configuration"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"FE computing resource configuration"}),(0,r.jsx)(n.br,{}),"\nThe default compute resource configuration for FE is 6 CPUs and 12Gi of memory. To modify it to 8CPUs and 16Gi, use the following configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  feSpec:\n    requests:\n      cpu: 8\n      memory: 16Gi\n    limits:\n      cpu: 8\n      memory: 16Gi\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Update the configuration in the target ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"BE computing resource configuration"}),(0,r.jsx)(n.br,{}),"\nThe default compute resource configuration for BE is 8 CPUs and 16Gi of memory. To modify it to 16 CPUs and 32Gi of memory, use the following configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  beSpec:\n    requests:\n      cpu: 16\n      memory: 32Gi\n    limits:\n      cpu: 16\n      memory: 32Gi\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Update the configuration in the target ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"}),"."]}),"\n",(0,r.jsx)(n.admonition,{title:"Tip",type:"tip",children:(0,r.jsx)(n.p,{children:"The minimum required resources for FE and BE to start are 4 CPUs and 8Gi of memory. For normal performance testing, it is recommended to configure  8 CPUs and 8Gi of memory."})}),"\n",(0,r.jsx)(n.h2,{id:"custom-startup-configuration",children:"Custom startup configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Doris uses ConfigMap to decouple configuration files from services, in Kubernetes. By default, services use the default configurations in the image as startup parameter configurations. To customize the startup parameters, create a specific ConfigMap following the instructions in the ",(0,r.jsx)(n.a,{href:"/docs/admin-manual/config/fe-config",children:"FE Configuration Document"})," and the ",(0,r.jsx)(n.a,{href:"/docs/admin-manual/config/be-config",children:"BE Configuration Document"}),". Then deploy the customized ConfigMap to the namespace where the ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"})," is to be deployed."]}),"\n",(0,r.jsx)(n.h3,{id:"custom-fe-startup-configuration",children:"Custom FE startup configuration"}),"\n",(0,r.jsx)(n.h4,{id:"step-1--create-and-deploy-the-fe-configmap",children:"Step 1:  Create and deploy the FE ConfigMap"}),"\n",(0,r.jsx)(n.p,{children:"The following example defines a ConfigMap named fe-conf for use with Doris FE:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: fe-conf\n  labels:\n    app.kubernetes.io/component: fe\ndata:\n  fe.conf: |\n    CUR_DATE=`date +%Y%m%d-%H%M%S`\n    # the output dir of stderr and stdout\n    LOG_DIR = ${DORIS_HOME}/log\n    JAVA_OPTS="-Djavax.security.auth.useSubjectCredsOnly=false -Xss4m -Xmx8192m -XX:+UseMembar -XX:SurvivorRatio=8 -XX:MaxTenuringThreshold=7 -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:+CMSClassUnloadingEnabled -XX:-CMSParallelRemarkEnabled -XX:CMSInitiatingOccupancyFraction=80 -XX:SoftRefLRUPolicyMSPerMB=0 -Xloggc:$DORIS_HOME/log/fe.gc.log.$CUR_DATE"\n    # For jdk 9+, this JAVA_OPTS will be used as default JVM options\n    JAVA_OPTS_FOR_JDK_9="-Djavax.security.auth.useSubjectCredsOnly=false -Xss4m -Xmx8192m -XX:SurvivorRatio=8 -XX:MaxTenuringThreshold=7 -XX:+CMSClassUnloadingEnabled -XX:-CMSParallelRemarkEnabled -XX:CMSInitiatingOccupancyFraction=80 -XX:SoftRefLRUPolicyMSPerMB=0 -Xlog:gc*:$DORIS_HOME/log/fe.gc.log.$CUR_DATE:time"\n    # INFO, WARN, ERROR, FATAL\n    sys_log_level = INFO\n    # NORMAL, BRIEF, ASYNC\n    sys_log_mode = NORMAL\n    # Default dirs to put jdbc drivers,default value is ${DORIS_HOME}/jdbc_drivers\n    # jdbc_drivers_dir = ${DORIS_HOME}/jdbc_drivers\n    http_port = 8030\n    rpc_port = 9020\n    query_port = 9030\n    edit_log_port = 9010\n    enable_fqdn_mode = true\n'})}),"\n",(0,r.jsxs)(n.p,{children:["When using the ConfigMap to mount FE startup configuration, the key corresponding to the configuration must be ",(0,r.jsx)(n.code,{children:"fe.conf"}),". Write the ConfigMap to a file and deploy it to the namespace where the DorisCluster resource is deployed, using the following command:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl -n ${namespace} apply -f ${feConfigMapFile}.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, ${namespace} refers to the namespace where the DorisCluster is to be deployed, and ${feConfigMapFile} is the name of the ConfigMap file for FE."}),"\n",(0,r.jsx)(n.h4,{id:"step-2-update-the-doriscluster-resource",children:"step 2: Update the DorisCluster resource"}),"\n",(0,r.jsxs)(n.p,{children:["To use the ConfigMap named ",(0,r.jsx)(n.code,{children:"fe-conf"})," for mounting the startup configuration, add the following config to the FE spec of the ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  feSpec:\n    configMapInfo:\n      configMapName: fe-conf\n      resolveKey: fe.conf\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Tip",type:"tip",children:(0,r.jsxs)(n.p,{children:["Please ensure that ",(0,r.jsx)(n.code,{children:"enable_fqdn_mode=true"})," is included in the startup configuration.. If you want to use IP mode and K8s have the ability that the pod IP keep the same after restarted, please refer to the issue ",(0,r.jsx)(n.a,{href:"https://github.com/apache/doris-operator/issues/138",children:"#138"})," to config."]})}),"\n",(0,r.jsx)(n.h3,{id:"custom-be-startup-configuration",children:"Custom BE startup configuration"}),"\n",(0,r.jsx)(n.h4,{id:"step-1-create-and-deploy-the-be-configmap",children:"Step 1: Create and deploy the BE ConfigMap"}),"\n",(0,r.jsxs)(n.p,{children:["The following example defines a ConfigMap named ",(0,r.jsx)(n.code,{children:"be-conf"})," for use with Doris BE:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: be-conf\n  labels:\n    app.kubernetes.io/component: be\ndata:\n  be.conf: |\n    CUR_DATE=`date +%Y%m%d-%H%M%S`\n\n    PPROF_TMPDIR="$DORIS_HOME/log/"\n\n    JAVA_OPTS="-Xmx1024m -DlogPath=$DORIS_HOME/log/jni.log -Xloggc:$DORIS_HOME/log/be.gc.log.$CUR_DATE -Djavax.security.auth.useSubjectCredsOnly=false -Dsun.java.command=DorisBE -XX:-CriticalJNINatives -DJDBC_MIN_POOL=1 -DJDBC_MAX_POOL=100 -DJDBC_MAX_IDLE_TIME=300000 -DJDBC_MAX_WAIT_TIME=5000"\n\n    # For jdk 9+, this JAVA_OPTS will be used as default JVM options\n    JAVA_OPTS_FOR_JDK_9="-Xmx1024m -DlogPath=$DORIS_HOME/log/jni.log -Xlog:gc:$DORIS_HOME/log/be.gc.log.$CUR_DATE -Djavax.security.auth.useSubjectCredsOnly=false -Dsun.java.command=DorisBE -XX:-CriticalJNINatives -DJDBC_MIN_POOL=1 -DJDBC_MAX_POOL=100 -DJDBC_MAX_IDLE_TIME=300000 -DJDBC_MAX_WAIT_TIME=5000"\n\n    # since 1.2, the JAVA_HOME need to be set to run BE process.\n    # JAVA_HOME=/path/to/jdk/\n\n    # https://github.com/apache/doris/blob/master/docs/zh-CN/community/developer-guide/debug-tool.md#jemalloc-heap-profile\n    # https://jemalloc.net/jemalloc.3.html\n    JEMALLOC_CONF="percpu_arena:percpu,background_thread:true,metadata_thp:auto,muzzy_decay_ms:15000,dirty_decay_ms:15000,oversize_threshold:0,lg_tcache_max:20,prof:false,lg_prof_interval:32,lg_prof_sample:19,prof_gdump:false,prof_accum:false,prof_leak:false,prof_final:false"\n    JEMALLOC_PROF_PRFIX=""\n\n    # INFO, WARNING, ERROR, FATAL\n    sys_log_level = INFO\n\n    # ports for admin, web, heartbeat service\n    be_port = 9060\n    webserver_port = 8040\n    heartbeat_service_port = 9050\n    brpc_port = 8060\n'})}),"\n",(0,r.jsxs)(n.p,{children:["When using the ConfigMap to mount BE startup configuration, the key corresponding to the configuration must be ",(0,r.jsx)(n.code,{children:"be.conf"}),". Write the ConfigMap to a file and deploy it to the namespace where the ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"})," is deployed using the following command:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl -n ${namespace} apply -f ${beConfigMapFile}.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, ${namespace} refers to the namespace where the DorisCluster resource needs to be deployed, and ${beConfigMapFile} is the name of the ConfigMap file for BE."}),"\n",(0,r.jsx)(n.h4,{id:"step-2-update-the-doriscluster-resource-1",children:"step 2: Update the DorisCluster resource"}),"\n",(0,r.jsxs)(n.p,{children:["To use the ConfigMap named ",(0,r.jsx)(n.code,{children:"be-conf"})," for mounting the startup configuration, add the following config to the BE spec of the ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  feSpec:\n    configMapInfo:\n      configMapName: be-conf\n      resolveKey: be.conf\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Tip",type:"tip",children:(0,r.jsx)(n.p,{children:"Please use the startup configMap to mount files, when you want mount the file into the config directory in container, the config directory is ${DORIS_HOME}/conf."})}),"\n",(0,r.jsx)(n.h3,{id:"mounting-multiple-configmaps",children:"Mounting multiple ConfigMaps"}),"\n",(0,r.jsx)(n.p,{children:"The Doris Operator supports mounting multiple ConfigMaps into different directories within the container, allowing flexible configuration management."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Mounting multiple ConfigMaps for FE"}),(0,r.jsx)(n.br,{}),"\nThe following example demonstrates how to mount two ConfigMaps ",(0,r.jsx)(n.code,{children:"test-fe1"})," and ",(0,r.jsx)(n.code,{children:"test-fe2"}),' to the directories "/etc/fe/config1/" and "/etc/fe/config2",respectively, within the FE container:']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  feSpec:\n    configMaps:\n    - configMapName: test-fe1\n      mountPath: /etc/fe/config1\n    - configMapName: test-fe2\n      mountPath: /etc/fe/config2\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Mounting multiple ConfigMaps for BE"}),(0,r.jsx)(n.br,{}),"\nSimilarly, the following example shows how to mount two ConfigMaps ",(0,r.jsx)(n.code,{children:"test-be1"})," and ",(0,r.jsx)(n.code,{children:"test-be2"}),' into the directories "/etc/be/config1" and "/etc/be/config2", respectively, within the BE container:']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"  spec:\n    beSpec:\n      configMaps:\n      - configMapName: test-be1\n        mountPath: /etc/be/config1\n      - configMapName: test-be2\n        mountPath: /etc/be/config2\n"})}),"\n",(0,r.jsx)(n.h2,{id:"persistent-storage",children:"Persistent storage"}),"\n",(0,r.jsxs)(n.p,{children:["Kubernetes provides the ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/storage/persistent-volumes/",children:"Persistent Volumes"})," to persist data to physical storage. In Kubernetes, the Doris Operator automatically creates PersistentVolumeClaims associated with appropriate PersistentVolumes, based on the template that defined in the need deployed ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster Resource"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"persistent-storage-for-fe",children:"Persistent storage for FE"}),"\n",(0,r.jsx)(n.p,{children:"In a Kubernetes-based Doris deployment, it is recommended to persist the following paths for FE:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Metadata: /opt/apache-doris/fe/doris-meta (default storage configuration for FE metadata)."}),"\n",(0,r.jsx)(n.li,{children:"Logs: /opt/apache-doris/fe/log (if log persistence is required)."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"persistent-metadata-for-fe",children:"Persistent metadata for FE"}),"\n",(0,r.jsxs)(n.p,{children:["To persist FE metadata using the default storage configuration, add the following configuration to the ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  feSpec:\n    persistentVolumes:\n    - mountPath: /opt/apache-doris/fe/doris-meta\n      name: meta\n      persistentVolumeClaimSpec:\n        # when use specific storageclass, the storageClassName should reConfig, example as annotation.\n        storageClassName: ${your_storageclass}\n        accessModes:\n        - ReadWriteOnce\n        resources:\n          # notice: if the storage size less 5G, fe will not start normal.\n          requests:\n            storage: ${storageSize}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In the above configuration, ${your_storageclass} represents the name of the StorageClass you want to use, and ${storageSize} represents the storage size you want to allocation. The format is ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/",children:"quantity expression"}),", such as: 100Gi."]}),"\n",(0,r.jsx)(n.h4,{id:"persistent-fe-log",children:"Persistent FE log"}),"\n",(0,r.jsxs)(n.p,{children:["If your cluster lacks a centralized log collection system, persist the FE log directory by adding the following configuration to the ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  feSpec:\n    persistentVolumes:\n    - mountPath: /opt/apache-doris/fe/log\n      name: log\n      persistentVolumeClaimSpec:\n        # when use specific storageclass, the storageClassName should reConfig, example as annotation.\n        storageClassName: ${your_storageclass}\n        accessModes:\n        - ReadWriteOnce\n        resources:\n          # notice: if the storage size less 5G, fe will not start normal.\n          requests:\n            storage: ${storageSize}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In the above configuration, ${your_storageclass} represents the name of the StorageClass you want to use, and ${storageSize} represents the storage size you want to allocation. The format of ${storageSize} follows the ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/",children:"quantity expression"})," method of K8s, such as: 100Gi. Please replace them as needed when using."]}),"\n",(0,r.jsx)(n.admonition,{title:"Tip",type:"tip",children:(0,r.jsxs)(n.p,{children:["If you have reconfigured meta_dir or sys_log_dir in the ",(0,r.jsx)(n.a,{href:"#custom-fe-startup-configuration",children:"customized configuration file"}),", please reconfigure the mountPath."]})}),"\n",(0,r.jsx)(n.h3,{id:"persistent-storage-for-be",children:"Persistent storage for BE"}),"\n",(0,r.jsx)(n.p,{children:"For BE nodes in a Doris deployment, it is recommended to persist the following paths:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Data Storage: /opt/apache-doris/be/storage (default storage for BE data)."}),"\n",(0,r.jsx)(n.li,{children:"Logs: /opt/apache-doris/be/log (if log persistence is required)."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"persistent-data",children:"Persistent data"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Using default storage configuration"}),(0,r.jsx)(n.br,{}),"\nTo persist data uses the default storage configuration, update the ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"})," with the following configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"beSpec:\n  persistentVolumes:\n  - mountPath: /opt/apache-doris/be/storage\n    name: be-storage\n    persistentVolumeClaimSpec:\n      storageClassName: ${your_storageclass}\n      accessModes:\n        - ReadWriteOnce\n      resources:\n        requests:\n          storage: ${storageSize}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In the above configuration, ${your_storageclass} represents the name of the StorageClass you want to use, and ${storageSize} represents the storage size you want to use. The format of ${storageSize} follows the ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/",children:"quantity expression method"})," of K8s, such as: 100Gi. Please replace them as needed when using."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Customizing BE storage paths"}),(0,r.jsx)(n.br,{}),"\nTo leverage multiple disks, you can configure multiple storage directories using storage_root_path. For example, if storage_root_path=/home/disk1/doris.HDD;/home/disk2/doris.SSD, the configuration should include:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"beSpec:\n  persistentVolumes:\n  - mountPath: /home/disk1/doris\n    name: be-storage1\n    persistentVolumeClaimSpec:\n      storageClassName: ${your_storageclass}\n      accessModes:\n        - ReadWriteOnce\n      resources:\n        requests:\n          storage: ${storageSize}\n  - mountPath: /home/disk2/doris\n    name: be-storage2\n    persistentVolumeClaimSpec:\n      storageClassName: ${your_storageclass}\n      accessModes:\n        - ReadWriteOnce\n      resources:\n        requests:\n          storage: ${storageSize}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In the above configuration, ${your_storageclass} represents the name of the StorageClass you want to use, and ${storageSize} represents the storage size you want to use. The format of ${storageSize} follows the ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/",children:"quantity expression method"})," of K8s, such as: 100Gi. Please replace them as needed when using."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"persistent-be-log",children:"Persistent BE log"}),"\n",(0,r.jsxs)(n.p,{children:["To persist BE logs when using the default configuration, update the DorisCluster resource ",(0,r.jsx)(n.a,{href:"/docs/install/cluster-deployment/k8s-deploy/install-quickstart#step-2-deploy-doris-cluster",children:"DorisCluster resource"})," as follows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"beSpec:\n  persistentVolumes:\n  - mountPath: /opt/apache-doris/be/log\n    name: belog\n    persistentVolumeClaimSpec:\n      storageClassName: ${your_storageclass}\n      accessModes:\n      - ReadWriteOnce\n      resources:\n        requests:\n          storage: ${storageSize}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In the above configuration, ${your_storageclass} represents the name of the StorageClass you want to use, and ${storageSize} represents the storage size you want to use. The format of ${storageSize} follows the ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/",children:"quantity expression method"})," of K8s, such as: 100Gi. Please replace them as needed when using."]}),"\n",(0,r.jsx)(n.h2,{id:"access-configuration",children:"Access configuration"}),"\n",(0,r.jsx)(n.p,{children:"Kubernetes provides the use of Service as VIP (Virtual IP) and load balancer. There are three external exposure modes for Service: ClusterIP, NodePort, and LoadBalancer."}),"\n",(0,r.jsx)(n.h3,{id:"clusterip",children:"ClusterIP"}),"\n",(0,r.jsx)(n.p,{children:"Doris provides the ClusterIP access mode by default on Kubernetes. The ClusterIP access mode provides an internal IP address within the Kubernetes cluster to expose services through this internal IP. With the ClusterIP mode, services can only be accessed within the cluster."}),"\n",(0,r.jsx)(n.h4,{id:"step-1-configure-clusterip",children:"Step 1: Configure ClusterIP"}),"\n",(0,r.jsx)(n.p,{children:"Doris provides the ClusterIP access mode by default on Kubernetes. You can use the ClusterIP access mode without any modification."}),"\n",(0,r.jsx)(n.h4,{id:"step-2-obtain-the-service",children:"Step 2: Obtain the Service"}),"\n",(0,r.jsx)(n.p,{children:"After deploying the cluster, you can view the services exposed by the Doris Operator using the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl -n doris get svc\n"})}),"\n",(0,r.jsx)(n.p,{children:"The returned result is as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"NAME                              TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                               AGE\ndoriscluster-sample-be-internal   ClusterIP   None          <none>        9050/TCP                              9m\ndoriscluster-sample-be-service    ClusterIP   10.1.68.128   <none>        9060/TCP,8040/TCP,9050/TCP,8060/TCP   9m\ndoriscluster-sample-fe-internal   ClusterIP   None          <none>        9030/TCP                              14m\ndoriscluster-sample-fe-service    ClusterIP   10.1.118.16   <none>        8030/TCP,9020/TCP,9030/TCP,9010/TCP   14m\n"})}),"\n",(0,r.jsx)(n.p,{children:'In the above results, there are two types of services for FE and BE, with suffixes of "internal" and "service" respectively:'}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'The services with the "internal" suffix can only be used for internal communication within Doris, such as heartbeat, data exchange, and other operations, and are not for external use.'}),"\n",(0,r.jsx)(n.li,{children:'The services with the "service" suffix can be used by users.'}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"step-3-access-doris-from-inside-the-container",children:"Step 3: Access doris from inside the container"}),"\n",(0,r.jsx)(n.p,{children:"You can create a pod containing the mysql client in the current Kubernetes cluster using the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl run mysql-client --image=mysql:5.7 -it --rm --restart=Never --namespace=doris -- /bin/bash\n"})}),"\n",(0,r.jsx)(n.p,{children:'From within the container in the cluster, you can access the Doris cluster using the service name with the "service" suffix that is exposed externally:'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"mysql -uroot -P9030 -hdoriscluster-sample-fe-service\n"})}),"\n",(0,r.jsx)(n.h3,{id:"nodeport",children:"NodePort"}),"\n",(0,r.jsx)(n.p,{children:"To access Doris from outside the Kubernetes cluster, you can use the NodePort service type. There are two ways to allocate a port for the NodePort: dynamic allocation and static allocation."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Dynamic Allocation: If the port is not explicitly set, Kubernetes will automatically allocate an unused port from the default range (30000-32767) when the pod is created."}),"\n",(0,r.jsx)(n.li,{children:"Static Allocation:I f a port is explicitly specified, Kubernetes will allocate that port if it is available, ensuring it remains fixed."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Doris exposes the following ports for external access:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Port Name"}),(0,r.jsx)(n.th,{children:"default value"}),(0,r.jsx)(n.th,{children:"Port Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Query Port"}),(0,r.jsx)(n.td,{children:"9030"}),(0,r.jsx)(n.td,{children:"Used to access the Doris cluster via the MySQL protocol"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"HTTP Port"}),(0,r.jsx)(n.td,{children:"8030"}),(0,r.jsx)(n.td,{children:"The http server port on FE, used to view FE information"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Web Server Port"}),(0,r.jsx)(n.td,{children:"8040"}),(0,r.jsx)(n.td,{children:"The http server port on BE, used to view BE information"})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"step-1-configure-nodeport",children:"Step 1: Configure NodePort"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"FE NodePort"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Dynamic Allocation:\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  feSpec:\n    service:\n      type: NodePort\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Static Allocation:\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  feSpec:\n    service:\n      type: NodePort\n      servicePorts:\n      - nodePort: 31001\n        targetPort: 8030\n      - nodePort: 31002\n        targetPort: 9030\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"BE NodePort"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Dynamic Allocation:\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  beSpec:\n    service:\n      type: NodePort\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Static Allocation:\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"  beSpec:\n    service:\n      type: NodePort\n      servicePorts:\n      - nodePort: 31006\n        targetPort: 8040\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"step-2-obtain-the-service-1",children:"Step 2: Obtain the service"}),"\n",(0,r.jsx)(n.p,{children:"After deploying the cluster, you can view the services exposed by the Doris Operator using the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl get service\n"})}),"\n",(0,r.jsx)(n.p,{children:"The returned result is as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"NAME                              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                                                       AGE\nkubernetes                        ClusterIP   10.152.183.1     <none>        443/TCP                                                       169d\ndoriscluster-sample-fe-internal   ClusterIP   None             <none>        9030/TCP                                                      2d\ndoriscluster-sample-fe-service    NodePort    10.152.183.58    <none>        8030:31041/TCP,9020:30783/TCP,9030:31545/TCP,9010:31610/TCP   2d\ndoriscluster-sample-be-internal   ClusterIP   None             <none>        9050/TCP                                                      2d\ndoriscluster-sample-be-service    NodePort    10.152.183.244   <none>        9060:30940/TCP,8040:32713/TCP,9050:30621/TCP,8060:30926/TCP   2d\n"})}),"\n",(0,r.jsx)(n.h4,{id:"step-3-access-service-using-nodeport",children:"Step 3: Access service using NodePort"}),"\n",(0,r.jsx)(n.p,{children:"To access Doris via NodePort, you need to know the Node IP and the mapped port. You can retrieve the node IPs using:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"  kubectl get nodes -owide\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example output::"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"NAME   STATUS   ROLES           AGE   VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE          KERNEL-VERSION          CONTAINER-RUNTIME\nr60    Ready    control-plane   14d   v1.28.2   192.168.88.60   <none>        CentOS Stream 8   4.18.0-294.el8.x86_64   containerd://1.6.22\nr61    Ready    <none>          14d   v1.28.2   192.168.88.61   <none>        CentOS Stream 8   4.18.0-294.el8.x86_64   containerd://1.6.22\nr62    Ready    <none>          14d   v1.28.2   192.168.88.62   <none>        CentOS Stream 8   4.18.0-294.el8.x86_64   containerd://1.6.22\nr63    Ready    <none>          14d   v1.28.2   192.168.88.63   <none>        CentOS Stream 8   4.18.0-294.el8.x86_64   containerd://1.6.22\n"})}),"\n",(0,r.jsx)(n.p,{children:"You can then use the IP address of any node (e.g., 192.168.88.61, 192.168.88.62, or 192.168.88.63) along with the mapped port to access Doris. For example, using node 192.168.88.62 and port 31545:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"  mysql -h 192.168.88.62 -P 31545 -uroot\n"})}),"\n",(0,r.jsx)(n.h3,{id:"loadbalancer",children:"LoadBalancer"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer",children:"LoadBalancer"})," service type provides an additional load balancer, typically offered by cloud service providers. This mode is only available when deploying the Doris cluster on Kubernetes clusters managed by a cloud platform."]}),"\n",(0,r.jsx)(n.h4,{id:"step-1-configure-the-loadbalancer-mode",children:"Step 1: Configure the LoadBalancer mode"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"FE LoadBalancer"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  feSpec:\n    service:\n      type: LoadBalancer\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"BE LoadBalancer"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  beSpec:\n    service:\n      type: LoadBalancer\n"})}),"\n",(0,r.jsx)(n.h4,{id:"step-2-obtain-the-service-2",children:"Step 2: Obtain the service"}),"\n",(0,r.jsx)(n.p,{children:"After deploying the cluster, you can view the services exposed by the Doris Operator using the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl get service\n"})}),"\n",(0,r.jsx)(n.p,{children:"The returned result is as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"NAME                              TYPE           CLUSTER-IP       EXTERNAL-IP                                                                     PORT(S)                                                       AGE\nkubernetes                        ClusterIP      10.152.183.1     <none>                                                                          443/TCP                                                       169d\ndoriscluster-sample-fe-internal   ClusterIP      None             <none>                                                                          9030/TCP                                                      2d\ndoriscluster-sample-fe-service    LoadBalancer   10.152.183.58    ac4828493dgrftb884g67wg4tb68gyut-1137856348.us-east-1.elb.amazonaws.com         8030:31041/TCP,9020:30783/TCP,9030:31545/TCP,9010:31610/TCP   2d\ndoriscluster-sample-be-internal   ClusterIP      None             <none>                                                                          9050/TCP                                                      2d\ndoriscluster-sample-be-service    LoadBalancer   10.152.183.244   ac4828493dgrftb884g67wg4tb68gyut-1137823345.us-east-1.elb.amazonaws.com         9060:30940/TCP,8040:32713/TCP,9050:30621/TCP,8060:30926/TCP   2d\n"})}),"\n",(0,r.jsx)(n.h4,{id:"step-3-access-service-using-loadbalancer",children:"Step 3: Access service using LoadBalancer"}),"\n",(0,r.jsxs)(n.p,{children:["To access Doris through the LoadBalancer, use the external IP (provided in the EXTERNAL-IP field) and the corresponding port. For example, using the ",(0,r.jsx)(n.code,{children:"mysql"})," command:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"mysql -h ac4828493dgrftb884g67wg4tb68gyut-1137856348.us-east-1.elb.amazonaws.com -P 31545 -uroot\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuring-the-username-and-password-for-the-management-cluster",children:"Configuring the username and password for the management cluster"}),"\n",(0,r.jsxs)(n.p,{children:["Managing Doris nodes requires connecting to the live FE nodes via the MySQL protocol using a username and password for administrative operations. Doris implements ",(0,r.jsx)(n.a,{href:"../../../admin-manual/auth/authentication-and-authorization?_highlight=rbac",children:"a permission management mechanism similar to RBAC"}),", where the user must have the ",(0,r.jsx)(n.a,{href:"/docs/admin-manual/auth/authentication-and-authorization#types-of-permissions",children:"Node_priv"})," permission to perform node management. By default, the Doris Operator deploys the cluster with the root user in passwordless mode."]}),"\n",(0,r.jsx)(n.p,{children:"The process of configuring the username and password can be divided into three scenarios:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"initializing the root user password during cluster deployment;"}),"\n",(0,r.jsx)(n.li,{children:"automatically setting a non-root user with management permissions in the root passwordless deployment;"}),"\n",(0,r.jsx)(n.li,{children:"setting the root user password after deploying the cluster in root passwordless mode."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"To secure access, you must configure a username and password with Node_Priv permission in the DorisCluster resource after adding a password to the root user. There are two ways to set up the username and password for managing the cluster nodes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Using environment variables"}),"\n",(0,r.jsx)(n.li,{children:"Using a Kubernetes Secret"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configuring-the-root-user-password-during-cluster-deployment",children:"Configuring the root user password during cluster deployment"}),"\n",(0,r.jsxs)(n.p,{children:["To set the root user's password securely, Doris supports encrypting it in ",(0,r.jsx)(n.a,{href:"../../../admin-manual/config/fe-config?_highlight=initial_#initial_root_password",children:(0,r.jsx)(n.code,{children:"fe.conf"})})," using a two-stage SHA-1 encryption process. Here's how to set up the password."]}),"\n",(0,r.jsx)(n.h4,{id:"step-1-generate-the-root-encrypted-password",children:"Step 1: Generate the root encrypted password"}),"\n",(0,r.jsx)(n.p,{children:"Use the following methods to encrypt the root password using two-stage SHA-1 encryption:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Java Code:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.apache.commons.codec.digest.DigestUtils;\n\npublic static void main( String[] args ) {\n      //the original password\n      String a = "123456";\n      String b = DigestUtils.sha1Hex(DigestUtils.sha1(a.getBytes())).toUpperCase();\n      //output the 2 stage encrypted password.\n      System.out.println("*"+b);\n  }\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Golang Code:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'import (\n"crypto/sha1"\n"encoding/hex"\n"fmt"\n"strings"\n)\n\nfunc main() {\n    //original password\n    plan := "123456"\n    //the first stage encryption.\n    h := sha1.New()\n    h.Write([]byte(plan))\n    eb := h.Sum(nil)\n    \n    //the two stage encryption.\n    h.Reset()\n    h.Write(eb)\n    teb := h.Sum(nil)\n    dst := hex.EncodeToString(teb)\n    tes := strings.ToUpper(fmt.Sprintf("%s", dst))\n    //output the 2 stage encrypted password. \n    fmt.Println("*"+tes)\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Configure the encrypted password into ",(0,r.jsx)(n.code,{children:"fe.conf"})," according to the requirements of the configuration file format. Then, Then, distribute the configuration to the Kubernetes cluster using a ConfigMap, describes in ",(0,r.jsx)(n.a,{href:"#custom-fe-startup-configuration",children:"the Cluster Parameter Configuration Section"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"step-2-configure-the-doriscluster-resource",children:"Step 2: Configure the DorisCluster resource"}),"\n",(0,r.jsx)(n.p,{children:"After setting the root password in fe.conf, Doris will automatically apply the password to the first FE node when it starts. For other nodes to join the cluster, specify the username and password in the DorisCluster resource so that Doris Operator can perform automatic node management."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Using environment variables"}),"\n",(0,r.jsx)(n.p,{children:'Configure the username root and password into the ".spec.adminUser.name" and ".spec.adminUser.password" fields in the DorisCluster resource. Doris Operator will automatically convert the following configuration into environment variables for the container to use. The auxiliary services inside the container will use the username and password configured by the environment variables to add themselves to the specified cluster. The configuration format is as follows:'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  adminUser:\n    name: root\n    password: ${password}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, ${password} is the unencrypted password of root."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Using secret"}),"\n",(0,r.jsxs)(n.p,{children:["To securely manage the username and password, you can use a Kubernetes ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/configuration/secret/#basic-authentication-secret",children:"Basic Authentication Secret"}),". Configure the Secret to store the root username and password and reference it in the DorisCluster resource.",(0,r.jsx)(n.br,{}),"\na. Configure the Required Secret"]}),"\n",(0,r.jsx)(n.p,{children:"Configure the required Basic authentication Secret according to the following format:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"stringData:\n  username: root\n  password: ${password}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, ${password} is the unencrypted password set for root."}),"\n",(0,r.jsx)(n.p,{children:"b. Configure the DorisCluster Resource to be Deployed"}),"\n",(0,r.jsx)(n.p,{children:"Configure the DorisCluster to specify the required Secret in the following format:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  authSecret: ${secretName}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, ${secretName} is the name of the Secret containing the root username and password."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"automatically-creating-non-root-management-users-and-psswords-during-deployment-recommended",children:"Automatically creating non-root management users and psswords during deployment (Recommended)"}),"\n",(0,r.jsx)(n.p,{children:"For enhanced security, it is recommended to create a non-root user for management during the first deployment, rather than using the root user. In this method, the username and password for the non-root user are configured through environment variables or Secrets. The Doris container's auxiliary services will automatically create the user in the database, set the password, and grant the necessary Node_priv permission. After deployment, Doris Operator will use the newly created non-root username and password to manage the cluster nodes."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Using environment variables:"}),"\n",(0,r.jsx)(n.p,{children:"To configure a non-root user, you can set the username and password using environment variables in the DorisCluster resource:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  adminUser:\n    name: ${DB_ADMIN_USER}\n    password: ${DB_ADMIN_PASSWD}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, ${DB_ADMIN_USER} is the newly created username, and ${DB_ADMIN_PASSWD} is the password set for the newly created username."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Using Secret:\nTo securely manage the username and password, you can use a Kubernetes Secret for basic authentication.",(0,r.jsx)(n.br,{}),"\na. Configure the required secret"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"stringData:\n  username: ${DB_ADMIN_USER}\n  password: ${DB_ADMIN_PASSWD}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Here, ${DB_ADMIN_USER} is the newly created username, and ${DB_ADMIN_PASSWD} is the password set for the newly created username.",(0,r.jsx)(n.br,{}),"\nDeploy the Secret to the Kubernetes cluster by running:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl -n ${namespace} apply -f ${secretFileName}.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, ${namespace} is the namespace where the DorisCluster resource needs to be deployed, and ${secretFileName} is the file name of the Secret to be deployed."}),"\n",(0,r.jsx)(n.p,{children:"b. Configure the DorisCluster resource"}),"\n",(0,r.jsx)(n.p,{children:"Update the DorisCluster resource according to the following format:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  authSecret: ${secretName}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, ${secretName} is the name of the deployed Basic authentication Secret."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{title:"Tip",type:"tip",children:(0,r.jsx)(n.p,{children:"After deployment, please set the root password. Doris Operator will switch to using the automatically newly created username and password to manage the nodes. Please avoid deleting the automatically created user."})}),"\n",(0,r.jsx)(n.h3,{id:"setting-the-root-user-password-after-cluster-deployment",children:"Setting the root user password after cluster deployment"}),"\n",(0,r.jsxs)(n.p,{children:["After deploying the Doris cluster and setting the root user's password, it's essential to create a management user with the necessary ",(0,r.jsx)(n.a,{href:"/docs/admin-manual/auth/authentication-and-authorization#types-of-permissions",children:"Node_priv"})," permission to allow Doris Operator to automatically manage the cluster nodes. Using the root user for this purpose is not recommended. Instead, please refer to ",(0,r.jsx)(n.a,{href:"/docs/3.0/sql-manual/sql-statements/account-management/CREATE-USER",children:"the User Creation and Permission Assignment Section"})," to create a new user and grant Node_priv permission."]}),"\n",(0,r.jsx)(n.h4,{id:"step-1-create-a-user-with-node_priv-permission",children:"Step 1: Create a user with Node_priv permission"}),"\n",(0,r.jsx)(n.p,{children:"First, connect to the Doris database using the MySQL protocol, then create a new user with the required permissions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"CREATE USER '${DB_ADMIN_USER}' IDENTIFIED BY '${DB_ADMIN_PASSWD}';\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"${DB_ADMIN_USER}: The name of the user you wish to create."}),"\n",(0,r.jsx)(n.li,{children:"${DB_ADMIN_PASSWD}: The password for the newly created user."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"step-2-grant-node_priv-permission-to-the-new-user",children:"step 2: Grant Node_priv permission to the new user"}),"\n",(0,r.jsx)(n.p,{children:"Grant the Node_priv permission to the newly created user:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"GRANT NODE_PRIV ON *.*.* TO ${DB_ADMIN_USER};\n"})}),"\n",(0,r.jsxs)(n.p,{children:["${DB_ADMIN_USER}: The username you created in the previous step.",(0,r.jsx)(n.br,{}),"\nFor more details on creating users, setting passwords, and granting permissions, refer to the ",(0,r.jsx)(n.a,{href:"/docs/3.0/sql-manual/sql-statements/account-management/CREATE-USER",children:"CREATE-USER"})," section."]}),"\n",(0,r.jsx)(n.h4,{id:"step-3-configure-doriscluster",children:"step 3: Configure DorisCluster"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Using environment variables"}),"\n",(0,r.jsx)(n.p,{children:"Directly configure the new user\u2019s name and password in the DorisCluster resource:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  adminUser:\n    name: ${DB_ADMIN_USER}\n    password: ${DB_ADMIN_PASSWD}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, ${DB_ADMIN_USER} is the newly created username, and ${DB_ADIC_PASSWD} is the password set for the newly created user."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Using Secret\nTo securely manage the username and password, you can use Kubernetes Secrets.",(0,r.jsx)(n.br,{}),"\na. Create the required secret",(0,r.jsx)(n.br,{}),"\nCreate a Basic Authentication Secret for the new user:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"stringData:\n  username: ${DB_ADMIN_USER}\n  password: ${DB_ADMIN_PASSWD}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Here, ${DB_ADMIN_USER} is the newly created username, and ${DB_ADMIN_PASSWD} is the password set for the newly created username.",(0,r.jsx)(n.br,{}),"\nDeploy the Secret to the Kubernetes cluster with:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl -n ${namespace} apply -f ${secretFileName}.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, ${namespace} is the namespace where the DorisCluster resource needs to be deployed, and ${secretFileName} is the file name of the Secret to be deployed."}),"\n",(0,r.jsxs)(n.p,{children:["b. Update the DorisCluster resource",(0,r.jsx)(n.br,{}),"\nOnce the Secret is deployed, update the DorisCluster resource to specify the Secret:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spec:\n  authSecret: ${secretName}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Here, ${secretName} is the name of the deployed Basic authentication Secret."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{title:"Tip",type:"tip",children:(0,r.jsx)(n.p,{children:"After setting the root password and configuring the new username and password for managing nodes after deployment, the existing services will be restarted once in a rolling manner."})})]})}function h(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return a},a:function(){return i}});var t=s(667294);let r={},o=t.createContext(r);function i(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);