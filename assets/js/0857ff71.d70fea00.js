"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["486309"],{414687:function(e,t,n){n.r(t),n.d(t,{metadata:()=>s,contentTitle:()=>a,default:()=>h,assets:()=>c,toc:()=>o,frontMatter:()=>r});var s=JSON.parse('{"id":"sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-POLICY","title":"CREATE-POLICY","description":"\x3c!--","source":"@site/docs/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-POLICY.md","sourceDirName":"sql-manual/sql-statements/Data-Definition-Statements/Create","slug":"/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-POLICY","permalink":"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-POLICY","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"CREATE-POLICY","language":"en"},"sidebar":"docs","previous":{"title":"CREATE-FILE","permalink":"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-FILE"},"next":{"title":"CREATE-ENCRYPT-KEY","permalink":"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-ENCRYPT-KEY"}}'),l=n("785893"),i=n("250065");let r={title:"CREATE-POLICY",language:"en"},a=void 0,c={},o=[{value:"CREATE-POLICY",id:"create-policy",level:2},{value:"Name",id:"name",level:3},{value:"Description",id:"description",level:3},{value:"Grammar:",id:"grammar",level:4},{value:"Example",id:"example",level:3},{value:"Keywords",id:"keywords",level:3},{value:"Best Practice",id:"best-practice",level:3}];function d(e){let t={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.h2,{id:"create-policy",children:"CREATE-POLICY"}),"\n",(0,l.jsx)(t.h3,{id:"name",children:"Name"}),"\n",(0,l.jsx)(t.p,{children:"CREATE POLICY"}),"\n",(0,l.jsx)(t.h3,{id:"description",children:"Description"}),"\n",(0,l.jsx)(t.p,{children:"Create policies,such as:"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsx)(t.li,{children:"Create security policies(ROW POLICY) and explain to view the rewritten SQL."}),"\n",(0,l.jsx)(t.li,{children:"Create storage migration policy(STORAGE POLICY), used for cold and hot data transform"}),"\n"]}),"\n",(0,l.jsx)(t.h4,{id:"grammar",children:"Grammar:"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsx)(t.li,{children:"ROW POLICY"}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:"CREATE ROW POLICY test_row_policy_1 ON test.table1 \nAS {RESTRICTIVE|PERMISSIVE} TO test USING (id in (1, 2));\n"})}),"\n",(0,l.jsx)(t.p,{children:"illustrate\uFF1A"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"filterType\uFF1AIt is usual to constrict a set of policies through AND. PERMISSIVE to constrict a set of policies through OR"}),"\n",(0,l.jsx)(t.li,{children:"Configure multiple policies. First, merge the RESTRICTIVE policy with the PERMISSIVE policy"}),"\n",(0,l.jsx)(t.li,{children:"It is connected with AND between RESTRICTIVE AND PERMISSIVE"}),"\n",(0,l.jsx)(t.li,{children:"It cannot be created for users root and admin"}),"\n"]}),"\n",(0,l.jsxs)(t.ol,{start:"2",children:["\n",(0,l.jsx)(t.li,{children:"STORAGE POLICY"}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:'CREATE STORAGE POLICY test_storage_policy_1\nPROPERTIES ("key"="value", ...);\n'})}),"\n",(0,l.jsx)(t.p,{children:"illustrate\uFF1A"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["PROPERTIES has such keys:\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsx)(t.li,{children:"storage_resource\uFF1Astorage resource name for policy"}),"\n",(0,l.jsx)(t.li,{children:"cooldown_datetime\uFF1Acool down time for tablet, can't be set with cooldown_ttl."}),"\n",(0,l.jsx)(t.li,{children:"cooldown_ttl\uFF1Ahot data stay time. The time cost between the time of tablet created and\nthe time of migrated to cold data, formatted as\uFF1A\n1d\uFF1A1 day\n1h\uFF1A1 hour\n50000: 50000 second"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(t.h3,{id:"example",children:"Example"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"Create a set of row security policies"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:"CREATE ROW POLICY test_row_policy_1 ON test.table1 \nAS RESTRICTIVE TO test USING (c1 = 'a');\n"})}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:"CREATE ROW POLICY test_row_policy_2 ON test.table1 \nAS RESTRICTIVE TO test USING (c2 = 'b');\n"})}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:"CREATE ROW POLICY test_row_policy_3 ON test.table1 \nAS PERMISSIVE TO test USING (c3 = 'c');\n"})}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:"CREATE ROW POLICY test_row_policy_3 ON test.table1 \nAS PERMISSIVE TO test USING (c4 = 'd');\n"})}),"\n",(0,l.jsx)(t.p,{children:"When we execute the query on Table1, the rewritten SQL is"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:"select * from (select * from table1 where c1 = 'a' and c2 = 'b' or c3 = 'c' or c4 = 'd')\n"})}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"Create policy for storage"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["NOTE\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"To create a cold hot separation policy, you must first create a resource, and then associate the created resource name when creating a migration policy"}),"\n",(0,l.jsx)(t.li,{children:"Currently, the drop data migration policy is not supported to prevent data from being migrated. If the policy has been deleted, then the system cannot retrieve the data"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(t.li,{children:"Create policy on cooldown_datetime"}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:'CREATE STORAGE POLICY testPolicy\nPROPERTIES(\n  "storage_resource" = "s3",\n  "cooldown_datetime" = "2022-06-08 00:00:00"\n);\n'})}),"\n",(0,l.jsxs)(t.ol,{start:"3",children:["\n",(0,l.jsx)(t.li,{children:"Create policy on cooldown_ttl"}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:'CREATE STORAGE POLICY testPolicy\nPROPERTIES(\n  "storage_resource" = "s3",\n  "cooldown_ttl" = "1d"\n);\n'})}),"\n",(0,l.jsx)(t.p,{children:"Relevant parameters are as follows:"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:[(0,l.jsx)(t.code,{children:"storage_resource"}),":  the storage resource of create"]}),"\n",(0,l.jsxs)(t.li,{children:[(0,l.jsx)(t.code,{children:"cooldown_datetime"}),": Data migration time"]}),"\n",(0,l.jsxs)(t.li,{children:[(0,l.jsx)(t.code,{children:"cooldown_ttl"}),": Countdown of the distance between the migrated data and the current time"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(t.h3,{id:"keywords",children:"Keywords"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:"CREATE, POLICY\n"})}),"\n",(0,l.jsx)(t.h3,{id:"best-practice",children:"Best Practice"})]})}function h(e={}){let{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return a},a:function(){return r}});var s=n(667294);let l={},i=s.createContext(l);function r(e){let t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);