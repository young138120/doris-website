"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["280900"],{65285:function(e,t,n){n.r(t),n.d(t,{metadata:()=>a,contentTitle:()=>o,default:()=>h,assets:()=>l,toc:()=>c,frontMatter:()=>s});var a=JSON.parse('{"id":"data-operate/import/import-scenes/jdbc-load","title":"Synchronize data using Insert method","description":"\x3c!--","source":"@site/versioned_docs/version-1.2/data-operate/import/import-scenes/jdbc-load.md","sourceDirName":"data-operate/import/import-scenes","slug":"/data-operate/import/import-scenes/jdbc-load","permalink":"/docs/1.2/data-operate/import/import-scenes/jdbc-load","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"Synchronize data using Insert method","language":"en"},"sidebar":"docs","previous":{"title":"Synchronize data through external table","permalink":"/docs/1.2/data-operate/import/import-scenes/external-table-load"},"next":{"title":"Data import things and atomicity","permalink":"/docs/1.2/data-operate/import/import-scenes/load-atomicity"}}'),i=n("785893"),r=n("250065");let s={title:"Synchronize data using Insert method",language:"en"},o="Synchronize data using Insert method",l={},c=[{value:"Single write",id:"single-write",level:2},{value:"JDBC example",id:"jdbc-example",level:2}];function d(e){let t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"synchronize-data-using-insert-method",children:"Synchronize data using Insert method"})}),"\n",(0,i.jsx)(t.p,{children:"Users can use INSERT statement to import data through MySQL protocol."}),"\n",(0,i.jsx)(t.p,{children:"The INSERT statement is used in a similar way to the INSERT statement used in databases such as MySQL. The INSERT statement supports the following two syntaxes:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"* INSERT INTO table SELECT ...\n* INSERT INTO table VALUES(...)\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Here we only introduce the second way. For a detailed description of the INSERT command, see the ",(0,i.jsx)(t.a,{href:"/docs/1.2/sql-manual/sql-reference/Data-Manipulation-Statements/Manipulation/INSERT",children:"INSERT"})," command documentation."]}),"\n",(0,i.jsx)(t.h2,{id:"single-write",children:"Single write"}),"\n",(0,i.jsx)(t.p,{children:"Single write means that the user directly executes an INSERT command. An example is as follows:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:'INSERT INTO example_tbl (col1, col2, col3) VALUES (1000, "test", 3.25);\n'})}),"\n",(0,i.jsx)(t.p,{children:"For Doris, an INSERT command is a complete import transaction."}),"\n",(0,i.jsx)(t.p,{children:"Therefore, whether it is importing one piece of data or multiple pieces of data, we do not recommend using this method for data import in the production environment. The INSERT operation of high-frequency words will result in a large number of small files in the storage layer, which will seriously affect the system performance."}),"\n",(0,i.jsx)(t.p,{children:"This method is only used for simple offline tests or low-frequency operations."}),"\n",(0,i.jsx)(t.p,{children:"Or you can use the following methods for batch insert operations:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:'INSERT INTO example_tbl VALUES\n(1000, "baidu1", 3.25)\n(2000, "baidu2", 4.25)\n(3000, "baidu3", 5.25);\n'})}),"\n",(0,i.jsx)(t.p,{children:"We recommend that the number of inserts in a batch be as large as possible, such as thousands or even 10,000 at a time. Or you can use PreparedStatement to perform batch inserts through the following procedure."}),"\n",(0,i.jsx)(t.h2,{id:"jdbc-example",children:"JDBC example"}),"\n",(0,i.jsx)(t.p,{children:"Here we give a simple JDBC batch INSERT code example:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:'package demo.doris;\n\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.PreparedStatement;\nimport java.sql.SQLException;\n\npublic class DorisJDBCDemo {\n\n    private static final String JDBC_DRIVER = "com.mysql.jdbc.Driver";\n    private static final String DB_URL_PATTERN = "jdbc:mysql://%s:%d/%s?rewriteBatchedStatements=true";\n    private static final String HOST = "127.0.0.1"; // Leader Node host\n    private static final int PORT = 9030; // query port of Leader Node\n    private static final String DB = "demo";\n    private static final String TBL = "test_1";\n    private static final String USER = "admin";\n    private static final String PASSWD = "my_pass";\n\n    private static final int INSERT_BATCH_SIZE = 10000;\n\n    public static void main(String[] args) {\n        insert();\n    }\n\n    private static void insert() {\n        // Be careful not to add a semicolon ";" at the end\n        String query = "insert into " + TBL + " values(?, ?)";\n        // Set Label to be idempotent.\n        // String query = "insert into " + TBL + " WITH LABEL my_label values(?, ?)";\n\n        Connection conn = null;\n        PreparedStatement stmt = null;\n        String dbUrl = String.format(DB_URL_PATTERN, HOST, PORT, DB);\n        try {\n            Class.forName(JDBC_DRIVER);\n            conn = DriverManager.getConnection(dbUrl, USER, PASSWD);\n            stmt = conn.prepareStatement(query);\n\n            for (int i =0; i < INSERT_BATCH_SIZE; i++) {\n                stmt.setInt(1, i);\n                stmt.setInt(2, i * 100);\n                stmt.addBatch();\n            }\n\n            int[] res = stmt.executeBatch();\n            System.out.println(res);\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            try {\n                if (stmt != null) {\n                    stmt.close();\n                }\n            } catch (SQLException se2) {\n                se2.printStackTrace();\n            }\n            try {\n                if (conn != null) conn.close();\n            } catch (SQLException se) {\n                se.printStackTrace();\n            }\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"Please note the following:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["The JDBC connection string needs to add the ",(0,i.jsx)(t.code,{children:"rewriteBatchedStatements=true"})," parameter and use the ",(0,i.jsx)(t.code,{children:"PreparedStatement"})," method."]}),"\n",(0,i.jsx)(t.p,{children:"Currently, Doris does not support PrepareStatemnt on the server side, so the JDBC Driver will perform batch Prepare on the client side."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"rewriteBatchedStatements=true"})," will ensure that the Driver executes batches. And finally form an INSERT statement of the following form and send it to Doris:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:'INSERT INTO example_tbl VALUES\n(1000, "baidu1", 3.25)\n(2000, "baidu2", 4.25)\n(3000, "baidu3", 5.25);\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Batch size"}),"\n",(0,i.jsx)(t.p,{children:"Because batch processing is performed on the client, if a batch is too large, it will occupy the memory resources of the client, so you need to pay attention."}),"\n",(0,i.jsx)(t.p,{children:"Doris will support PrepareStatemnt on the server in the future, so stay tuned."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import atomicity"}),"\n",(0,i.jsx)(t.p,{children:"Like other import methods, the INSERT operation itself supports atomicity. Each INSERT operation is an import transaction, which guarantees atomic writing of all data in an INSERT."}),"\n",(0,i.jsx)(t.p,{children:'As mentioned earlier, we recommend that when using INSERT to import data, use the "batch" method to import, rather than a single insert.'}),"\n",(0,i.jsxs)(t.p,{children:["At the same time, we can set a Label for each INSERT operation. Through the ",(0,i.jsx)(t.a,{href:"/docs/1.2/data-operate/import/import-scenes/load-atomicity",children:"Label mechanism"}),", the idempotency and atomicity of operations can be guaranteed, and the data will not be lost or heavy in the end. For the specific usage of Label in INSERT, you can refer to the ",(0,i.jsx)(t.a,{href:"/docs/1.2/sql-manual/sql-reference/Data-Manipulation-Statements/Manipulation/INSERT",children:"INSERT"})," document."]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return o},a:function(){return s}});var a=n(667294);let i={},r=a.createContext(i);function s(e){let t=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);