"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["175812"],{640200:function(e,n,s){s.r(n),s.d(n,{metadata:()=>i,contentTitle:()=>o,default:()=>h,assets:()=>c,toc:()=>d,frontMatter:()=>l});var i=JSON.parse('{"id":"install/k8s-deploy","title":"Kubernetes Deployment","description":"\x3c!--","source":"@site/versioned_docs/version-1.2/install/k8s-deploy.md","sourceDirName":"install","slug":"/install/k8s-deploy","permalink":"/docs/1.2/install/k8s-deploy","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"Kubernetes Deployment","language":"en"},"sidebar":"docs","previous":{"title":"Deploy Docker cluster","permalink":"/docs/1.2/install/construct-docker/run-docker-cluster"},"next":{"title":"General Compilation","permalink":"/docs/1.2/install/source-install/compilation-general"}}'),r=s("785893"),t=s("250065");let l={title:"Kubernetes Deployment",language:"en"},o="K8s Deployment Doris",c={},d=[{value:"Environmental Preparation",id:"environmental-preparation",level:2},{value:"Starting a cluster",id:"starting-a-cluster",level:2},{value:"Expansion and contraction capacity",id:"expansion-and-contraction-capacity",level:2},{value:"test and verify",id:"test-and-verify",level:2},{value:"K8s simple operation command",id:"k8s-simple-operation-command",level:2},{value:"common problem",id:"common-problem",level:2}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"k8s-deployment-doris",children:"K8s Deployment Doris"})}),"\n",(0,r.jsx)(n.h2,{id:"environmental-preparation",children:"Environmental Preparation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Installation k8s"}),"\n",(0,r.jsxs)(n.li,{children:["Build or download a Doris image\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Building an image ",(0,r.jsx)(n.a,{href:"./construct-docker/construct-docker-image",children:"Build Docker Image"})]}),"\n",(0,r.jsxs)(n.li,{children:["Download Image ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/r/apache/doris/tags",children:"https://hub.docker.com/r/apache/doris/tags"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Create or download the yml file for Doris on k8s\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/apache/doris/blob/master/docker/runtime/k8s/doris_follower.yml",children:"https://github.com/apache/doris/blob/master/docker/runtime/k8s/doris_follower.yml"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/apache/doris/blob/master/docker/runtime/k8s/doris_be.yml",children:"https://github.com/apache/doris/blob/master/docker/runtime/k8s/doris_be.yml"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/apache/doris/blob/master/docker/runtime/k8s/doris_cn.yml",children:"https://github.com/apache/doris/blob/master/docker/runtime/k8s/doris_cn.yml"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"starting-a-cluster",children:"Starting a cluster"}),"\n",(0,r.jsxs)(n.p,{children:["Start FE (role type is Follower):",(0,r.jsx)(n.code,{children:"kubectl create -f doris_follower.yml"})]}),"\n",(0,r.jsxs)(n.p,{children:["Start BE:",(0,r.jsx)(n.code,{children:"kubectl create -f doris_be.yml"})]}),"\n",(0,r.jsxs)(n.p,{children:["Start the BE (role type is Compute Node):",(0,r.jsx)(n.code,{children:"kubectl create -f doris_cn.yml"})]}),"\n",(0,r.jsx)(n.h2,{id:"expansion-and-contraction-capacity",children:"Expansion and contraction capacity"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["FE\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Currently, scaling is not supported. It is recommended to initialize 1 or 3 nodes as needed"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["BE\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Command:",(0,r.jsx)(n.code,{children:"kubectl scale statefulset doris-be-cluster1 --replicas=4"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["BE (role type is Compute Node)\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Command:",(0,r.jsx)(n.code,{children:"kubectl scale statefulset doris-cn-cluster1 --replicas=4"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"test-and-verify",children:"test and verify"}),"\n",(0,r.jsx)(n.p,{children:"Connect to the FE using mysql-client and perform operations such as' show backends' and 'show frontends' to view the status of each node"}),"\n",(0,r.jsx)(n.h2,{id:"k8s-simple-operation-command",children:"K8s simple operation command"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Executing the yml file for the first time ",(0,r.jsx)(n.code,{children:"kubectl create -f xxx.yml"})]}),"\n",(0,r.jsxs)(n.li,{children:["Execute after modifying the yml file ",(0,r.jsx)(n.code,{children:"kubectl apply -f xxx.yml"})]}),"\n",(0,r.jsxs)(n.li,{children:["Delete all resources defined by yml ",(0,r.jsx)(n.code,{children:"kubectl delete -f xxx.yml"})]}),"\n",(0,r.jsxs)(n.li,{children:["View the pod list ",(0,r.jsx)(n.code,{children:"kubectl get pods"})]}),"\n",(0,r.jsxs)(n.li,{children:["Entering the container ",(0,r.jsx)(n.code,{children:"kubectl exec -it xxx\uFF08podName\uFF09 -- /bin/sh"})]}),"\n",(0,r.jsxs)(n.li,{children:["view log ",(0,r.jsx)(n.code,{children:"kubectl logs xxx\uFF08podName\uFF09"})]}),"\n",(0,r.jsxs)(n.li,{children:["View IP and port information ",(0,r.jsx)(n.code,{children:"kubectl get ep"})]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io",children:"More knowledge of k8s"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"common-problem",children:"common problem"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"How is data persistent?"}),"\n",(0,r.jsx)(n.p,{children:"Users need to mount PVC on their own to persist metadata information, data information, or log information"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"How to safely shrink the BE node?"}),"\n",(0,r.jsxs)(n.p,{children:["BE:User manual execution is required before current resizing",(0,r.jsx)(n.a,{href:"../../docs/sql-manual/sql-reference/Cluster-Management-Statements/ALTER-SYSTEM-DECOMMISSION-BACKEND",children:"ALTER-SYSTEM-DECOMMISSION-BACKEND"})]}),"\n",(0,r.jsxs)(n.p,{children:["BE(The role type is Compute Node): Do not store data files and can directly shrink\uFF0C",(0,r.jsx)(n.a,{href:"../../docs/advanced/compute_node",children:"About Computing Nodes"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:'FE startup error "failed to init statefulSetName"'}),"\n",(0,r.jsx)(n.p,{children:"doris_ The environment variables statefulSetName and serviceName for follower. yml must appear in pairs, such as CN configured_ SERVICE, CN must be configured_ STATEFULSET"}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return o},a:function(){return l}});var i=s(667294);let r={},t=i.createContext(r);function l(e){let n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);