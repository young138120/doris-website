"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["842521"],{686023:function(e,n,t){t.r(n),t.d(n,{metadata:()=>o,contentTitle:()=>r,default:()=>h,assets:()=>d,toc:()=>l,frontMatter:()=>a});var o=JSON.parse('{"id":"advanced/compute_node","title":"Compute Node","description":"<! --","source":"@site/versioned_docs/version-1.2/advanced/compute_node.md","sourceDirName":"advanced","slug":"/advanced/compute_node","permalink":"/docs/1.2/advanced/compute_node","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"Compute Node","language":"en"},"sidebar":"docs","previous":{"title":"Cold hot separation","permalink":"/docs/1.2/advanced/cold_hot_separation"},"next":{"title":"Column to Row (Lateral View)","permalink":"/docs/1.2/advanced/lateral-view"}}'),i=t("785893"),s=t("250065");let a={title:"Compute Node",language:"en"},r="Compute node",d={},l=[{value:"Scenario",id:"scenario",level:2},{value:"solution",id:"solution",level:2},{value:"Usage of ComputeNode",id:"usage-of-computenode",level:2},{value:"Configure",id:"configure",level:3},{value:"Usage",id:"usage",level:3},{value:"some restrictions",id:"some-restrictions",level:3},{value:"TODO",id:"todo",level:2}];function c(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",version:"version",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:'<! --\nLicensed to the Apache Software Foundation (ASF) under one\nOr more contributor license agreements. See the NOTICE file\nDistributed with this work for additional information\nRegarding copyright ownership. The ASF licenses this file\nTo you under the Apache License, Version 2.0 (the\n"License"); you may not use this file except in compliance\nWith the License. You may obtain a copy of the License at'}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"http://www.apache.org/licenses/LICENSE-2.0",children:"http://www.apache.org/licenses/LICENSE-2.0"})}),"\n",(0,i.jsx)(n.p,{children:'Unless required by applicable law or agreed to in writing,\nSoftware distributed under the License is distributed on an\n"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, either expressed or implied. See the License for the\nSpecific language governing permissions and limitations\nUnder the License.\n-- >'}),"\n",(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"compute-node",children:"Compute node"})}),"\n",(0,i.jsx)(n.version,{since:"1.2.1",children:"\n"}),"\n",(0,i.jsx)(n.h2,{id:"scenario",children:"Scenario"}),"\n",(0,i.jsx)(n.p,{children:"At present, Doris is a typical Share-Nothing architecture, which achieves very high performance by binding data and computing resources in the same node.\nWith the continuous improvement of the performance for the Doris computing engine, more and more users have begun to use Doris to directly query data on data lake.\nThis is a Share-Disk scenario that data is often stored on the remote HDFS/S3, and calculated in Doris.\nDoris will get the data through the network, and then completes the computation in memory.\nFor these two mixed loads in one cluster, current Doris architecture will appear some disadvantages:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Poor resource isolation, the response requirements of these two loads are different, and the hybrid deployment will have mutual effects."}),"\n",(0,i.jsx)(n.li,{children:"Poor disk usage, the data lake query only needs the computing resources, while doris binding the storage and computing and we have to expand them together, and cause a low utilization rate for disk."}),"\n",(0,i.jsx)(n.li,{children:"Poor expansion efficiency, when the cluster is expanded, Doris will start the migration of Tablet data, and this process will take a lot of time. And the data lake query load has obvious peaks and valleys, it need hourly flexibility."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"solution",children:"solution"}),"\n",(0,i.jsxs)(n.p,{children:["Implement a BE node role specially used for federated computing named ",(0,i.jsx)(n.code,{children:"Compute node"}),".\n",(0,i.jsx)(n.code,{children:"Compute node"})," is used to handle remote federated queries such as this query of data lake.\nThe original BE node type is called ",(0,i.jsx)(n.code,{children:"hybrid node"}),", and this type of node can not only execute SQL query, but also handle tablet data storage.\nAnd the ",(0,i.jsx)(n.code,{children:"Compute node"})," only can execute SQL query, it have no data on node."]}),"\n",(0,i.jsx)(n.p,{children:"With the computing node, the cluster deployment topology will also change:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["the ",(0,i.jsx)(n.code,{children:"hybrid node"})," is used for the data calculation of the OLAP type table, the node is expanded according to the storage demand"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["the ",(0,i.jsx)(n.code,{children:"computing node"})," is used for the external computing, and this node is expanded according to the query load."]}),"\n",(0,i.jsx)(n.p,{children:"Since the compute node has no storage, the compute node can be deployed on an HDD disk machine with other workload or on a container."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"usage-of-computenode",children:"Usage of ComputeNode"}),"\n",(0,i.jsx)(n.h3,{id:"configure",children:"Configure"}),"\n",(0,i.jsxs)(n.p,{children:["Add configuration items to BE's configuration file ",(0,i.jsx)(n.code,{children:"be.conf"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:" be_node_role = computation \n"})}),"\n",(0,i.jsxs)(n.p,{children:["This defualt value of this is ",(0,i.jsx)(n.code,{children:"mix"}),", and this is original BE node type. After setting to ",(0,i.jsx)(n.code,{children:"computation"}),", the node is a computing node."]}),"\n",(0,i.jsxs)(n.p,{children:["You can see the value of the'NodeRole 'field through the ",(0,i.jsx)(n.code,{children:"show backend\\G"})," command. If it is'mix ', it is a mixed node, and if it is'computation', it is a computing node"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'*************************** 1. row ***************************\n              BackendId: 10010\n                Cluster: default_cluster\n                     IP: 10.248.181.219\n          HeartbeatPort: 9050\n                 BePort: 9060\n               HttpPort: 8040\n               BrpcPort: 8060\n          LastStartTime: 2022-11-30 23:01:40\n          LastHeartbeat: 2022-12-05 15:01:18\n                  Alive: true\n   SystemDecommissioned: false\n  ClusterDecommissioned: false\n              TabletNum: 753\n       DataUsedCapacity: 1.955 GB\n          AvailCapacity: 202.987 GB\n          TotalCapacity: 491.153 GB\n                UsedPct: 58.67 %\n         MaxDiskUsedPct: 58.67 %\n     RemoteUsedCapacity: 0.000\n                    Tag: {"location" : "default"}\n                 ErrMsg:\n                Version: doris-0.0.0-trunk-80baca264\n                 Status: {"lastSuccessReportTabletsTime":"2022-12-05 15:00:38","lastStreamLoadTime":-1,"isQueryDisabled":false,"isLoadDisabled":false}\nHeartbeatFailureCounter: 0\n               NodeRole: computation\n'})}),"\n",(0,i.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(n.p,{children:"Add configuration items in fe.conf"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"prefer_compute_node_for_external_table=true\nmin_backend_num_for_external_table=3\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["For parameter description, please refer to: ",(0,i.jsx)(n.a,{href:"/docs/1.2/admin-manual/config/fe-config",children:"FE configuration item"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["When using the ",(0,i.jsx)(n.a,{href:"/docs/1.2/lakehouse/multi-catalog/",children:"MultiCatalog"})," function when querying, the query will be dispatched to the computing node first."]}),"\n",(0,i.jsx)(n.h3,{id:"some-restrictions",children:"some restrictions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Compute nodes are controlled by configuration items, so do not configure mixed type nodes, modify the configuration to compute nodes."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"todo",children:"TODO"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Computational spillover: Doris inner table query, when the cluster load is high, the upper layer (outside TableScan) operator can be scheduled to the compute node."}),"\n",(0,i.jsxs)(n.li,{children:["Graceful offline:\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"When the compute node goes offline, the new task of the task is automatically scheduled to online nodes"}),"\n",(0,i.jsx)(n.li,{children:"the node go offline after all the old tasks on the node are completed"}),"\n",(0,i.jsx)(n.li,{children:"when the old task cannot be completed on time, the task can kill by itself"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return r},a:function(){return a}});var o=t(667294);let i={},s=o.createContext(i);function a(e){let n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);