"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["836621"],{213478:function(e,n,a){a.r(n),a.d(n,{metadata:()=>s,contentTitle:()=>r,default:()=>h,assets:()=>o,toc:()=>d,frontMatter:()=>l});var s=JSON.parse('{"id":"data-table/basic-usage","title":"Guidelines for Basic Use","description":"\x3c!--","source":"@site/versioned_docs/version-1.2/data-table/basic-usage.md","sourceDirName":"data-table","slug":"/data-table/basic-usage","permalink":"/docs/1.2/data-table/basic-usage","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"Guidelines for Basic Use","language":"en"},"sidebar":"docs","previous":{"title":"Data Partition","permalink":"/docs/1.2/data-table/data-partition"},"next":{"title":"Rollup and query","permalink":"/docs/1.2/data-table/hit-the-rollup"}}'),t=a("785893"),i=a("250065");let l={title:"Guidelines for Basic Use",language:"en"},r="User Guide",o={},d=[{value:"Create Users",id:"create-users",level:2},{value:"Root User Login and Change Password",id:"root-user-login-and-change-password",level:3},{value:"Create New Users",id:"create-new-users",level:3},{value:"Create Data Table and Import Data",id:"create-data-table-and-import-data",level:2},{value:"Create a database",id:"create-a-database",level:3},{value:"Authorize an Account",id:"authorize-an-account",level:3},{value:"Create a Table",id:"create-a-table",level:3},{value:"Single Partitioning",id:"single-partitioning",level:4},{value:"Compound Partitioning",id:"compound-partitioning",level:4},{value:"Load data",id:"load-data",level:3},{value:"Stream Load",id:"stream-load",level:4},{value:"Broker Load",id:"broker-load",level:4},{value:"Query the Data",id:"query-the-data",level:2},{value:"Simple Query",id:"simple-query",level:3},{value:"SELECT * EXCEPT",id:"select--except",level:3},{value:"Join Query",id:"join-query",level:3},{value:"Subquery",id:"subquery",level:3},{value:"Change Table Schema",id:"change-table-schema",level:2},{value:"Rollup",id:"rollup",level:2},{value:"Materialized Views",id:"materialized-views",level:2},{value:"Data Table Queries",id:"data-table-queries",level:2},{value:"Memory Limit",id:"memory-limit",level:3},{value:"Query Timeout",id:"query-timeout",level:3},{value:"Broadcast/Shuffle Join",id:"broadcastshuffle-join",level:3},{value:"Query Retry and High Availability",id:"query-retry-and-high-availability",level:3},{value:"Update and Delete Data",id:"update-and-delete-data",level:2}];function c(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"user-guide",children:"User Guide"})}),"\n",(0,t.jsx)(n.p,{children:"Doris uses MySQL protocol for communication. Users can connect to Doris clusters through MySQL Client or MySQL JDBC. MySQL Client 5.1 or newer versions are recommended because they support user names of more than 16 characters. This topic walks you through how to use Doris with the example of MySQL Client."}),"\n",(0,t.jsx)(n.h2,{id:"create-users",children:"Create Users"}),"\n",(0,t.jsx)(n.h3,{id:"root-user-login-and-change-password",children:"Root User Login and Change Password"}),"\n",(0,t.jsx)(n.p,{children:"Doris has its built-in root, and the default password is empty."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Note:"}),"\n",(0,t.jsx)(n.p,{children:"Doris provides a default root."}),"\n",(0,t.jsx)(n.p,{children:"The root user has all the privileges about the clusters by default. Users who have both Grant_priv and Node_priv can grant these privileges to other users. Node changing privileges include adding, deleting, and offlining FE, BE, and BROKER nodes."}),"\n",(0,t.jsxs)(n.p,{children:["For more instructions on privileges, please refer to ",(0,t.jsx)(n.a,{href:"/docs/1.2/admin-manual/privilege-ldap/user-privilege",children:"Privilege Management"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"After starting the Doris program, root or admin users can connect to Doris clusters. You can use the following command to log in to Doris. After login, you will enter the corresponding MySQL command line interface."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"[root@doris ~]# mysql  -h FE_HOST -P9030 -uroot\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 41\nServer version: 5.1.0 Doris version 1.0.0-preview2-b48ee2734\n\nCopyright (c) 2000, 2022, Oracle and/or its affiliates.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> \n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:" FE_HOST"})," is the IP address of any FE node. ",(0,t.jsx)(n.code,{children:"9030"})," is the query_port configuration in fe.conf."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"After login, you can change the root password by the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"mysql> SET PASSWORD FOR 'root' = PASSWORD('your_password');\nQuery OK, 0 rows affected (0.00 sec)\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"your_password"})," is a new password for the ",(0,t.jsx)(n.code,{children:"root"})," user, which can be set at will. A strong password is recommended for security. The new password is required in the next login."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"create-new-users",children:"Create New Users"}),"\n",(0,t.jsxs)(n.p,{children:["You can create a regular user named  ",(0,t.jsx)(n.code,{children:"test"})," with the following command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"mysql> CREATE USER 'test' IDENTIFIED BY 'test_passwd';\nQuery OK, 0 rows affected (0.00 sec)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Follow-up logins can be performed with the following connection commands."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"[root@doris ~]# mysql -h FE_HOST -P9030 -utest -ptest_passwd\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"By default, the newly created regular users do not have any privileges. Privileges can be granted to these users."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"create-data-table-and-import-data",children:"Create Data Table and Import Data"}),"\n",(0,t.jsx)(n.h3,{id:"create-a-database",children:"Create a database"}),"\n",(0,t.jsx)(n.p,{children:"Initially, root or admin users can create a database by the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE DATABASE example_db;\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["You can use the  ",(0,t.jsx)(n.code,{children:"HELP"})," command to check the syntax of all commands. For example, ",(0,t.jsx)(n.code,{children:"HELP CREATE DATABASE;"}),". Or you can refer to the ",(0,t.jsx)(n.a,{href:"/docs/1.2/sql-manual/sql-reference/Show-Statements/SHOW-CREATE-DATABASE",children:"SHOW CREATE DATABASE"})," command manual."]}),"\n",(0,t.jsxs)(n.p,{children:['If you don\'t know the full name of the command, you can use "HELP + a field of the command" for fuzzy query. For example, if you type in  ',(0,t.jsx)(n.code,{children:"HELP CREATE"}),", you can find commands including ",(0,t.jsx)(n.code,{children:"CREATE DATABASE"}),", ",(0,t.jsx)(n.code,{children:"CREATE TABLE"}),", and ",(0,t.jsx)(n.code,{children:"CREATE USER"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mysql> HELP CREATE;\nMany help items for your request exist.\nTo make a more specific request, please type 'help <item>',\nwhere <item> is one of the following\ntopics:\n   CREATE CLUSTER\n   CREATE DATABASE\n   CREATE ENCRYPTKEY\n   CREATE FILE\n   CREATE FUNCTION\n   CREATE INDEX\n   CREATE MATERIALIZED VIEW\n   CREATE REPOSITORY\n   CREATE RESOURCE\n   CREATE ROLE\n   CREATE SYNC JOB\n   CREATE TABLE\n   CREATE USER\n   CREATE VIEW\n   ROUTINE LOAD\n   SHOW CREATE FUNCTION\n   SHOW CREATE ROUTINE LOAD\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["After the database is created, you can view the information about the database via the ",(0,t.jsx)(n.a,{href:"/docs/1.2/sql-manual/sql-reference/Show-Statements/SHOW-DATABASES",children:"SHOW DATABASES"})," command."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"MySQL> SHOW DATABASES;\n+--------------------+\n| Database           |\n+--------------------+\n| example_db         |\n| information_schema |\n+--------------------+\n2 rows in set (0.00 sec)\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"information_schema"})," exists for compatibility with MySQL protocol, so the information might not be 100% accurate in practice. Therefore, for information about the specific databases, please query the corresponding databases directly."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"authorize-an-account",children:"Authorize an Account"}),"\n",(0,t.jsxs)(n.p,{children:["After  ",(0,t.jsx)(n.code,{children:"example_db"}),"  is created, root/admin users can grant read/write privileges of ",(0,t.jsx)(n.code,{children:"example_db"}),"  to regular users, such as ",(0,t.jsx)(n.code,{children:"test"}),", using the ",(0,t.jsx)(n.code,{children:"GRANT"})," command. After authorization, user ",(0,t.jsx)(n.code,{children:"test"})," can perform operations on ",(0,t.jsx)(n.code,{children:"example_db"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"mysql> GRANT ALL ON example_db TO test;\nQuery OK, 0 rows affected (0.01 sec)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"create-a-table",children:"Create a Table"}),"\n",(0,t.jsxs)(n.p,{children:["You can create a table using the ",(0,t.jsx)(n.a,{href:"/docs/1.2/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-TABLE",children:"CREATE TABLE"})," command. For detailed parameters, you can send a  ",(0,t.jsx)(n.code,{children:"HELP CREATE TABLE;"})," command."]}),"\n",(0,t.jsxs)(n.p,{children:["Firstly, you need to switch to the target database using the ",(0,t.jsx)(n.a,{href:"/docs/1.2/sql-manual/sql-reference/Utility-Statements/USE",children:"USE"})," command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"mysql> USE example_db;\nDatabase changed\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Doris supports two table creation methods: ",(0,t.jsx)(n.a,{href:"/docs/1.2/data-table/data-partition",children:"compound partitioning and single partitioning"}),". The following takes the Aggregate Model as an example to demonstrate how to create tables with these two methods, respectively."]}),"\n",(0,t.jsx)(n.h4,{id:"single-partitioning",children:"Single Partitioning"}),"\n",(0,t.jsxs)(n.p,{children:["Create a logical table named ",(0,t.jsx)(n.code,{children:"table1"}),". The bucketing column is the ",(0,t.jsx)(n.code,{children:"siteid"})," column, and the number of buckets is 10."]}),"\n",(0,t.jsx)(n.p,{children:"The table schema is as follows:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"siteid"}),":  INT (4 bytes); default value: 10"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"citycode"}),": SMALLINT (2 bytes)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"username"}),": VARCHAR, with a maximum length of 32; default value: empty string"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pv"}),": BIGINT (8 bytes); default value: 0; This is a metric column, and Doris will aggregate the metric columns internally. The ",(0,t.jsx)(n.code,{children:"pv"})," column is aggregated by SUM."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The corresponding CREATE TABLE statement is as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE table1\n(\n    siteid INT DEFAULT '10',\n    citycode SMALLINT,\n    username VARCHAR(32) DEFAULT '',\n    pv BIGINT SUM DEFAULT '0'\n)\nAGGREGATE KEY(siteid, citycode, username)\nDISTRIBUTED BY HASH(siteid) BUCKETS 10\nPROPERTIES(\"replication_num\" = \"1\");\n"})}),"\n",(0,t.jsx)(n.h4,{id:"compound-partitioning",children:"Compound Partitioning"}),"\n",(0,t.jsxs)(n.p,{children:["Create a logical table named ",(0,t.jsx)(n.code,{children:"table2"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"The table schema is as follows:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"event_day"}),": DATE; no default value"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"siteid"}),": INT (4 bytes); default value: 10"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"citycode"}),": SMALLINT (2 bytes)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"username"}),": VARCHAR, with a maximum length of 32; default value: empty string"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pv"}),": BIGINT (8 bytes); default value: 0; This is a metric column, and Doris will aggregate the metric columns internally. The ",(0,t.jsx)(n.code,{children:"pv"})," column is aggregated by SUM."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Use the ",(0,t.jsx)(n.code,{children:"event_day"})," column as the partitioning column and create 3 partitions: p201706, p201707, and p201708."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"p201706: Range [Minimum, 2017-07-01)"}),"\n",(0,t.jsx)(n.li,{children:"p201707: Range [2017-07-01, 2017-08-01)"}),"\n",(0,t.jsx)(n.li,{children:"p201708: Range [2017-08-01, 2017-09-01)"}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Note that the intervals are left-closed and right-open."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["HASH bucket each partition based on ",(0,t.jsx)(n.code,{children:"siteid"}),". The number of buckets per partition is 10."]}),"\n",(0,t.jsx)(n.p,{children:"The corresponding CREATE TABLE statement is as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE table2\n(\n    event_day DATE,\n    siteid INT DEFAULT '10',\n    citycode SMALLINT,\n    username VARCHAR(32) DEFAULT '',\n    pv BIGINT SUM DEFAULT '0'\n)\nAGGREGATE KEY(event_day, siteid, citycode, username)\nPARTITION BY RANGE(event_day)\n(\n    PARTITION p201706 VALUES LESS THAN ('2017-07-01'),\n    PARTITION p201707 VALUES LESS THAN ('2017-08-01'),\n    PARTITION p201708 VALUES LESS THAN ('2017-09-01')\n)\nDISTRIBUTED BY HASH(siteid) BUCKETS 10\nPROPERTIES(\"replication_num\" = \"1\");\n"})}),"\n",(0,t.jsxs)(n.p,{children:["After the table is created, you can view the information of the table in ",(0,t.jsx)(n.code,{children:"example_db"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"MySQL> SHOW TABLES;\n+----------------------+\n| Tables_in_example_db |\n+----------------------+\n| table1               |\n| table2               |\n+----------------------+\n2 rows in set (0.01 sec)\n\nMySQL> DESC table1;\n+----------+-------------+------+-------+---------+-------+\n| Field    | Type        | Null | Key   | Default | Extra |\n+----------+-------------+------+-------+---------+-------+\n| siteid   | int(11)     | Yes  | true  | 10      |       |\n| citycode | smallint(6) | Yes  | true  | N/A     |       |\n| username | varchar(32) | Yes  | true  |         |       |\n| pv       | bigint(20)  | Yes  | false | 0       | SUM   |\n+----------+-------------+------+-------+---------+-------+\n4 rows in set (0.00 sec)\n\nMySQL> DESC table2;\n+-----------+-------------+------+-------+---------+-------+\n| Field     | Type        | Null | Key   | Default | Extra |\n+-----------+-------------+------+-------+---------+-------+\n| event_day | date        | Yes  | true  | N/A     |       |\n| siteid    | int(11)     | Yes  | true  | 10      |       |\n| citycode  | smallint(6) | Yes  | true  | N/A     |       |\n| username  | varchar(32) | Yes  | true  |         |       |\n| pv        | bigint(20)  | Yes  | false | 0       | SUM   |\n+-----------+-------------+------+-------+---------+-------+\n5 rows in set (0.00 sec)\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Note:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["As  ",(0,t.jsx)(n.code,{children:"replication_num"}),"  is set to ",(0,t.jsx)(n.code,{children:"1"}),", the above tables are created with only one copy. We recommend that you adopt the default three-copy settings to ensure high availability."]}),"\n",(0,t.jsxs)(n.li,{children:["You can dynamically add or delete partitions of compoundly partitioned tables. See  ",(0,t.jsx)(n.code,{children:"HELP ALTER TABLE"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["You can import data into the specified Partition. See ",(0,t.jsx)(n.code,{children:"HELP LOAD;"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["You can dynamically change the table schema. See ",(0,t.jsx)(n.code,{children:"HELP ALTER TABLE;"}),"."]}),"\n",(0,t.jsx)(n.li,{children:'You can add Rollups to Tables to improve query performance. See the Rollup-related section in "Advanced Usage".'}),"\n",(0,t.jsx)(n.li,{children:"The default value in the Null column is true, which may affect query performance."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"load-data",children:"Load data"}),"\n",(0,t.jsxs)(n.p,{children:["Doris supports a variety of data loading methods. You can refer to ",(0,t.jsx)(n.a,{href:"/docs/1.2/data-operate/import/load-manual",children:"Data Loading"})," for more details. The following uses Stream Load and Broker Load as examples."]}),"\n",(0,t.jsx)(n.h4,{id:"stream-load",children:"Stream Load"}),"\n",(0,t.jsxs)(n.p,{children:["The Stream Load method transfers data to Doris via HTTP protocol. It can import local data directly without relying on any other systems or components. For the detailed syntax, please see ",(0,t.jsx)(n.code,{children:"HELP STREAM LOAD;"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:['Example 1: Use "table1_20170707" as the Label, import the local file ',(0,t.jsx)(n.code,{children:"table1_data"})," into ",(0,t.jsx)(n.code,{children:"table1"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'curl --location-trusted -u test:test_passwd -H "label:table1_20170707" -H "column_separator:," -T table1_data http://FE_HOST:8030/api/example_db/table1/_stream_load\n'})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"FE_HOST is the IP address of any FE node and 8030 is the http_port in fe.conf."}),"\n",(0,t.jsxs)(n.li,{children:["You can use the IP address of any BE and the webserver_port in be.conf for import. For example: ",(0,t.jsx)(n.code,{children:"BE_HOST:8040"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The local file ",(0,t.jsx)(n.code,{children:"table1_data"})," uses ",(0,t.jsx)(n.code,{children:","})," as the separator between data. The details are as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"1,1,Jim,2\n2,1,grace,2\n3,2,tom,2\n4,3,bush,3\n5,3,helen,3\n"})}),"\n",(0,t.jsxs)(n.p,{children:['Example 2: Use "table2_20170707" as the Label, import the local file ',(0,t.jsx)(n.code,{children:"table2_data"})," into ",(0,t.jsx)(n.code,{children:"table2"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'curl --location-trusted -u test:test -H "label:table2_20170707" -H "column_separator:|" -T table2_data http://127.0.0.1:8030/api/example_db/table2/_stream_load\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The local file ",(0,t.jsx)(n.code,{children:"table2_data"})," uses ",(0,t.jsx)(n.code,{children:"|"})," as the separator between data. The details are as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"2017-07-03|1|1|jim|2\n2017-07-05|2|1|grace|2\n2017-07-12|3|2|tom|2\n2017-07-15|4|3|bush|3\n2017-07-12|5|3|helen|3\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Note:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"The recommended file size for Stream Load is less than 10GB. Excessive file size will result in higher retry cost."}),"\n",(0,t.jsxs)(n.li,{children:["Each batch of import data should have a Label. Label serves as the unique identifier of the load task, and guarantees that the same batch of data will only be successfully loaded into a database once. For more details, please see ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/docs/dev/data-operate/import/import-scenes/load-atomicity/",children:"Data Loading and Atomicity"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Stream Load is a synchronous command. The return of the command indicates that the data has been loaded successfully; otherwise the data has not been loaded."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"broker-load",children:"Broker Load"}),"\n",(0,t.jsxs)(n.p,{children:["The Broker Load method imports externally stored data via deployed Broker processes. For more details, please see ",(0,t.jsx)(n.code,{children:"HELP BROKER LOAD;"})]}),"\n",(0,t.jsxs)(n.p,{children:['Example: Use "table1_20170708" as the Label, import files on HDFS into ',(0,t.jsx)(n.code,{children:"table1"})," ."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'LOAD LABEL table1_20170708\n(\n    DATA INFILE("hdfs://your.namenode.host:port/dir/table1_data")\n    INTO TABLE table1\n)\nWITH BROKER hdfs \n(\n    "username"="hdfs_user",\n    "password"="hdfs_password"\n)\nPROPERTIES\n(\n    "timeout"="3600",\n    "max_filter_ratio"="0.1"\n);\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The Broker Load is an asynchronous command. Successful execution of it only indicates successful submission of the task. You can check if the import task has been completed by ",(0,t.jsx)(n.code,{children:"SHOW LOAD;"})," . For example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'SHOW LOAD WHERE LABEL = "table1_20170708";\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In the return result, if you find  ",(0,t.jsx)(n.code,{children:"FINISHED"})," in the ",(0,t.jsx)(n.code,{children:"State"})," field, that means the import is successful."]}),"\n",(0,t.jsxs)(n.p,{children:["For more instructions on ",(0,t.jsx)(n.code,{children:"SHOW LOAD"}),", see",(0,t.jsx)(n.code,{children:"HELP SHOW LOAD;"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Asynchronous import tasks can be cancelled before it is completed:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CANCEL LOAD WHERE LABEL = "table1_20170708";\n'})}),"\n",(0,t.jsx)(n.h2,{id:"query-the-data",children:"Query the Data"}),"\n",(0,t.jsx)(n.h3,{id:"simple-query",children:"Simple Query"}),"\n",(0,t.jsx)(n.p,{children:"Query example::"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"MySQL> SELECT * FROM table1 LIMIT 3;\n+--------+----------+----------+------+\n| siteid | citycode | username | pv   |\n+--------+----------+----------+------+\n|      2 |        1 | 'grace'  |    2 |\n|      5 |        3 | 'helen'  |    3 |\n|      3 |        2 | 'tom'    |    2 |\n+--------+----------+----------+------+\n3 rows in set (0.01 sec)\n\nMySQL> SELECT * FROM table1 ORDER BY citycode;\n+--------+----------+----------+------+\n| siteid | citycode | username | pv   |\n+--------+----------+----------+------+\n|      2 |        1 | 'grace'  |    2 |\n|      1 |        1 | 'jim'    |    2 |\n|      3 |        2 | 'tom'    |    2 |\n|      4 |        3 | 'bush'   |    3 |\n|      5 |        3 | 'helen'  |    3 |\n+--------+----------+----------+------+\n5 rows in set (0.01 sec)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"select--except",children:"SELECT * EXCEPT"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"SELECT * EXCEPT"})," statement is used to exclude one or more columns from the result. The output will not include any of the specified columns."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"MySQL> SELECT * except (username, citycode) FROM table1;\n+--------+------+\n| siteid | pv   |\n+--------+------+\n|      2 |    2 |\n|      5 |    3 |\n|      3 |    2 |\n+--------+------+\n3 rows in set (0.01 sec)\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": ",(0,t.jsx)(n.code,{children:"SELECT * EXCEPT"})," does not exclude columns that do not have a name."]}),"\n",(0,t.jsx)(n.h3,{id:"join-query",children:"Join Query"}),"\n",(0,t.jsx)(n.p,{children:"Query example::"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"MySQL> SELECT SUM(table1.pv) FROM table1 JOIN table2 WHERE table1.siteid = table2.siteid;\n+--------------------+\n| sum(`table1`.`pv`) |\n+--------------------+\n|                 12 |\n+--------------------+\n1 row in set (0.20 sec)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"subquery",children:"Subquery"}),"\n",(0,t.jsx)(n.p,{children:"Query example::"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"MySQL> SELECT SUM(pv) FROM table2 WHERE siteid IN (SELECT siteid FROM table1 WHERE siteid > 2);\n+-----------+\n| sum(`pv`) |\n+-----------+\n|         8 |\n+-----------+\n1 row in set (0.13 sec)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"change-table-schema",children:"Change Table Schema"}),"\n",(0,t.jsxs)(n.p,{children:["Use the ",(0,t.jsx)(n.a,{href:"/docs/1.2/sql-manual/sql-reference/Data-Definition-Statements/Alter/ALTER-TABLE-COLUMN",children:"ALTER TABLE COLUMN"})," command to modify the table Schema, including the following changes."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Adding columns"}),"\n",(0,t.jsx)(n.li,{children:"Deleting columns"}),"\n",(0,t.jsx)(n.li,{children:"Modify column types"}),"\n",(0,t.jsx)(n.li,{children:"Changing the order of columns"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The following table structure changes are illustrated by using the following example."}),"\n",(0,t.jsx)(n.p,{children:"The Schema for the original table1 is as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"+----------+-------------+------+-------+---------+-------+\n| Field    | Type        | Null | Key   | Default | Extra |\n+----------+-------------+------+-------+---------+-------+\n| siteid   | int(11)     | No   | true  | 10      |       |\n| citycode | smallint(6) | No   | true  | N/A     |       |\n| username | varchar(32) | No   | true  |         |       |\n| pv       | bigint(20)  | No   | false | 0       | SUM   |\n+----------+-------------+------+-------+---------+-------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"We add a new column uv, type BIGINT, aggregation type SUM, default value 0:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE table1 ADD COLUMN uv BIGINT SUM DEFAULT '0' after pv;\n"})}),"\n",(0,t.jsx)(n.p,{children:"After successful submission, you can check the progress of the job with the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SHOW ALTER TABLE COLUMN;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["When the job status is ",(0,t.jsx)(n.code,{children:"FINISHED"}),", the job is complete. The new Schema has taken effect."]}),"\n",(0,t.jsxs)(n.p,{children:["After ALTER TABLE is completed, you can view the latest Schema via ",(0,t.jsx)(n.code,{children:"DESC TABLE"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mysql> DESC table1;\n+----------+-------------+------+-------+---------+-------+\n| Field    | Type        | Null | Key   | Default | Extra |\n+----------+-------------+------+-------+---------+-------+\n| siteid   | int(11)     | No   | true  | 10      |       |\n| citycode | smallint(6) | No   | true  | N/A     |       |\n| username | varchar(32) | No   | true  |         |       |\n| pv       | bigint(20)  | No   | false | 0       | SUM   |\n| uv       | bigint(20)  | No   | false | 0       | SUM   |\n+----------+-------------+------+-------+---------+-------+\n5 rows in set (0.00 sec)\n"})}),"\n",(0,t.jsx)(n.p,{children:"You can cancel the currently executing job with the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CANCEL ALTER TABLE COLUMN FROM table1;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For more help, see ",(0,t.jsx)(n.code,{children:"HELP ALTER TABLE"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"rollup",children:"Rollup"}),"\n",(0,t.jsxs)(n.p,{children:["Rollup can be seen as a materialized index structure for a Table, ",(0,t.jsx)(n.strong,{children:"materialized"})," in the sense that its data is physically independent in storage, and ",(0,t.jsx)(n.strong,{children:"indexed"})," in the sense that Rollup can reorder columns to increase the hit rate of prefix indexes as well as reduce Key columns to increase the aggregation level of data."]}),"\n",(0,t.jsxs)(n.p,{children:["You can perform various changes to Rollup using ",(0,t.jsx)(n.a,{href:"/docs/1.2/sql-manual/sql-reference/Data-Definition-Statements/Alter/ALTER-TABLE-ROLLUP",children:"ALTER TABLE ROLLUP"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"The following is an exemplified illustration."}),"\n",(0,t.jsxs)(n.p,{children:["The original schema of ",(0,t.jsx)(n.code,{children:"table1"})," is as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"+----------+-------------+------+-------+---------+-------+\n| Field    | Type        | Null | Key   | Default | Extra |\n+----------+-------------+------+-------+---------+-------+\n| siteid   | int(11)     | No   | true  | 10      |       |\n| citycode | smallint(6) | No   | true  | N/A     |       |\n| username | varchar(32) | No   | true  |         |       |\n| pv       | bigint(20)  | No   | false | 0       | SUM   |\n| uv       | bigint(20)  | No   | false | 0       | SUM   |\n+----------+-------------+------+-------+---------+-------+\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For ",(0,t.jsx)(n.code,{children:"table1"}),",  ",(0,t.jsx)(n.code,{children:"siteid"}),", ",(0,t.jsx)(n.code,{children:"citycode"}),", and ",(0,t.jsx)(n.code,{children:"username"}),"  constitute a set of Key, based on which the pv fields are aggregated; if you have a frequent need to view the total city pv, you can create a Rollup consisting of only ",(0,t.jsx)(n.code,{children:"citycode"})," and  ",(0,t.jsx)(n.code,{children:"pv"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE table1 ADD ROLLUP rollup_city(citycode, pv);\n"})}),"\n",(0,t.jsx)(n.p,{children:"After successful submission, you can check the progress of the task with the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SHOW ALTER TABLE ROLLUP;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If the task status is ",(0,t.jsx)(n.code,{children:"FINISHED"}),", the job is completed."]}),"\n",(0,t.jsxs)(n.p,{children:["After the Rollup is created, you can use ",(0,t.jsx)(n.code,{children:"DESC table1 ALL"})," to check the information of the Rollup."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mysql> desc table1 all;\n+-------------+----------+-------------+------+-------+--------+-------+\n| IndexName   | Field    | Type        | Null | Key   | Default | Extra |\n+-------------+----------+-------------+------+-------+---------+-------+\n| table1      | siteid   | int(11)     | No   | true  | 10      |       |\n|             | citycode | smallint(6) | No   | true  | N/A     |       |\n|             | username | varchar(32) | No   | true  |         |       |\n|             | pv       | bigint(20)  | No   | false | 0       | SUM   |\n|             | uv       | bigint(20)  | No   | false | 0       | SUM   |\n|             |          |             |      |       |         |       |\n| rollup_city | citycode | smallint(6) | No   | true  | N/A     |       |\n|             | pv       | bigint(20)  | No   | false | 0       | SUM   |\n+-------------+----------+-------------+------+-------+---------+-------+\n8 rows in set (0.01 sec)\n"})}),"\n",(0,t.jsx)(n.p,{children:"You can cancel the currently ongoing task using the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CANCEL ALTER TABLE ROLLUP FROM table1;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["With created Rollups, you do not need to specify the Rollup in queries, but only specify the original table for the query. The program will automatically determine if Rollup should be used. You can check whether Rollup is hit or not  using the ",(0,t.jsx)(n.code,{children:"EXPLAIN your_sql;"})," command."]}),"\n",(0,t.jsxs)(n.p,{children:["For more help, see ",(0,t.jsx)(n.code,{children:"HELP ALTER TABLE"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"materialized-views",children:"Materialized Views"}),"\n",(0,t.jsx)(n.p,{children:"Materialized views are a space-for-time data analysis acceleration technique. Doris supports building materialized views on top of base tables. For example, a partial column-based aggregated view can be built on top of a table with a granular data model, allowing for fast querying of both granular and aggregated data."}),"\n",(0,t.jsx)(n.p,{children:"Doris can automatically ensure data consistency between materialized views and base tables, and automatically match the appropriate materialized view at query time, greatly reducing the cost of data maintenance for users and providing a consistent and transparent query acceleration experience."}),"\n",(0,t.jsxs)(n.p,{children:["For more information about materialized views, see ",(0,t.jsx)(n.a,{href:"/docs/1.2/query-acceleration/materialized-view",children:"Materialized Views"})]}),"\n",(0,t.jsx)(n.h2,{id:"data-table-queries",children:"Data Table Queries"}),"\n",(0,t.jsx)(n.h3,{id:"memory-limit",children:"Memory Limit"}),"\n",(0,t.jsx)(n.p,{children:"To prevent excessive memory usage of one single query, Doris imposes memory limit on queries. By default, one query task should consume no more than 2GB of memory on one single BE node."}),"\n",(0,t.jsxs)(n.p,{children:["If you find a ",(0,t.jsx)(n.code,{children:"Memory limit exceeded"})," error, that means the program is trying to allocate more memory than the memory limit. You can solve this by optimizing your SQL statements."]}),"\n",(0,t.jsx)(n.p,{children:"You can change the 2GB memory limit by modifying the memory parameter settings."}),"\n",(0,t.jsx)(n.p,{children:"Show the memory limit for one query:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'mysql> SHOW VARIABLES LIKE "%mem_limit%";\n+---------------+------------+\n| Variable_name | Value      |\n+---------------+------------+\n| exec_mem_limit| 2147483648 |\n+---------------+------------+\n1 row in set (0.00 sec)\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"exec_mem_limit"})," is measured in byte. You can change the value of ",(0,t.jsx)(n.code,{children:"exec_mem_limit"})," using the ",(0,t.jsx)(n.code,{children:"SET"})," command. For example, you can change it to 8GB as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'mysql> SET exec_mem_limit = 8589934592;\nQuery OK, 0 rows affected (0.00 sec)\nmysql> SHOW VARIABLES LIKE "%mem_limit%";\n+---------------+------------+\n| Variable_name | Value      |\n+---------------+------------+\n| exec_mem_limit| 8589934592 |\n+---------------+------------+\n1 row in set (0.00 sec)\n'})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The above change is executed at the session level and is only valid for the currently connected session. The default memory limit will restore after reconnection."}),"\n",(0,t.jsxs)(n.li,{children:["If you need to change the global variable, you can set: ",(0,t.jsx)(n.code,{children:"SET GLOBAL exec_mem_limit = 8589934592;"}),". After this, you disconnect and log back in, and then the new parameter will take effect permanently."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"query-timeout",children:"Query Timeout"}),"\n",(0,t.jsx)(n.p,{children:"The default query timeout is set to 300 seconds. If a query is not completed within 300 seconds, it will be cancelled by the Doris system. You change this parameter and customize the timeout for your application to achieve a blocking method similar to wait(timeout)."}),"\n",(0,t.jsx)(n.p,{children:"View the current timeout settings:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'mysql> SHOW VARIABLES LIKE "%query_timeout%";\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| QUERY_TIMEOUT | 300   |\n+---------------+-------+\n1 row in set (0.00 sec)\n'})}),"\n",(0,t.jsx)(n.p,{children:"Change query timeout to 1 minute:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"mysql>  SET query_timeout = 60;\nQuery OK, 0 rows affected (0.00 sec)\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The current timeout check interval is 5 seconds, so if you set the query timeout to less than 5 seconds, it might not be executed accurately."}),"\n",(0,t.jsxs)(n.li,{children:["The above changes are also performed at the session level. You can change the global variable by ",(0,t.jsx)(n.code,{children:"SET GLOBAL"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"broadcastshuffle-join",children:"Broadcast/Shuffle Join"}),"\n",(0,t.jsx)(n.p,{children:"The default way to implement Join is to filter the sub table conditionally, broadcast it to each node of the overall table to form a memory Hash table, and then stream read the data of the overall table for Hash Join, but if the filtered data of the sub table cannot be put into memory, the Join will not be completed, and then usually a memory overrun error will occur."}),"\n",(0,t.jsx)(n.p,{children:"In this case, it is recommended to explicitly specify Shuffle Join, also known as Partitioned Join, where both the sub table and overall table are Hashed according to the Key of the Join and then perform a distributed Join, with the memory consumption being spread across all compute nodes in the cluster."}),"\n",(0,t.jsx)(n.p,{children:"Doris will automatically attempt a Broadcast Join and switch to a Shuffle Join if the sub table is estimated to be too large; note that if a Broadcast Join is explicitly specified at this point, it will enforce Broadcast Join."}),"\n",(0,t.jsx)(n.p,{children:"Use Broadcast Join (default):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"mysql> select sum(table1.pv) from table1 join table2 where table1.siteid = 2;\n+--------------------+\n| sum(`table1`.`pv`) |\n+--------------------+\n|                 10 |\n+--------------------+\n1 row in set (0.20 sec)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Use Broadcast Join (explicitly specified):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"mysql> select sum(table1.pv) from table1 join [broadcast] table2 where table1.siteid = 2;\n+--------------------+\n| sum(`table1`.`pv`) |\n+--------------------+\n|                 10 |\n+--------------------+\n1 row in set (0.20 sec)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Use Shuffle Join:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"mysql> select sum(table1.pv) from table1 join [shuffle] table2 where table1.siteid = 2;\n+--------------------+\n| sum(`table1`.`pv`) |\n+--------------------+\n|                 10 |\n+--------------------+\n1 row in set (0.15 sec)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"query-retry-and-high-availability",children:"Query Retry and High Availability"}),"\n",(0,t.jsx)(n.p,{children:"When deploying multiple FE nodes, you can deploy a load balancing layer on top of multiple FEs to achieve high availability of Doris."}),"\n",(0,t.jsxs)(n.p,{children:["Please refer to ",(0,t.jsx)(n.a,{href:"/docs/1.2/admin-manual/cluster-management/load-balancing",children:"Load Balancing"})," for details on installation, deployment, and usage."]}),"\n",(0,t.jsx)(n.h2,{id:"update-and-delete-data",children:"Update and Delete Data"}),"\n",(0,t.jsxs)(n.p,{children:["Doris supports two methods to delete imported data. One is to use the ",(0,t.jsx)(n.code,{children:"DELETE FROM"})," statement and specify the target data by the ",(0,t.jsx)(n.code,{children:"WHERE"})," condition. This method is widely applicable and suitable for less frequent scheduled deletion tasks."]}),"\n",(0,t.jsx)(n.p,{children:"The other method is only used in the Unique Models with a unique primary key. It imports the the primary key rows that are to be deleted, and the final physical deletion of the data is performed internally by Doris using the deletion mark. This method is suitable for real-time deletion of data."}),"\n",(0,t.jsxs)(n.p,{children:["For specific instructions on deleting and updating data, see ",(0,t.jsx)(n.a,{href:"/docs/1.2/data-operate/update-delete/update",children:"Data Update"}),"."]})]})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},250065:function(e,n,a){a.d(n,{Z:function(){return r},a:function(){return l}});var s=a(667294);let t={},i=s.createContext(t);function l(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);