"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["721112"],{70422:function(e,n,i){i.r(n),i.d(n,{metadata:()=>o,contentTitle:()=>s,default:()=>h,assets:()=>a,toc:()=>c,frontMatter:()=>r});var o=JSON.parse('{"id":"install/source-install/compilation-with-ldb-toolchain","title":"Compiling with LDB Toolchain (Recommended)","description":"\x3c!--","source":"@site/docs/install/source-install/compilation-with-ldb-toolchain.md","sourceDirName":"install/source-install","slug":"/install/source-install/compilation-with-ldb-toolchain","permalink":"/docs/dev/install/source-install/compilation-with-ldb-toolchain","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Compiling with LDB Toolchain (Recommended)","language":"en"},"sidebar":"docs","previous":{"title":"Compiling with Docker (Recommended)","permalink":"/docs/dev/install/source-install/compilation-with-docker"},"next":{"title":"Compiling on Linux","permalink":"/docs/dev/install/source-install/compilation-linux"}}'),t=i("785893"),l=i("250065");let r={title:"Compiling with LDB Toolchain (Recommended)",language:"en"},s=void 0,a={},c=[{value:"Prepare the compilation environment:",id:"prepare-the-compilation-environment",level:2},{value:"Compile Doris",id:"compile-doris",level:2},{value:"Pre-compile third-party libraries",id:"pre-compile-third-party-libraries",level:2}];function d(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",li:"li",mdxadmonitiontitle:"mdxadmonitiontitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"This guide is about how to compile Doris using the LDB Toolchain. This method serves as a supplement to the Docker compilation approach to help the developers and users without a Docker environment. The recommended LDB Toolchain version is 0.17, which includes clang-16 and gcc-11."}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.mdxadmonitiontitle,{}),(0,t.jsx)(n.p,{children:"LDB Toolchain is fully known as Linux Distribution Based Toolchain Generator. It helps compile modern C++ projects on almost all Linux distributions."}),(0,t.jsxs)(n.p,{children:["Special thanks to ",(0,t.jsx)(n.a,{href:"https://github.com/amosbird",children:"Amos Bird"})," for the contribution."]})]}),"\n",(0,t.jsx)(n.h2,{id:"prepare-the-compilation-environment",children:"Prepare the compilation environment:"}),"\n",(0,t.jsx)(n.p,{children:"This method applies to most Linux distributions (CentOS, Ubuntu, etc.)."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Download"})," ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"ldb_toolchain_gen.sh"})})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Download the latest ",(0,t.jsx)(n.code,{children:"ldb_toolchain_gen.sh"})," from ",(0,t.jsx)(n.a,{href:"https://github.com/amosbird/ldb_toolchain_gen/releases",children:"here"}),". This script is used to generate ldb toolchain."]}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.mdxadmonitiontitle,{}),(0,t.jsxs)(n.p,{children:["For more information, please visit ",(0,t.jsx)(n.a,{href:"https://github.com/amosbird/ldb_toolchain_gen",children:"https://github.com/amosbird/ldb_toolchain_gen"})]})]}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Execute the following command to generate ldb toolchain."})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-Plain",children:"sh ldb_toolchain_gen.sh /path/to/ldb_toolchain/\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"/path/to/ldb_toolchain/"})," is the installation directory for the toolchain. After successful execution, the following directory structure will be generated under ",(0,t.jsx)(n.code,{children:"/path/to/ldb_toolchain/"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-Plain",children:"\u251C\u2500\u2500 bin\n\u251C\u2500\u2500 include\n\u251C\u2500\u2500 lib\n\u251C\u2500\u2500 share\n\u251C\u2500\u2500 test\n\u2514\u2500\u2500 usr\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Download and install other compilation components"})}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Download ",(0,t.jsx)(n.a,{href:"https://doris-thirdparty-1308700295.cos.ap-beijing.myqcloud.com/tools/jdk-8u391-linux-x64.tar.gz",children:"Java8"})," and install it to /path/to/java."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["For versions later than 3.0 (inclusive), or the master branch, please use ",(0,t.jsx)(n.a,{href:"https://download.oracle.com/java/17/archive/jdk-17.0.10_linux-x64_bin.tar.gz",children:"Java 17"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Download ",(0,t.jsx)(n.a,{href:"https://doris-thirdparty-repo.bj.bcebos.com/thirdparty/apache-maven-3.6.3-bin.tar.gz",children:"Apache Maven 3.6.3"})," and install it to /path/to/maven."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Download ",(0,t.jsx)(n.a,{href:"https://doris-thirdparty-repo.bj.bcebos.com/thirdparty/node-v12.13.0-linux-x64.tar.gz",children:"Node v12.13.0"})," and install it to /path/to/node."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Different Linux distributions may include different default components. Therefore, you may need to install some additional components. The following takes CentOS 6 as an example. Similar steps may apply to other distributions:"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-Plain",children:"install required system packages\nsudo yum install -y byacc patch automake libtool make which file ncurses-devel gettext-devel unzip bzip2 zip util-linux wget git python2\n\ninstall autoconf-2.69\nwget http://ftp.gnu.org/gnu/autoconf/autoconf-2.69.tar.gz && \\\n    tar zxf autoconf-2.69.tar.gz && \\\n    cd autoconf-2.69 && \\\n    ./configure && \\\n    make && \\\n    make install\n\ninstall bison-3.0.4\nwget http://ftp.gnu.org/gnu/bison/bison-3.0.4.tar.gz && \\\n    tar xzf bison-3.0.4.tar.gz && \\\n    cd bison-3.0.4 && \\\n    ./configure && \\\n    make && \\\n    make install\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Download Doris source code"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-Plain",children:"git clone https://github.com/apache/doris.git\n"})}),"\n",(0,t.jsxs)(n.p,{children:["After downloading, navigate to the Doris source code directory, create a ",(0,t.jsx)(n.code,{children:"custom_env.sh"})," file, and set the PATH environment variable as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-Plain",children:"export JAVA_HOME=/path/to/java/\nexport PATH=$JAVA_HOME/bin:$PATH\nexport PATH=/path/to/maven/bin:$PATH\nexport PATH=/path/to/node/bin:$PATH\nexport PATH=/path/to/ldb_toolchain/bin:$PATH\n"})}),"\n",(0,t.jsx)(n.h2,{id:"compile-doris",children:"Compile Doris"}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.mdxadmonitiontitle,{}),(0,t.jsx)(n.p,{children:"The first step of compiling Doris source code is to first download third-party libraries and compile them. You can refer to the following instructions to download precompiled versions of the third-party libraries."})]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Enter the Doris source code directory and execute the following command to check if the compilation machine supports the AVX2 instruction set."})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ cat /proc/cpuinfo | grep avx2\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Execute compilation."})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-Plain",children:"# By default, it builds AVX2 version.\n$ sh build.sh\n\n# If you need the no AVX2 version, add USE_AVX2=0.\n$ USE_AVX2=0 sh build.sh\n\n# To compile a debug version of BE, add BUILD_TYPE=Debug.\n$ BUILD_TYPE=Debug sh build.sh\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This script first compiles the third-party libraries and then the Doris components (FE, BE, MS). The compilation output can be found in the ",(0,t.jsx)(n.code,{children:"output/"})," directory. MS stands for Meta Service, which a module of Doris in the compute-storage decoupled mode. For more information about MS, refer to this ",(0,t.jsx)(n.a,{href:"../../compute-storage-decoupled/compilation-and-deployment",children:"doc"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"pre-compile-third-party-libraries",children:"Pre-compile third-party libraries"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"build.sh"})," script compiles third-party libraries first. You can download the pre-compiled third-party libraries directly from the following link:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"https://github.com/apache/doris-thirdparty/releases\n"})}),"\n",(0,t.jsx)(n.p,{children:"The pre-compiled libraries for Linux and MacOS are provided. If they match your compilation and runtime environment, you can download them and use them directly."}),"\n",(0,t.jsxs)(n.p,{children:["After downloading, extract the files to obtain an ",(0,t.jsx)(n.code,{children:"installed/"})," directory. Copy this directory to the ",(0,t.jsx)(n.code,{children:"thirdparty/"}),"directory, and then run ",(0,t.jsx)(n.code,{children:"build.sh"})," to proceed with the compilation."]})]})}function h(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return s},a:function(){return r}});var o=i(667294);let t={},l=o.createContext(t);function r(e){let n=o.useContext(l);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),o.createElement(l.Provider,{value:n},e.children)}}}]);