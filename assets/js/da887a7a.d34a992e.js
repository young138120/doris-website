"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["336214"],{163180:function(e,n,t){t.r(n),t.d(n,{metadata:()=>r,contentTitle:()=>o,default:()=>h,assets:()=>l,toc:()=>d,frontMatter:()=>a});var r=JSON.parse('{"id":"data-operate/import/import-way/routine-load-manual","title":"Routine Load","description":"\x3c!--","source":"@site/versioned_docs/version-1.2/data-operate/import/import-way/routine-load-manual.md","sourceDirName":"data-operate/import/import-way","slug":"/data-operate/import/import-way/routine-load-manual","permalink":"/docs/1.2/data-operate/import/import-way/routine-load-manual","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"Routine Load","language":"en"},"sidebar":"docs","previous":{"title":"Broker Load","permalink":"/docs/1.2/data-operate/import/import-way/broker-load-manual"},"next":{"title":"Spark Load","permalink":"/docs/1.2/data-operate/import/import-way/spark-load-manual"}}'),i=t("785893"),s=t("250065");let a={title:"Routine Load",language:"en"},o="Routine Load",l={},d=[{value:"Glossary",id:"glossary",level:2},{value:"Principle",id:"principle",level:2},{value:"Kafka Routine load",id:"kafka-routine-load",level:2},{value:"Usage restrictions",id:"usage-restrictions",level:3},{value:"Create a routine load task",id:"create-a-routine-load-task",level:3},{value:"Viewing Job Status",id:"viewing-job-status",level:3},{value:"Modify job properties",id:"modify-job-properties",level:3},{value:"Job Control",id:"job-control",level:3},{value:"Other notes",id:"other-notes",level:2},{value:"Related Parameters",id:"related-parameters",level:2},{value:"More help",id:"more-help",level:2}];function c(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",version:"version",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"routine-load",children:"Routine Load"})}),"\n",(0,i.jsx)(n.p,{children:"The Routine Load feature provides users with a way to automatically load data from a specified data source."}),"\n",(0,i.jsx)(n.p,{children:"This document describes the implementation principles, usage, and best practices of this feature."}),"\n",(0,i.jsx)(n.h2,{id:"glossary",children:"Glossary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"RoutineLoadJob: A routine load job submitted by the user."}),"\n",(0,i.jsx)(n.li,{children:"JobScheduler: A routine load job scheduler for scheduling and dividing a RoutineLoadJob into multiple Tasks."}),"\n",(0,i.jsx)(n.li,{children:"Task: RoutineLoadJob is divided by JobScheduler according to the rules."}),"\n",(0,i.jsx)(n.li,{children:"TaskScheduler: Task Scheduler. Used to schedule the execution of a Task."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"principle",children:"Principle"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"         +---------+\n         |  Client |\n         +----+----+\n              |\n+-----------------------------+\n| FE          |               |\n| +-----------v------------+  |\n| |                        |  |\n| |   Routine Load Job     |  |\n| |                        |  |\n| +---+--------+--------+--+  |\n|     |        |        |     |\n| +---v--+ +---v--+ +---v--+  |\n| | task | | task | | task |  |\n| +--+---+ +---+--+ +---+--+  |\n|    |         |        |     |\n+-----------------------------+\n     |         |        |\n     v         v        v\n +---+--+   +--+---+   ++-----+\n |  BE  |   |  BE  |   |  BE  |\n +------+   +------+   +------+\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"As shown above, the client submits a routine load job to FE."}),"\n",(0,i.jsx)(n.p,{children:"FE splits an load job into several Tasks via JobScheduler. Each Task is responsible for loading a specified portion of the data. The Task is assigned by the TaskScheduler to the specified BE."}),"\n",(0,i.jsx)(n.p,{children:"On the BE, a Task is treated as a normal load task and loaded via the Stream Load load mechanism. After the load is complete, report to FE."}),"\n",(0,i.jsx)(n.p,{children:"The JobScheduler in the FE continues to generate subsequent new Tasks based on the reported results, or retry the failed Task."}),"\n",(0,i.jsx)(n.p,{children:"The entire routine load job completes the uninterrupted load of data by continuously generating new Tasks."}),"\n",(0,i.jsx)(n.h2,{id:"kafka-routine-load",children:"Kafka Routine load"}),"\n",(0,i.jsx)(n.p,{children:"Currently we only support routine load from the Kafka system. This section details Kafka's routine use and best practices."}),"\n",(0,i.jsx)(n.h3,{id:"usage-restrictions",children:"Usage restrictions"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Support unauthenticated Kafka access and Kafka clusters certified by SSL."}),"\n",(0,i.jsx)(n.li,{children:"The supported message format is csv text or json format. Each message is a line in csv format, and the end of the line does not contain a ** line break."}),"\n",(0,i.jsx)(n.li,{children:"Kafka 0.10.0.0 (inclusive) or above is supported by default. If you want to use Kafka versions below 0.10.0.0 (0.9.0, 0.8.2, 0.8.1, 0.8.0), you need to modify the configuration of be, set the value of kafka_broker_version_fallback to be the older version, or directly set the value of property.broker.version.fallback to the old version when creating routine load. The cost of the old version is that some of the new features of routine load may not be available, such as setting the offset of the kafka partition by time."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"create-a-routine-load-task",children:"Create a routine load task"}),"\n",(0,i.jsxs)(n.p,{children:["The detailed syntax for creating a routine import task can be found in [CREATE ROUTINE LOAD](... /... /... /sql-manual/sql-reference/Data-Manipulation-Statements/Load/CREATE-ROUTINE-LOAD.md) after connecting to Doris  command manual, or execute ",(0,i.jsx)(n.code,{children:"HELP ROUTINE LOAD;"})," for syntax help."]}),"\n",(0,i.jsx)(n.p,{children:"Here we illustrate how to create Routine Load tasks with a few examples."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create a Kafka example import task named test1 for example_tbl of example_db. Specify the column separator and group.id and client.id, and automatically consume all partitions by default and subscribe from the location where data is available (OFFSET_BEGINNING)."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE ROUTINE LOAD example_db.test1 ON example_tbl\n        COLUMNS TERMINATED BY ",",\n        COLUMNS(k1, k2, k3, v1, v2, v3 = k1 * 100)\n        PROPERTIES\n        (\n            "desired_concurrent_number"="3",\n            "max_batch_interval" = "20",\n            "max_batch_rows" = "300000",\n            "max_batch_size" = "209715200",\n            "strict_mode" = "false"\n        )\n        FROM KAFKA\n        (\n            "kafka_broker_list" = "broker1:9092,broker2:9092,broker3:9092",\n            "kafka_topic" = "my_topic",\n            "property.group.id" = "xxx",\n            "property.client.id" = "xxx",\n            "property.kafka_default_offsets" = "OFFSET_BEGINNING"\n        );\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["Create a Kafka example import task named test1 for example_tbl of example_db in ",(0,i.jsx)(n.strong,{children:"strict mode"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE ROUTINE LOAD example_db.test1 ON example_tbl\n        COLUMNS(k1, k2, k3, v1, v2, v3 = k1 * 100),\n        WHERE k1 > 100 and k2 like "%doris%"\n        PROPERTIES\n        (\n            "desired_concurrent_number"="3",\n            "max_batch_interval" = "20",\n            "max_batch_rows" = "300000",\n            "max_batch_size" = "209715200",\n            "strict_mode" = "true"\n        )\n        FROM KAFKA\n        (\n            "kafka_broker_list" = "broker1:9092,broker2:9092,broker3:9092",\n            "kafka_topic" = "my_topic",\n            "kafka_partitions" = "0,1,2,3",\n            "kafka_offsets" = "101,0,0,200"\n        );\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Notes\uFF1A"}),"\n",(0,i.jsx)(n.p,{children:'"strict_mode" = "true"'}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Example of importing data in Json format"}),"\n",(0,i.jsx)(n.p,{children:"Routine Load only supports the following two types of json formats"}),"\n",(0,i.jsx)(n.p,{children:"The first one has only one record and is a json object."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{"category":"a9jadhx","author":"test","price":895}\n'})}),"\n",(0,i.jsx)(n.p,{children:"The second one is a json array, which can contain multiple records"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n    {   \n        "category":"11",\n        "author":"4avc",\n        "price":895,\n        "timestamp":1589191587\n    },\n    {\n        "category":"22",\n        "author":"2avc",\n        "price":895,\n        "timestamp":1589191487\n    },\n    {\n        "category":"33",\n        "author":"3avc",\n        "price":342,\n        "timestamp":1589191387\n    }\n]\n'})}),"\n",(0,i.jsx)(n.p,{children:"Create the Doris data table to be imported"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE `example_tbl` (\n   `category` varchar(24) NULL COMMENT "",\n   `author` varchar(24) NULL COMMENT "",\n   `timestamp` bigint(20) NULL COMMENT "",\n   `dt` int(11) NULL COMMENT "",\n   `price` double REPLACE\n) ENGINE=OLAP\nAGGREGATE KEY(`category`,`author`,`timestamp`,`dt`)\nCOMMENT "OLAP"\nPARTITION BY RANGE(`dt`)\n(\n  PARTITION p0 VALUES [("-2147483648"), ("20200509")),\n	PARTITION p20200509 VALUES [("20200509"), ("20200510")),\n	PARTITION p20200510 VALUES [("20200510"), ("20200511")),\n	PARTITION p20200511 VALUES [("20200511"), ("20200512"))\n)\nDISTRIBUTED BY HASH(`category`,`author`,`timestamp`) BUCKETS 4\nPROPERTIES (\n    "replication_num" = "1"\n);\n'})}),"\n",(0,i.jsx)(n.p,{children:"Import json data in simple mode"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE ROUTINE LOAD example_db.test_json_label_1 ON table1\nCOLUMNS(category,price,author)\nPROPERTIES\n(\n	"desired_concurrent_number"="3",\n	"max_batch_interval" = "20",\n	"max_batch_rows" = "300000",\n	"max_batch_size" = "209715200",\n	"strict_mode" = "false",\n	"format" = "json"\n)\nFROM KAFKA\n(\n	"kafka_broker_list" = "broker1:9092,broker2:9092,broker3:9092",\n	"kafka_topic" = "my_topic",\n	"kafka_partitions" = "0,1,2",\n	"kafka_offsets" = "0,0,0"\n );\n'})}),"\n",(0,i.jsx)(n.p,{children:"Accurate import of data in json format"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE ROUTINE LOAD example_db.test1 ON example_tbl\nCOLUMNS(category, author, price, timestamp, dt=from_unixtime(timestamp, \'%Y%m%d\'))\nPROPERTIES\n(\n    "desired_concurrent_number"="3",\n    "max_batch_interval" = "20",\n    "max_batch_rows" = "300000",\n    "max_batch_size" = "209715200",\n    "strict_mode" = "false",\n    "format" = "json",\n    "jsonpaths" = "[\\"$.category\\",\\"$.author\\",\\"$.price\\",\\"$.timestamp\\"]",\n    "strip_outer_array" = "true"\n)\nFROM KAFKA\n(\n    "kafka_broker_list" = "broker1:9092,broker2:9092,broker3:9092",\n    "kafka_topic" = "my_topic",\n    "kafka_partitions" = "0,1,2",\n    "kafka_offsets" = "0,0,0"\n);\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(n.p,{children:["The partition field ",(0,i.jsx)(n.code,{children:"dt"})," in the table is not in our data, but is converted in our Routine load statement by ",(0,i.jsx)(n.code,{children:"dt=from_unixtime(timestamp, '%Y%m%d')"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"strict mode import relationship with source data"})}),"\n",(0,i.jsx)(n.p,{children:"Here is an example with a column type of TinyInt"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Notes: When a column in the table allows importing null values"}),"\n"]}),"\n",(0,i.jsx)(n.blockquote,{children:"\n"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"source data"}),(0,i.jsx)(n.th,{children:"source data example"}),(0,i.jsx)(n.th,{children:"string to int"}),(0,i.jsx)(n.th,{children:"strict_mode"}),(0,i.jsx)(n.th,{children:"result"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Null value"}),(0,i.jsx)(n.td,{children:"\\N"}),(0,i.jsx)(n.td,{children:"N/A"}),(0,i.jsx)(n.td,{children:"true or false"}),(0,i.jsx)(n.td,{children:"NULL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"not null"}),(0,i.jsx)(n.td,{children:"aaa or 2000"}),(0,i.jsx)(n.td,{children:"NULL"}),(0,i.jsx)(n.td,{children:"true"}),(0,i.jsx)(n.td,{children:"invalid data(filtered)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"not null"}),(0,i.jsx)(n.td,{children:"aaa"}),(0,i.jsx)(n.td,{children:"NULL"}),(0,i.jsx)(n.td,{children:"false"}),(0,i.jsx)(n.td,{children:"NULL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"not null"}),(0,i.jsx)(n.td,{children:"1"}),(0,i.jsx)(n.td,{children:"1"}),(0,i.jsx)(n.td,{children:"true or false"}),(0,i.jsx)(n.td,{children:"correct data"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Here is an example with the column type Decimal(1,0)"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsx)(n.p,{children:"When the columns in the table allow importing null values"}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"source data"}),(0,i.jsx)(n.th,{children:"source data example"}),(0,i.jsx)(n.th,{children:"string to int"}),(0,i.jsx)(n.th,{children:"strict_mode"}),(0,i.jsx)(n.th,{children:"result"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Null value"}),(0,i.jsx)(n.td,{children:"\\N"}),(0,i.jsx)(n.td,{children:"N/A"}),(0,i.jsx)(n.td,{children:"true or false"}),(0,i.jsx)(n.td,{children:"NULL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"not null"}),(0,i.jsx)(n.td,{children:"aaa"}),(0,i.jsx)(n.td,{children:"NULL"}),(0,i.jsx)(n.td,{children:"true"}),(0,i.jsx)(n.td,{children:"invalid data(filtered)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"not null"}),(0,i.jsx)(n.td,{children:"aaa"}),(0,i.jsx)(n.td,{children:"NULL"}),(0,i.jsx)(n.td,{children:"false"}),(0,i.jsx)(n.td,{children:"NULL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"not null"}),(0,i.jsx)(n.td,{children:"1 or 10"}),(0,i.jsx)(n.td,{children:"1"}),(0,i.jsx)(n.td,{children:"true or false"}),(0,i.jsx)(n.td,{children:"correct data"})]})]})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsx)(n.p,{children:"Although 10 is an out-of-range value, it is not affected by strict mode because its type meets the decimal requirement. 10 will eventually be filtered in other ETL processing processes. But it will not be filtered by strict mode."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Accessing an SSL-certified Kafka cluster"})}),"\n",(0,i.jsxs)(n.p,{children:["Accessing an SSL-certified Kafka cluster requires the user to provide the certificate file (ca.pem) used to authenticate the Kafka Broker's public key. If the Kafka cluster also has client authentication enabled, the client's public key (client.pem), the key file (client.key), and the key password are also required. The required files need to be uploaded to Doris first via the ",(0,i.jsx)(n.code,{children:"CREAE FILE"})," command, ",(0,i.jsxs)(n.strong,{children:["and the catalog name is ",(0,i.jsx)(n.code,{children:"kafka"})]}),". See ",(0,i.jsx)(n.code,{children:"HELP CREATE FILE;"})," for help with the ",(0,i.jsx)(n.code,{children:"CREATE FILE"})," command. Here are some examples."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"uploading a file"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE FILE "ca.pem" PROPERTIES("url" = "https://example_url/kafka-key/ca.pem", "catalog" = "kafka");\nCREATE FILE "client.key" PROPERTIES("url" = "https://example_urlkafka-key/client.key", "catalog" = "kafka");\nCREATE FILE "client.pem" PROPERTIES("url" = "https://example_url/kafka-key/client.pem", "catalog" = "kafka");\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Create routine import jobs"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE ROUTINE LOAD db1.job1 on tbl1\nPROPERTIES\n(\n    "desired_concurrent_number"="1"\n)\nFROM KAFKA\n(\n    "kafka_broker_list"= "broker1:9091,broker2:9091",\n    "kafka_topic" = "my_topic",\n    "property.security.protocol" = "ssl",\n    "property.ssl.ca.location" = "FILE:ca.pem",\n    "property.ssl.certificate.location" = "FILE:client.pem",\n    "property.ssl.key.location" = "FILE:client.key",\n    "property.ssl.key.password" = "abcdefg"\n);\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Doris accesses Kafka clusters through Kafka's C++ API ",(0,i.jsx)(n.code,{children:"librdkafka"}),". The parameters supported by ",(0,i.jsx)(n.code,{children:"librdkafka"})," can be found in"]}),"\n",(0,i.jsxs)(n.p,{children:["[",(0,i.jsx)(n.a,{href:"https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md%5D(",children:"https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md]("}),(0,i.jsx)(n.a,{href:"https://github.com/edenhill/librdkafka/blob/master/",children:"https://github.com/edenhill/librdkafka/blob/master/"})," CONFIGURATION.md)"]}),"\n"]}),"\n",(0,i.jsxs)(n.version,{since:"1.2",children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Accessing a Kerberos-certified Kafka cluster"})}),"\n",(0,i.jsx)(n.p,{children:"Accessing a Kerberos-certified Kafka cluster. The following configurations need to be added:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"security.protocol=SASL_PLAINTEXT : Use SASL plaintext"}),"\n",(0,i.jsx)(n.li,{children:"sasl.kerberos.service.name=$SERVICENAME : Broker service name"}),"\n",(0,i.jsx)(n.li,{children:"sasl.kerberos.keytab=/etc/security/keytabs/${CLIENT_NAME}.keytab : Client keytab location"}),"\n",(0,i.jsx)(n.li,{children:"sasl.kerberos.principal=${CLIENT_NAME}/${CLIENT_HOST} : sasl.kerberos.principal"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create routine import jobs"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE ROUTINE LOAD db1.job1 on tbl1\nPROPERTIES (\n"desired_concurrent_number"="1",\n )\nFROM KAFKA\n(\n    "kafka_broker_list" = "broker1:9092,broker2:9092",\n    "kafka_topic" = "my_topic",\n    "property.security.protocol" = "SASL_PLAINTEXT",\n    "property.sasl.kerberos.service.name" = "kafka",\n    "property.sasl.kerberos.keytab" = "/etc/krb5.keytab",\n    "property.sasl.kerberos.principal" = "doris@YOUR.COM"\n);\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Note:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"To enable Doris to access the Kafka cluster with Kerberos authentication enabled, you need to deploy the Kerberos client kinit on all running nodes of the Doris cluster, configure krb5.conf, and fill in KDC service information."}),"\n",(0,i.jsx)(n.li,{children:"Configure property.sasl.kerberos The value of keytab needs to specify the absolute path of the keytab local file and allow Doris processes to access the local file."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"viewing-job-status",children:"Viewing Job Status"}),"\n",(0,i.jsxs)(n.p,{children:["Specific commands and examples to view the status of ",(0,i.jsx)(n.strong,{children:"jobs"})," can be viewed with the ",(0,i.jsx)(n.code,{children:"HELP SHOW ROUTINE LOAD;"})," command."]}),"\n",(0,i.jsxs)(n.p,{children:["Specific commands and examples to view the status of ",(0,i.jsx)(n.strong,{children:"tasks"})," running can be viewed with the ",(0,i.jsx)(n.code,{children:"HELP SHOW ROUTINE LOAD TASK;"})," command."]}),"\n",(0,i.jsx)(n.p,{children:"Only currently running tasks can be viewed; closed and unstarted tasks cannot be viewed."}),"\n",(0,i.jsx)(n.h3,{id:"modify-job-properties",children:"Modify job properties"}),"\n",(0,i.jsxs)(n.p,{children:["Users can modify jobs that have already been created. The details can be viewed with the ",(0,i.jsx)(n.code,{children:"HELP ALTER ROUTINE LOAD;"})," command or see [ALTER ROUTINE LOAD](... /... /... /sql-manual/sql-reference/Data-Manipulation-Statements/Load/ALTER-ROUTINE-LOAD.md)."]}),"\n",(0,i.jsx)(n.h3,{id:"job-control",children:"Job Control"}),"\n",(0,i.jsxs)(n.p,{children:["The user can control the stop, pause and restart of jobs with the ",(0,i.jsx)(n.code,{children:"STOP/PAUSE/RESUME"})," commands. Help and examples can be viewed with the ",(0,i.jsx)(n.code,{children:"HELP STOP ROUTINE LOAD;"})," ",(0,i.jsx)(n.code,{children:"HELP PAUSE ROUTINE LOAD;"})," and ",(0,i.jsx)(n.code,{children:"HELP RESUME ROUTINE LOAD;"})," commands."]}),"\n",(0,i.jsx)(n.h2,{id:"other-notes",children:"Other notes"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The relationship between a routine import job and an ALTER TABLE operation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Example import does not block SCHEMA CHANGE and ROLLUP operations. However, note that if the column mapping relationships do not match after the SCHEMA CHANGE completes, it can cause a spike in error data for the job and eventually cause the job to pause. It is recommended that you reduce this problem by explicitly specifying column mapping relationships in routine import jobs and by adding Nullable columns or columns with Default values."}),"\n",(0,i.jsx)(n.li,{children:"Deleting a Partition of a table may cause the imported data to fail to find the corresponding Partition and the job to enter a pause. 2."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Relationship between routine import jobs and other import jobs (LOAD, DELETE, INSERT)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"There is no conflict between the routine import and other LOAD operations and INSERT operations."}),"\n",(0,i.jsx)(n.li,{children:"When the DELETE operation is executed, the corresponding table partition cannot have any ongoing import jobs. Therefore, before executing DELETE operation, you may need to suspend the routine import job and wait until all the issued tasks are completed before executing DELETE. 3."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The relationship between routine import and DROP DATABASE/TABLE operations"}),"\n",(0,i.jsx)(n.p,{children:"When the database or table corresponding to the routine import is deleted, the job will automatically CANCEL."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The relationship between kafka type routine import jobs and kafka topic"}),"\n",(0,i.jsxs)(n.p,{children:["When the ",(0,i.jsx)(n.code,{children:"kafka_topic"})," declared by the user in the create routine import statement does not exist in the kafka cluster."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If the broker of the user's kafka cluster has ",(0,i.jsx)(n.code,{children:"auto.create.topics.enable = true"})," set, then ",(0,i.jsx)(n.code,{children:"kafka_topic"})," will be created automatically first, and the number of partitions created automatically is determined by the configuration of the broker in the ",(0,i.jsx)(n.strong,{children:"user's kafka cluster"})," with ",(0,i.jsx)(n.code,{children:"num. partitions"}),". The routine job will keep reading data from the topic as normal."]}),"\n",(0,i.jsxs)(n.li,{children:["If the broker in the user's kafka cluster has ",(0,i.jsx)(n.code,{children:"auto.create.topics.enable = false"})," set, the topic will not be created automatically and the routine job will be suspended with a status of ",(0,i.jsx)(n.code,{children:"PAUSED"})," before any data is read."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["So, if you want the kafka topic to be automatically created by the routine when it does not exist, just set ",(0,i.jsx)(n.code,{children:"auto.create.topics.enable = true"})," for the broker in the ",(0,i.jsx)(n.strong,{children:"user's kafka cluster"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Problems that may arise in network isolated environments In some environments there are isolation measures for network segments and domain name resolution, so care needs to be taken"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"the Broker list specified in the Create Routine load task must be accessible by the Doris service"}),"\n",(0,i.jsxs)(n.li,{children:["If ",(0,i.jsx)(n.code,{children:"advertised.listeners"})," is configured in Kafka, the addresses in ",(0,i.jsx)(n.code,{children:"advertised.listeners"})," must be accessible to the Doris service"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Specify the Partition and Offset for consumption"}),"\n",(0,i.jsx)(n.p,{children:"Doris supports specifying a Partition and Offset to start consumption. The new version also supports the ability to specify time points for consumption. The configuration of the corresponding parameters is explained here."}),"\n",(0,i.jsx)(n.p,{children:"There are three relevant parameters."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"kafka_partitions"}),': Specify the list of partitions to be consumed, e.g., "0, 1, 2, 3".']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"kafka_offsets"}),": specifies the starting offset of each partition, which must correspond to the number of ",(0,i.jsx)(n.code,{children:"kafka_partitions"}),' list. For example: "1000, 1000, 2000, 2000"']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"property.kafka_default_offset"}),": specifies the default starting offset of the partitions."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"When creating an import job, these three parameters can have the following combinations."}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"combinations"}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.code,{children:"kafka_partitions"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.code,{children:"kafka_offsets"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.code,{children:"property.kafka_default_offset"})}),(0,i.jsx)(n.th,{children:"behavior"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"1"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"The system will automatically find all partitions corresponding to the topic and start consuming them from OFFSET_END"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"The system will automatically find all the partitions corresponding to the topic and start consuming them from the default offset location."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"The system will start consuming from the OFFSET_END of the specified partition."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"The system will start consuming at the specified offset of the specified partition."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"The system will start consuming at the default offset of the specified partition"})]})]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The difference between STOP and PAUSE"}),"\n",(0,i.jsx)(n.p,{children:"FE will automatically clean up the ROUTINE LOAD in STOP status periodically, while the PAUSE status can be restored to enable again."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"related-parameters",children:"Related Parameters"}),"\n",(0,i.jsx)(n.p,{children:"Some system configuration parameters can affect the use of routine import."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"max_routine_load_task_concurrent_num"}),"\n",(0,i.jsx)(n.p,{children:"FE configuration item, defaults to 5 and can be modified at runtime. This parameter limits the maximum number of concurrent subtasks for a routine import job. It is recommended to keep the default value. Setting it too large may result in too many concurrent tasks and consume cluster resources."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"max_routine_load_task_num_per_be"}),"\n",(0,i.jsx)(n.p,{children:"FE configuration item, default is 5, can be modified at runtime. This parameter limits the maximum number of concurrently executed subtasks per BE node. It is recommended to keep the default value. If set too large, it may lead to too many concurrent tasks and consume cluster resources."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"max_routine_load_job_num"}),"\n",(0,i.jsx)(n.p,{children:"FE configuration item, default is 100, can be modified at runtime. This parameter limits the total number of routine import jobs, including the states NEED_SCHEDULED, RUNNING, PAUSE. After this, no new jobs can be submitted."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"max_consumer_num_per_group"}),"\n",(0,i.jsx)(n.p,{children:"BE configuration item, default is 3. This parameter indicates the maximum number of consumers that can be generated for data consumption in a subtask. For a Kafka data source, a consumer may consume one or more kafka partitions. If there are only 2 partitions, only 2 consumers are generated, each consuming 1 partition. 5. push_write_mby"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"max_tolerable_backend_down_num"}),"\n",(0,i.jsx)(n.p,{children:"FE configuration item, the default value is 0. Doris can PAUSED job rescheduling to RUNNING if certain conditions are met. 0 means rescheduling is allowed only if all BE nodes are ALIVE."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"period_of_auto_resume_min"}),"\n",(0,i.jsx)(n.p,{children:"FE configuration item, the default is 5 minutes, Doris rescheduling will only be attempted up to 3 times within the 5 minute period. If all 3 attempts fail, the current task is locked and no further scheduling is performed. However, manual recovery can be done through human intervention."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"more-help",children:"More help"}),"\n",(0,i.jsxs)(n.p,{children:["For more detailed syntax on the use of ",(0,i.jsx)(n.strong,{children:"Routine Load"}),", you can type ",(0,i.jsx)(n.code,{children:"HELP ROUTINE LOAD"})," at the Mysql client command line for more help."]})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return o},a:function(){return a}});var r=t(667294);let i={},s=r.createContext(i);function a(e){let n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);