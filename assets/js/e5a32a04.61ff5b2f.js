"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["646965"],{471173:function(e,n,i){i.r(n),i.d(n,{metadata:()=>s,contentTitle:()=>a,default:()=>h,assets:()=>l,toc:()=>o,frontMatter:()=>c});var s=JSON.parse('{"id":"query-acceleration/tuning/tuning-plan/accelerating-queries-with-sql-cache","title":"Accelerating Queries with SQL Cache","description":"\x3c!--","source":"@site/versioned_docs/version-3.0/query-acceleration/tuning/tuning-plan/accelerating-queries-with-sql-cache.md","sourceDirName":"query-acceleration/tuning/tuning-plan","slug":"/query-acceleration/tuning/tuning-plan/accelerating-queries-with-sql-cache","permalink":"/docs/3.0/query-acceleration/tuning/tuning-plan/accelerating-queries-with-sql-cache","draft":false,"unlisted":false,"tags":[],"version":"3.0","frontMatter":{"title":"Accelerating Queries with SQL Cache","language":"en"},"sidebar":"docs","previous":{"title":"Reordering Join with Leading Hint","permalink":"/docs/3.0/query-acceleration/tuning/tuning-plan/reordering-join-with-leading-hint"},"next":{"title":"Accelerating Query with Runtime Filter Tuning","permalink":"/docs/3.0/query-acceleration/tuning/tuning-plan/accelerating-queries-with-runtime-filter"}}'),t=i("785893"),r=i("250065");let c={title:"Accelerating Queries with SQL Cache",language:"en"},a=void 0,l={},o=[{value:"Principle",id:"principle",level:2},{value:"Use Case",id:"use-case",level:2},{value:"Summary",id:"summary",level:2}];function d(e){let n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"principle",children:"Principle"}),"\n",(0,t.jsxs)(n.p,{children:["For detailed implementation principles of SQL Cache, please refer to ",(0,t.jsx)(n.a,{href:"../../../query-acceleration/sql-cache-manual",children:"SQL Cache"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"use-case",children:"Use Case"}),"\n",(0,t.jsx)(n.p,{children:"The following case illustrates how to enable and use SQL Cache in Doris:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Ensure that ",(0,t.jsx)(n.code,{children:"cache_enable_sql_mode"})," in ",(0,t.jsx)(n.code,{children:"fe.conf"})," is set to ",(0,t.jsx)(n.code,{children:"true"})," (default is ",(0,t.jsx)(n.code,{children:"true"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"vim fe/conf/fe.conf\ncache_enable_sql_mode=true\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Set the variable in the MySQL command line:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"MySQL [(none)]> set global enable_sql_cache=true;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Note: ",(0,t.jsx)(n.code,{children:"GLOBAL"})," indicates a global variable, not just for the current session."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"In Doris versions 2.1.3 and above, you can control the number of cache key entries and the cleanup time with the following commands:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"MySQL [(none)]> ADMIN SET FRONTEND CONFIG ('sql_cache_manage_num' = '100');\nMySQL [(none)]> ADMIN SET FRONTEND CONFIG ('expire_sql_cache_in_fe_second' = '300');\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Execute the query"}),"\n",(0,t.jsx)(n.p,{children:'Suppose we have a table named "sales" containing information on date, product, and sales amount. We need to query the total sales for each product over the past 30 days:'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT product, SUM(amount) as total_sales\nFROM sales\nWHERE date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)\nGROUP BY product\nORDER BY total_sales DESC\nLIMIT 10;\n"})}),"\n",(0,t.jsx)(n.p,{children:"When this query is executed for the first time, Doris retrieves the results from the BE and stores them in the cache. Subsequent executions of the same query will retrieve the results directly from the cache if the data has not been updated, significantly improving query speed."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Cache Conditions"}),"\n",(0,t.jsx)(n.p,{children:"After the initial query, the query results will be cached if the following three conditions are met:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["(Current time - last update time of the query partition) is greater than ",(0,t.jsx)(n.code,{children:"cache_last_version_interval_second"})," in ",(0,t.jsx)(n.code,{children:"fe.conf"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The number of query result rows is less than ",(0,t.jsx)(n.code,{children:"cache_result_max_row_count"})," in ",(0,t.jsx)(n.code,{children:"fe.conf"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The number of bytes in the query results is less than ",(0,t.jsx)(n.code,{children:"cache_result_max_data_size"})," in ",(0,t.jsx)(n.code,{children:"fe.conf"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(n.p,{children:"SQL Cache is a query optimization mechanism provided by Doris that can significantly improve query performance. When using it, please note:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["SQL Cache is not suitable for queries containing functions that generate random values (such as ",(0,t.jsx)(n.code,{children:"random()"}),"), as this can cause the query results to lose randomness."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Currently, it does not support using cached results of some metrics to satisfy queries for more metrics. For example, cached results for two metrics cannot be used for queries involving three metrics."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"By reasonably using SQL Cache, you can significantly improve Doris's query performance, especially in scenarios with low data update frequency. In practical applications, cache parameters need to be adjusted based on specific data characteristics and query patterns to achieve optimal performance improvements."}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return a},a:function(){return c}});var s=i(667294);let t={},r=s.createContext(t);function c(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);