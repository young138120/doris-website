"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["632165"],{164969:function(e,n,i){i.r(n),i.d(n,{metadata:()=>t,contentTitle:()=>o,default:()=>d,assets:()=>a,toc:()=>c,frontMatter:()=>l});var t=JSON.parse('{"id":"query-acceleration/tuning/tuning-plan/controlling-hints-with-cbo-rule","title":"Controlling Hints with CBO Rule","description":"\x3c!--","source":"@site/versioned_docs/version-3.0/query-acceleration/tuning/tuning-plan/controlling-hints-with-cbo-rule.md","sourceDirName":"query-acceleration/tuning/tuning-plan","slug":"/query-acceleration/tuning/tuning-plan/controlling-hints-with-cbo-rule","permalink":"/docs/3.0/query-acceleration/tuning/tuning-plan/controlling-hints-with-cbo-rule","draft":false,"unlisted":false,"tags":[],"version":"3.0","frontMatter":{"title":"Controlling Hints with CBO Rule","language":"zh-CN"},"sidebar":"docs","previous":{"title":"Adjusting Join Shuffle with Hint","permalink":"/docs/3.0/query-acceleration/tuning/tuning-plan/adjusting-join-shuffle"},"next":{"title":"Reordering Join with Leading Hint","permalink":"/docs/3.0/query-acceleration/tuning/tuning-plan/reordering-join-with-leading-hint"}}'),s=i("785893"),r=i("250065");let l={title:"Controlling Hints with CBO Rule",language:"zh-CN"},o=void 0,a={},c=[{value:"Principles",id:"principles",level:2},{value:"Tuning Usage Case",id:"tuning-usage-case",level:2},{value:"Summary",id:"summary",level:2}];function h(e){let n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"principles",children:"Principles"}),"\n",(0,s.jsx)(n.p,{children:"The query optimizer applies a series of rules in the process of generating execution plans. These rules are mainly divided into two categories: Rule-Based Optimizer (RBO) and Cost-Based Optimizer (CBO)."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"RBO: This type of optimization improves the query plan by applying a set of predefined heuristic rules without considering specific data statistics. Examples include strategies such as predicate pushdown and projection pushdown."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"CBO: This type of optimization utilizes data statistics to estimate the cost of different execution plans and selects the plan with the lowest cost for execution. This includes the selection of access paths and join algorithms."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"In some cases, database administrators or developers may need more granular control over the query optimization process. Based on this, this document will introduce how to use query hints to manage CBO rules."}),"\n",(0,s.jsx)(n.p,{children:"The basic syntax for CBO rule control hints is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT /*+ USE_CBO_RULE(rule1, rule2, ...) */ ...\n"})}),"\n",(0,s.jsx)(n.p,{children:"This hint should immediately follow the SELECT keyword, and the names of the rules to be enabled should be specified within parentheses (note: rule names are case-insensitive)."}),"\n",(0,s.jsxs)(n.p,{children:["In the optimizer, the following CBO rules are disabled by default and need to be explicitly enabled using the ",(0,s.jsx)(n.code,{children:"USE_CBO_RULE hint"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"PUSH_DOWN_AGG_THROUGH_JOIN"}),"\n",(0,s.jsx)(n.li,{children:"PUSH_DOWN_AGG_THROUGH_JOIN_ONE_SIDE"}),"\n",(0,s.jsx)(n.li,{children:"PUSH_DOWN_DISTINCT_THROUGH_JOIN"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These rules mainly involve the optimization of aggregation operations and JOIN operations. The specific optimization logic is as follows:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["The system first checks whether the ",(0,s.jsx)(n.code,{children:"USE_CBO_RULE hint"})," exists in the query."]}),"\n",(0,s.jsx)(n.li,{children:"If the hint exists, the system will traverse all specified rules."}),"\n",(0,s.jsx)(n.li,{children:"For each rule, the system checks if it is on the whitelist. If it is, the rule will be enabled."}),"\n",(0,s.jsx)(n.li,{children:"If the specified rule is not on the whitelist, the system will further check if it is a valid rule name. If it is a valid rule, the rule will also be enabled."}),"\n",(0,s.jsx)(n.li,{children:"Any unrecognized rule names will be ignored by the system."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"tuning-usage-case",children:"Tuning Usage Case"}),"\n",(0,s.jsx)(n.p,{children:"Here is a query example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT /*+ USE_CBO_RULE(push_down_agg_through_join, push_down_agg_through_join_one_side) */    a.event_id,\n    b.experiment_id,\n    b.group_id,\n    COUNT(a.event_id)\nFROM\n    com_dd_library a\nJOIN shunt_log_com_dd_library b ON\n    a.device_id = b.device_id\nGROUP BY\n    b.group_id,\n    b.experiment_id,\n    a.event_id;\n"})}),"\n",(0,s.jsx)(n.p,{children:"In this example, we have enabled two aggregation pushdown rules. This operation may enable the optimizer to generate a more efficient execution plan, especially when processing large datasets."}),"\n",(0,s.jsx)(n.p,{children:"Best Practices:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Use CBO rule hints cautiously. In most cases, the optimizer can make good decisions."}),"\n",(0,s.jsx)(n.li,{children:"Before applying hints, analyze query performance and identify bottlenecks."}),"\n",(0,s.jsx)(n.li,{children:"Verify the effect of hints in a test environment to ensure they actually improve performance."}),"\n",(0,s.jsx)(n.li,{children:"Regularly reevaluate applied hints, as changes in data distribution and system configuration may affect their effectiveness."}),"\n",(0,s.jsx)(n.li,{children:"Document all applied hints and their reasons to facilitate subsequent maintenance and optimization efforts."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.p,{children:["By using the ",(0,s.jsx)(n.code,{children:"USE_CBO_RULE hint"})," appropriately, you can fine-tune the behavior of the query optimizer in specific scenarios, potentially improving the performance of complex queries. However, this requires a deep understanding of the query optimization process and data characteristics. In most cases, relying on the optimizer's automatic decisions remains the best choice."]})]})}function d(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return o},a:function(){return l}});var t=i(667294);let s={},r=t.createContext(s);function l(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);