"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["310571"],{757129:function(e,n,a){a.r(n),a.d(n,{metadata:()=>t,contentTitle:()=>i,default:()=>u,assets:()=>o,toc:()=>c,frontMatter:()=>l});var t=JSON.parse('{"id":"compute-storage-decoupled/managing-storage-vault","title":"Managing Storage Vault","description":"\x3c!--","source":"@site/versioned_docs/version-3.0/compute-storage-decoupled/managing-storage-vault.md","sourceDirName":"compute-storage-decoupled","slug":"/compute-storage-decoupled/managing-storage-vault","permalink":"/docs/3.0/compute-storage-decoupled/managing-storage-vault","draft":false,"unlisted":false,"tags":[],"version":"3.0","frontMatter":{"title":"Managing Storage Vault","language":"en"},"sidebar":"docs","previous":{"title":"Compilation and Deployment","permalink":"/docs/3.0/compute-storage-decoupled/compilation-and-deployment"},"next":{"title":"Managing Compute Groups","permalink":"/docs/3.0/compute-storage-decoupled/managing-compute-cluster"}}'),r=a("785893"),s=a("250065");let l={title:"Managing Storage Vault",language:"en"},i=void 0,o={},c=[{value:"Create an Storage Vault",id:"create-an-storage-vault",level:2},{value:"Create an HDFS Storage Vault",id:"create-an-hdfs-storage-vault",level:3},{value:"Create an S3 Storage Vault",id:"create-an-s3-storage-vault",level:3},{value:"View Storage Vaults",id:"view-storage-vaults",level:2},{value:"Set the Default Storage Vault",id:"set-the-default-storage-vault",level:2},{value:"Specify Storage Vault When Creating a Table",id:"specify-storage-vault-when-creating-a-table",level:2},{value:"Alter Storage Vault",id:"alter-storage-vault",level:2},{value:"Delete an Storage Vault",id:"delete-an-storage-vault",level:2},{value:"Storage Vault Privilege",id:"storage-vault-privilege",level:2},{value:"Granting",id:"granting",level:3},{value:"Revoking",id:"revoking",level:3}];function d(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"The Storage Vault is a remote shared storage used by Doris in a decoupled storage-compute model. You can configure one or more Storage Vaults to store different tables in different Storage Vaults."}),"\n",(0,r.jsx)(n.h2,{id:"create-an-storage-vault",children:"Create an Storage Vault"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Syntax"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE STORAGE VAULT [IF NOT EXISTS] <vault_name>\nPROPERTIES\n("key" = "value",...)\n'})}),"\n",(0,r.jsx)(n.p,{children:"<vault_name> is the user-defined name of the Storage Vault, which serves as the identifier for accessing the Storage Vault."}),"\n",(0,r.jsx)(n.h3,{id:"create-an-hdfs-storage-vault",children:"Create an HDFS Storage Vault"}),"\n",(0,r.jsx)(n.p,{children:"To create an HDFS-based decoupled storage-compute Doris cluster, ensure that all nodes (including FE/BE nodes, Meta Service) have privilege to access the specified HDFS, including completing Kerberos authorization configuration and connectivity checks in advance (which can be tested using Hadoop Client on each corresponding node)."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE STORAGE VAULT IF NOT EXISTS ssb_hdfs_vault\n    PROPERTIES (\n        "type"="hdfs",                                     -- required\n        "fs.defaultFS"="hdfs://127.0.0.1:8020",            -- required\n        "path_prefix"="big/data",                          -- optional, generally filled in according to business name\n        "hadoop.username"="user"                           -- optional\n        "hadoop.security.authentication"="kerberos"        -- optional\n        "hadoop.kerberos.principal"="hadoop/127.0.0.1@XXX" -- optional\n        "hadoop.kerberos.keytab"="/etc/emr.keytab"         -- optional\n    );\n'})}),"\n",(0,r.jsx)(n.h3,{id:"create-an-s3-storage-vault",children:"Create an S3 Storage Vault"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE STORAGE VAULT IF NOT EXISTS ssb_s3_vault\n    PROPERTIES (\n        "type"="S3",                                   -- required\n        "s3.endpoint" = "oss-cn-beijing.aliyuncs.com", -- required\n        "s3.region" = "bj",                            -- required\n        "s3.bucket" = "bucket",                        -- required\n        "s3.root.path" = "big/data/prefix",            -- required\n        "s3.access_key" = "ak",                        -- required\n        "s3.secret_key" = "sk",                        -- required\n        "provider" = "OSS"                             -- required\n    );\n'})}),"\n",(0,r.jsxs)(n.p,{children:["More parameter explanations and examples can be found in ",(0,r.jsx)(n.a,{href:"/docs/3.0/sql-manual/sql-statements/cluster-management/storage-management/CREATE-STORAGE-VAULT",children:"CREATE-STORAGE-VAULT"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"view-storage-vaults",children:"View Storage Vaults"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Syntax"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"SHOW STORAGE VAULTS\n"})}),"\n",(0,r.jsx)(n.p,{children:"The returned result includes 4 columns: the Storage Vault name, Storage Vault ID, properties, and whether it is the default Storage Vault."}),"\n",(0,r.jsx)(n.h2,{id:"set-the-default-storage-vault",children:"Set the Default Storage Vault"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Syntax"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SET <vault_name> AS DEFAULT STORAGE VAULT\n"})}),"\n",(0,r.jsx)(n.h2,{id:"specify-storage-vault-when-creating-a-table",children:"Specify Storage Vault When Creating a Table"}),"\n",(0,r.jsxs)(n.p,{children:["When creating a table, specify ",(0,r.jsx)(n.code,{children:"storage_vault_name"})," in ",(0,r.jsx)(n.code,{children:"PROPERTIES"}),", and the data will be stored in the Storage Vault corresponding to the specified ",(0,r.jsx)(n.code,{children:"vault name"}),". Once the table is successfully created, the ",(0,r.jsx)(n.code,{children:"storage_vault"})," cannot be modified, meaning changing the Storage Vault is not supported."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE IF NOT EXISTS supplier (\n  s_suppkey int(11) NOT NULL COMMENT "",\n  s_name varchar(26) NOT NULL COMMENT "",\n  s_address varchar(26) NOT NULL COMMENT "",\n  s_city varchar(11) NOT NULL COMMENT "",\n  s_nation varchar(16) NOT NULL COMMENT "",\n  s_region varchar(13) NOT NULL COMMENT "",\n  s_phone varchar(16) NOT NULL COMMENT ""\n)\nUNIQUE KEY (s_suppkey)\nDISTRIBUTED BY HASH(s_suppkey) BUCKETS 1\nPROPERTIES (\n"replication_num" = "1",\n"storage_vault_name" = "ssb_hdfs_vault"\n);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"alter-storage-vault",children:"Alter Storage Vault"}),"\n",(0,r.jsx)(n.p,{children:"Used to alter modifiable properties of the Storage Vault configuration."}),"\n",(0,r.jsx)(n.p,{children:"S3 Storage Vault allowed properties:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"VAULT_NAME"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"s3.access_key"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"s3.secret_key"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"use_path_style"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"HDFS Storage Vault forbidden properties:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"path_prefix"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"fs.defaultFS"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Properties explanations can be found in ",(0,r.jsx)(n.a,{href:"/docs/3.0/sql-manual/sql-statements/cluster-management/storage-management/CREATE-STORAGE-VAULT",children:"CREATE-STORAGE-VAULT"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'ALTER STORAGE VAULT old_s3_vault\nPROPERTIES (\n    "type" = "S3",\n    "VAULT_NAME" = "new_s3_vault",\n    "s3.access_key" = "new_ak"\n    "s3.secret_key" = "new_sk"\n);\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'ALTER STORAGE VAULT old_hdfs_vault\nPROPERTIES (\n    "type" = "hdfs",\n    "VAULT_NAME" = "new_hdfs_vault",\n    "hadoop.username" = "hdfs"\n);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"delete-an-storage-vault",children:"Delete an Storage Vault"}),"\n",(0,r.jsx)(n.p,{children:"Not supported"}),"\n",(0,r.jsx)(n.h2,{id:"storage-vault-privilege",children:"Storage Vault Privilege"}),"\n",(0,r.jsx)(n.p,{children:"Grant a specified MySQL user the usage privilege for a certain Storage Vault, allowing the user to specify that Storage Vault when creating tables or viewing Storage Vaults."}),"\n",(0,r.jsx)(n.h3,{id:"granting",children:"Granting"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"GRANT\n    USAGE_PRIV\n    ON STORAGE VAULT <vault_name>\n    TO { ROLE | USER } {<role> | <user>}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Only Admin users have the authority to execute the ",(0,r.jsx)(n.code,{children:"GRANT"})," statement, which is used to grant specified Storage Vault privileges to User/Role. Users/Roles with ",(0,r.jsx)(n.code,{children:"USAGE_PRIV"})," privilege for a certain Storage Vault can perform the following operations:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["View the information of that Storage Vault through ",(0,r.jsx)(n.code,{children:"SHOW STORAGE VAULT"}),";"]}),"\n",(0,r.jsxs)(n.li,{children:["Specify the use of that Storage Vault in ",(0,r.jsx)(n.code,{children:"PROPERTIES"})," when creating tables."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"grant usage_priv on storage vault my_storage_vault to user1\n"})}),"\n",(0,r.jsx)(n.h3,{id:"revoking",children:"Revoking"}),"\n",(0,r.jsx)(n.p,{children:"Revoke the Storage Vault privileges of a specified MySQL user."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Syntax"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"REVOKE \n    USAGE_PRIV\n    ON STORAGE VAULT <vault_name>\n    FROM { ROLE | USER } {<role> | <user>}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Only Admin users have the authority to execute the ",(0,r.jsx)(n.code,{children:"REVOKE"})," statement, which is used to revoke the privileges of User/Role for the specified Storage Vault."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"revoke usage_priv on storage vault my_storage_vault from user1\n"})})]})}function u(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},250065:function(e,n,a){a.d(n,{Z:function(){return i},a:function(){return l}});var t=a(667294);let r={},s=t.createContext(r);function l(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);