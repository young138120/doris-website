"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["328065"],{308711:function(e,n,s){s.r(n),s.d(n,{metadata:()=>r,contentTitle:()=>l,default:()=>h,assets:()=>d,toc:()=>c,frontMatter:()=>a});var r=JSON.parse('{"id":"lakehouse/multi-catalog/iceberg","title":"Iceberg","description":"\x3c!--","source":"@site/versioned_docs/version-1.2/lakehouse/multi-catalog/iceberg.md","sourceDirName":"lakehouse/multi-catalog","slug":"/lakehouse/multi-catalog/iceberg","permalink":"/docs/1.2/lakehouse/multi-catalog/iceberg","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"Iceberg","language":"en"},"sidebar":"docs","previous":{"title":"Hive","permalink":"/docs/1.2/lakehouse/multi-catalog/hive"},"next":{"title":"Hudi","permalink":"/docs/1.2/lakehouse/multi-catalog/hudi"}}'),t=s("785893"),i=s("250065");let a={title:"Iceberg",language:"en"},l="Iceberg",d={},c=[{value:"Usage",id:"usage",level:2},{value:"Create Catalog",id:"create-catalog",level:2},{value:"Hive Metastore Catalog",id:"hive-metastore-catalog",level:3},{value:"Iceberg Native Catalog",id:"iceberg-native-catalog",level:3},{value:"Using Iceberg Hive Catalog",id:"using-iceberg-hive-catalog",level:4},{value:"Using Iceberg Glue Catalog",id:"using-iceberg-glue-catalog",level:4},{value:"Column Type Mapping",id:"column-type-mapping",level:2},{value:"Time Travel",id:"time-travel",level:2}];function o(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",version:"version",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"iceberg",children:"Iceberg"})}),"\n",(0,t.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsx)(n.p,{children:"When connecting to Iceberg, Doris:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Supports Iceberg V1/V2 table formats;"}),"\n",(0,t.jsx)(n.li,{children:"Supports Position Delete but not Equality Delete for V2 format;"}),"\n",(0,t.jsx)(n.li,{children:"Supports Parquet formmat;"}),"\n"]}),"\n",(0,t.jsxs)(n.version,{since:"dev",children:["\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:["Supports Hive / Iceberg tables with data stored in GooseFS(GFS), which can be used the same way as normal Hive tables. Follow below steps to prepare doris environment\uFF1A\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"put goosefs-x.x.x-client.jar in fe/lib/ and apache_hdfs_broker/lib/"}),"\n",(0,t.jsx)(n.li,{children:"add extra properties 'fs.AbstractFileSystem.gfs.impl' = 'com.qcloud.cos.goosefs.hadoop.GooseFileSystem'\uFF0C 'fs.gfs.impl' = 'com.qcloud.cos.goosefs.hadoop.FileSystem' when creating catalog"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"create-catalog",children:"Create Catalog"}),"\n",(0,t.jsx)(n.h3,{id:"hive-metastore-catalog",children:"Hive Metastore Catalog"}),"\n",(0,t.jsxs)(n.p,{children:["Same as creating Hive Catalogs. A simple example is provided here. See ",(0,t.jsx)(n.a,{href:"/docs/1.2/lakehouse/multi-catalog/hive",children:"Hive"})," for more information."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.21.0.1:7004',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:4007',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:4007',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"iceberg-native-catalog",children:"Iceberg Native Catalog"}),"\n",(0,t.jsxs)(n.version,{since:"dev",children:["\n",(0,t.jsx)(n.p,{children:"Access metadata with the iceberg API. The Hive, REST, Glue and other services can serve as the iceberg catalog."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"using-iceberg-hive-catalog",children:"Using Iceberg Hive Catalog"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type'='hms',\n    'hive.metastore.uris' = 'thrift://172.21.0.1:7004',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:4007',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:4007',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,t.jsx)(n.h4,{id:"using-iceberg-glue-catalog",children:"Using Iceberg Glue Catalog"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'CREATE CATALOG glue PROPERTIES (\n"type"="iceberg",\n"iceberg.catalog.type" = "glue",\n"glue.endpoint" = "https://glue.us-east-1.amazonaws.com",\n"warehouse" = "s3://bucket/warehouse",\n"AWS_ENDPOINT" = "s3.us-east-1.amazonaws.com",\n"AWS_REGION" = "us-east-1",\n"AWS_ACCESS_KEY" = "ak",\n"AWS_SECRET_KEY" = "sk",\n"use_path_style" = "true"\n);\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"glue.endpoint"}),": Glue Endpoint. See ",(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/general/latest/gr/glue.html",children:"AWS Glue endpoints and quotas"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"warehouse"}),": Glue Warehouse Location.  To determine the root path of the data warehouse in storage."]}),"\n",(0,t.jsxs)(n.p,{children:["The other properties can refer to ",(0,t.jsx)(n.a,{href:"https://iceberg.apache.org/docs/latest/aws/#glue-catalog",children:"Iceberg Glue Catalog"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Using Iceberg REST Catalog"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"RESTful service as the server side. Implementing RESTCatalog interface of iceberg to obtain metadata."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type'='rest',\n    'uri' = 'http://172.21.0.1:8181',\n);\n"})}),"\n",(0,t.jsx)(n.p,{children:"If you want to use S3 storage, the following properties need to be set."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'"AWS_ACCESS_KEY" = "ak"\n"AWS_SECRET_KEY" = "sk"\n"AWS_REGION" = "region-name"\n"AWS_ENDPOINT" = "http://endpoint-uri"\n"AWS_CREDENTIALS_PROVIDER" = "provider-class-name" // Optional. The default credentials class is based on BasicAWSCredentials.\n'})}),"\n",(0,t.jsx)(n.h2,{id:"column-type-mapping",children:"Column Type Mapping"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Iceberg Type"}),(0,t.jsx)(n.th,{children:"Doris Type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"boolean"}),(0,t.jsx)(n.td,{children:"boolean"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"int"}),(0,t.jsx)(n.td,{children:"int"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"long"}),(0,t.jsx)(n.td,{children:"bigint"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"float"}),(0,t.jsx)(n.td,{children:"float"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"double"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"decimal(p,s)"}),(0,t.jsx)(n.td,{children:"decimal(p,s)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"date"}),(0,t.jsx)(n.td,{children:"date"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"uuid"}),(0,t.jsx)(n.td,{children:"string"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"timestamp (Timestamp without timezone)"}),(0,t.jsx)(n.td,{children:"datetime(6)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"timestamptz (Timestamp with timezone)"}),(0,t.jsx)(n.td,{children:"datetime(6)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"string"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"fixed(L)"}),(0,t.jsx)(n.td,{children:"char(L)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"binary"}),(0,t.jsx)(n.td,{children:"string"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"list"}),(0,t.jsx)(n.td,{children:"array"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"struct"}),(0,t.jsx)(n.td,{children:"unsupported"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"map"}),(0,t.jsx)(n.td,{children:"unsupported"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"time"}),(0,t.jsx)(n.td,{children:"unsupported"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"time-travel",children:"Time Travel"}),"\n",(0,t.jsxs)(n.version,{since:"1.2.2",children:["\n",(0,t.jsx)(n.p,{children:"Doris supports reading the specified Snapshot of Iceberg tables."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Each write operation to an Iceberg table will generate a new Snapshot."}),"\n",(0,t.jsx)(n.p,{children:"By default, a read request will only read the latest Snapshot."}),"\n",(0,t.jsxs)(n.p,{children:["You can read data of historical table versions using the  ",(0,t.jsx)(n.code,{children:"FOR TIME AS OF"}),"  or  ",(0,t.jsx)(n.code,{children:"FOR VERSION AS OF"}),"  statements based on the Snapshot ID or the timepoint the Snapshot is generated. For example:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:'SELECT * FROM iceberg_tbl FOR TIME AS OF "2022-10-07 17:20:37";'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"SELECT * FROM iceberg_tbl FOR VERSION AS OF 868895038966572;"})}),"\n",(0,t.jsxs)(n.p,{children:["You can use the ",(0,t.jsx)(n.a,{href:"https://doris.apache.org/docs/dev/sql-manual/sql-functions/table-functions/iceberg_meta/",children:"iceberg_meta"})," table function to view the Snapshot details of the specified table."]})]})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return l},a:function(){return a}});var r=s(667294);let t={},i=r.createContext(t);function a(e){let n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);