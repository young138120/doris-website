"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["308312"],{691586:function(e,n,t){t.r(n),t.d(n,{metadata:()=>r,contentTitle:()=>d,default:()=>h,assets:()=>l,toc:()=>c,frontMatter:()=>o});var r=JSON.parse('{"id":"install/standard-deployment","title":"Standard deployment","description":"\x3c!--","source":"@site/versioned_docs/version-1.2/install/standard-deployment.md","sourceDirName":"install","slug":"/install/standard-deployment","permalink":"/docs/1.2/install/standard-deployment","draft":false,"unlisted":false,"tags":[],"version":"1.2","frontMatter":{"title":"Standard deployment","language":"en"},"sidebar":"docs","previous":{"title":"Introduction to Apache Doris","permalink":"/docs/1.2/summary/basic-summary"},"next":{"title":"Build Docker Image","permalink":"/docs/1.2/install/construct-docker/construct-docker-image"}}'),s=t("785893"),i=t("250065");let o={title:"Standard deployment",language:"en"},d="Installation and Deployment",l={},c=[{value:"Software and Hardware Requirements",id:"software-and-hardware-requirements",level:2},{value:"Overview",id:"overview",level:3},{value:"Linux Operating System Version Requirements",id:"linux-operating-system-version-requirements",level:4},{value:"Software Requirements",id:"software-requirements",level:4},{value:"OS Installation Requirements",id:"os-installation-requirements",level:4},{value:"Clock synchronization",id:"clock-synchronization",level:5},{value:"Close the swap partition",id:"close-the-swap-partition",level:5},{value:"Linux file system",id:"linux-file-system",level:5},{value:"Development Test Environment",id:"development-test-environment",level:4},{value:"Production Environment",id:"production-environment",level:4},{value:"Broker Deployment",id:"broker-deployment",level:4},{value:"Network Requirements",id:"network-requirements",level:4},{value:"IP Binding",id:"ip-binding",level:4},{value:"Table Name Case Sensitivity",id:"table-name-case-sensitivity",level:4},{value:"Cluster Deployment",id:"cluster-deployment",level:2},{value:"Manual Deployment",id:"manual-deployment",level:3},{value:"Deploy FE",id:"deploy-fe",level:4},{value:"Deploy BE",id:"deploy-be",level:4},{value:"(Optional) FS_Broker Deployment",id:"optional-fs_broker-deployment",level:4},{value:"FAQ",id:"faq",level:2},{value:"Process-Related Questions",id:"process-related-questions",level:3}];function a(e){let n={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",version:"version",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"installation-and-deployment",children:"Installation and Deployment"})}),"\n",(0,s.jsx)(n.p,{children:"This topic is about the hardware and software environment needed to deploy Doris, the recommended deployment mode, cluster scaling, and common problems occur in creating and running clusters."}),"\n",(0,s.jsxs)(n.p,{children:["Before continue reading, you might want to compile Doris following the instructions in the ",(0,s.jsx)(n.a,{href:"/docs/1.2/install/source-install/compilation-general",children:"General Compile"})," topic."]}),"\n",(0,s.jsx)(n.h2,{id:"software-and-hardware-requirements",children:"Software and Hardware Requirements"}),"\n",(0,s.jsx)(n.h3,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Doris, as an open source OLAP database with an MPP architecture, can run on most mainstream commercial servers. For you to take full advantage of the high concurrency and high availability of Doris, we recommend that your computer meet the following requirements:"}),"\n",(0,s.jsx)(n.h4,{id:"linux-operating-system-version-requirements",children:"Linux Operating System Version Requirements"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Linux System"}),(0,s.jsx)(n.th,{children:"Version"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Centos"}),(0,s.jsx)(n.td,{children:"7.1 and above"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Ubuntu"}),(0,s.jsx)(n.td,{children:"16.04 and above"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"software-requirements",children:"Software Requirements"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Soft"}),(0,s.jsx)(n.th,{children:"Version"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Java"}),(0,s.jsx)(n.td,{children:"1.8 and above"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"GCC"}),(0,s.jsx)(n.td,{children:"4.8.2 and above"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"os-installation-requirements",children:"OS Installation Requirements"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Set the maximum number of open file descriptors in the system"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"vi /etc/security/limits.conf\n* soft nofile 65536\n* hard nofile 65536\n"})}),"\n",(0,s.jsx)(n.h5,{id:"clock-synchronization",children:"Clock synchronization"}),"\n",(0,s.jsx)(n.p,{children:"The metadata in Doris requires a time precision of less than 5000ms, so all machines in all clusters need to synchronize their clocks to avoid service exceptions caused by inconsistencies in metadata caused by clock problems."}),"\n",(0,s.jsx)(n.h5,{id:"close-the-swap-partition",children:"Close the swap partition"}),"\n",(0,s.jsx)(n.p,{children:"The Linux swap partition can cause serious performance problems for Doris, so you need to disable the swap partition before installation."}),"\n",(0,s.jsx)(n.h5,{id:"linux-file-system",children:"Linux file system"}),"\n",(0,s.jsx)(n.p,{children:"Both ext4 and xfs file systems are supported."}),"\n",(0,s.jsx)(n.h4,{id:"development-test-environment",children:"Development Test Environment"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Module"}),(0,s.jsx)(n.th,{children:"CPU"}),(0,s.jsx)(n.th,{children:"Memory"}),(0,s.jsx)(n.th,{children:"Disk"}),(0,s.jsx)(n.th,{children:"Network"}),(0,s.jsx)(n.th,{children:"Number of Instances"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Frontend"}),(0,s.jsx)(n.td,{children:"8 core +"}),(0,s.jsx)(n.td,{children:"8GB +"}),(0,s.jsx)(n.td,{children:"SSD or SATA, 10GB + *"}),(0,s.jsx)(n.td,{children:"Gigabit Network Card"}),(0,s.jsx)(n.td,{children:"1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Backend"}),(0,s.jsx)(n.td,{children:"8 core +"}),(0,s.jsx)(n.td,{children:"16GB +"}),(0,s.jsx)(n.td,{children:"SSD or SATA, 50GB + *"}),(0,s.jsx)(n.td,{children:"Gigabit Network Card"}),(0,s.jsx)(n.td,{children:"1-3*"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"production-environment",children:"Production Environment"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Module"}),(0,s.jsx)(n.th,{children:"CPU"}),(0,s.jsx)(n.th,{children:"Memory"}),(0,s.jsx)(n.th,{children:"Disk"}),(0,s.jsx)(n.th,{children:"Network"}),(0,s.jsx)(n.th,{children:"Number of Instances (Minimum Requirements)"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Frontend"}),(0,s.jsx)(n.td,{children:"16 core +"}),(0,s.jsx)(n.td,{children:"64GB +"}),(0,s.jsx)(n.td,{children:"SSD or RAID card, 100GB + *"}),(0,s.jsx)(n.td,{children:"10,000 Mbp network card"}),(0,s.jsx)(n.td,{children:"1-3*"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Backend"}),(0,s.jsx)(n.td,{children:"16 core +"}),(0,s.jsx)(n.td,{children:"64GB +"}),(0,s.jsx)(n.td,{children:"SSD or SATA, 100G + *"}),(0,s.jsx)(n.td,{children:"10-100 Mbp network card"}),(0,s.jsx)(n.td,{children:"3 *"})]})]})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Note 1:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The disk space of FE is mainly used to store metadata, including logs and images. It usually ranges from several hundred MB to several GB."}),"\n",(0,s.jsx)(n.li,{children:"The disk space of BE is mainly used to store user data. The total disk space taken up is 3 times the total user data (3 copies). Then an additional 40% of the space is reserved for background compaction and intermediate data storage."}),"\n",(0,s.jsxs)(n.li,{children:["On one single machine, you can deploy multiple BE instances but ",(0,s.jsx)(n.strong,{children:"only one FE instance"}),". If you need 3 copies of the data, you need to deploy 3 BE instances on 3 machines (1 instance per machine) instead of 3 BE instances on one machine). ",(0,s.jsx)(n.strong,{children:"Clocks of the FE servers must be consistent (allowing a maximum clock skew of 5 seconds)."})]}),"\n",(0,s.jsx)(n.li,{children:"The test environment can also be tested with only 1 BE instance. In the actual production environment, the number of BE instances directly determines the overall query latency."}),"\n",(0,s.jsx)(n.li,{children:"Disable swap for all deployment nodes."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Note 2: Number of FE nodes"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"FE nodes are divided into Followers and Observers based on their roles. (Leader is an elected role in the Follower group, hereinafter referred to as Follower, too.)"}),"\n",(0,s.jsx)(n.li,{children:"The number of FE nodes should be at least 1 (1 Follower). If you deploy 1 Follower and 1 Observer, you can achieve high read availability; if you deploy 3 Followers, you can achieve high read-write  availability (HA)."}),"\n",(0,s.jsxs)(n.li,{children:["The number of Followers ",(0,s.jsx)(n.strong,{children:"must be"})," odd, and there is no limit on the number of Observers."]}),"\n",(0,s.jsx)(n.li,{children:"According to past experience, for business that requires high cluster availability (e.g. online service providers), we recommend that you deploy 3 Followers and 1-3 Observers; for offline business, we recommend that you deploy 1 Follower and 1-3 Observers."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Usually we recommend 10 to 100 machines to give full play to Doris' performance (deploy FE on 3 of them (HA) and BE on the rest)."})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"The performance of Doris is positively correlated with the number of nodes and their configuration. With a minimum of four machines (one FE, three BEs; hybrid deployment of one BE and one Observer FE to provide metadata backup) and relatively low configuration, Doris can still run smoothly."})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"In hybrid deployment of FE and BE, you might need to be watchful for resource competition and ensure that the metadata catalogue and data catalogue belong to different disks."})}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"broker-deployment",children:"Broker Deployment"}),"\n",(0,s.jsx)(n.p,{children:"Broker is a process for accessing external data sources, such as hdfs. Usually, deploying one broker instance on each machine should be enough."}),"\n",(0,s.jsx)(n.h4,{id:"network-requirements",children:"Network Requirements"}),"\n",(0,s.jsx)(n.p,{children:"Doris instances communicate directly over the network. The following table shows all required ports."}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Instance Name"}),(0,s.jsx)(n.th,{children:"Port Name"}),(0,s.jsx)(n.th,{children:"Default Port"}),(0,s.jsx)(n.th,{children:"Communication Direction"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"BE"}),(0,s.jsx)(n.td,{children:"be_port"}),(0,s.jsx)(n.td,{children:"9060"}),(0,s.jsx)(n.td,{children:"FE --\x3e BE"}),(0,s.jsx)(n.td,{children:"Thrift server port on BE for receiving requests from FE"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"BE"}),(0,s.jsx)(n.td,{children:"webserver_port"}),(0,s.jsx)(n.td,{children:"8040"}),(0,s.jsx)(n.td,{children:"BE <--\x3e BE"}),(0,s.jsx)(n.td,{children:"HTTP server port on BE"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"BE"}),(0,s.jsx)(n.td,{children:"heartbeat_service_port"}),(0,s.jsx)(n.td,{children:"9050"}),(0,s.jsx)(n.td,{children:"FE --\x3e BE"}),(0,s.jsx)(n.td,{children:"Heart beat service port (thrift) on BE, used to receive heartbeat from FE"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"BE"}),(0,s.jsx)(n.td,{children:"brpc_port"}),(0,s.jsx)(n.td,{children:"8060"}),(0,s.jsx)(n.td,{children:"FE <--\x3e BE, BE <--\x3e BE"}),(0,s.jsx)(n.td,{children:"BRPC port on BE for communication between BEs"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"FE"}),(0,s.jsx)(n.td,{children:"http_port"}),(0,s.jsx)(n.td,{children:"8030"}),(0,s.jsx)(n.td,{children:"FE <--\x3e FE, user <--\x3e FE"}),(0,s.jsx)(n.td,{children:"HTTP server port on FE"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"FE"}),(0,s.jsx)(n.td,{children:"rpc_port"}),(0,s.jsx)(n.td,{children:"9020"}),(0,s.jsx)(n.td,{children:"BE --\x3e FE, FE <--\x3e FE"}),(0,s.jsx)(n.td,{children:"Thrift server port on FE; The configurations of each FE should be consistent."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"FE"}),(0,s.jsx)(n.td,{children:"query_port"}),(0,s.jsx)(n.td,{children:"9030"}),(0,s.jsx)(n.td,{children:"user <--\x3e FE"}),(0,s.jsx)(n.td,{children:"MySQL server port on FE"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"FE"}),(0,s.jsx)(n.td,{children:"edit_log_port"}),(0,s.jsx)(n.td,{children:"9010"}),(0,s.jsx)(n.td,{children:"FE <--\x3e FE"}),(0,s.jsx)(n.td,{children:"Port on FE for BDBJE communication"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Broker"}),(0,s.jsx)(n.td,{children:"broker ipc_port"}),(0,s.jsx)(n.td,{children:"8000"}),(0,s.jsx)(n.td,{children:"FE --\x3e Broker, BE --\x3e Broker"}),(0,s.jsx)(n.td,{children:"Thrift server port on Broker for receiving requests"})]})]})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Note:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"When deploying multiple FE instances, make sure that the http_port configuration of each FE is consistent."}),"\n",(0,s.jsx)(n.li,{children:"Make sure that each port has access in its proper direction before deployment."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"ip-binding",children:"IP Binding"}),"\n",(0,s.jsxs)(n.p,{children:["Because of the existence of multiple network cards, or the existence of virtual network cards caused by the installation of docker and other environments, the same host may have multiple different IPs. Currently Doris does not automatically identify available IPs. So when you encounter multiple IPs on the deployment host, you must specify the correct IP via the ",(0,s.jsx)(n.code,{children:"priority_networks"})," configuration item."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"priority_networks"})," is a configuration item that both FE and BE have. It needs to be written in fe.conf and be.conf. It is used to tell the process which IP should be bound when FE or BE starts. Examples are as follows:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"priority_networks=10.1.3.0/24"})}),"\n",(0,s.jsxs)(n.p,{children:["This is a representation of ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing",children:"CIDR"}),". FE or BE will find the matching IP based on this configuration item as their own local IP."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": Configuring ",(0,s.jsx)(n.code,{children:"priority_networks"})," and starting FE or BE only ensure the correct IP binding of FE or BE.  You also need to specify the same IP in ADD BACKEND or ADD FRONTEND statements, otherwise the cluster cannot be created. For example:"]}),"\n",(0,s.jsxs)(n.p,{children:["BE is configured as ",(0,s.jsx)(n.code,{children:"priority_networks = 10.1.3.0/24'."}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["If you use the following IP in the ADD BACKEND statement: ",(0,s.jsx)(n.code,{children:'ALTER SYSTEM ADD BACKEND "192.168.0.1:9050";'})]}),"\n",(0,s.jsx)(n.p,{children:"Then FE and BE will not be able to communicate properly."}),"\n",(0,s.jsx)(n.p,{children:"At this point, you must DROP the wrong BE configuration and use the correct IP to perform ADD BACKEND."}),"\n",(0,s.jsx)(n.p,{children:"The same works for FE."}),"\n",(0,s.jsxs)(n.p,{children:["Broker currently does not have the ",(0,s.jsx)(n.code,{children:"priority_networks"})," configuration item, nor does it need. Broker's services are bound to 0.0.0.0 by default. You can simply execute the correct accessible BROKER IP when using ADD BROKER."]}),"\n",(0,s.jsx)(n.h4,{id:"table-name-case-sensitivity",children:"Table Name Case Sensitivity"}),"\n",(0,s.jsx)(n.p,{children:"By default, table names in Doris are case-sensitive. If you need to change that, you may do it before cluster initialization. The table name case sensitivity cannot be changed after cluster initialization is completed."}),"\n",(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.code,{children:"lower_case_table_names"})," section in ",(0,s.jsx)(n.a,{href:"/docs/1.2/advanced/variables",children:"Variables"})," for details."]}),"\n",(0,s.jsx)(n.h2,{id:"cluster-deployment",children:"Cluster Deployment"}),"\n",(0,s.jsx)(n.h3,{id:"manual-deployment",children:"Manual Deployment"}),"\n",(0,s.jsx)(n.h4,{id:"deploy-fe",children:"Deploy FE"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Copy the FE deployment file into the specified node"}),"\n",(0,s.jsx)(n.p,{children:"Find the Fe folder under the output generated by source code compilation, copy it into the specified deployment path of FE nodes and put it the corresponding directory."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Configure FE"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The configuration file is conf/fe.conf. Note: ",(0,s.jsx)(n.code,{children:"meta_dir"})," indicates the metadata storage location. The default value is ",(0,s.jsx)(n.code,{children:"${DORIS_HOME}/doris-meta"}),". The directory needs to be ",(0,s.jsx)(n.strong,{children:"created manually"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Note: For production environments, it is better not to put the directory under the Doris installation directory but in a separate disk (SSD would be the best); for test and development environments, you may use the default configuration."})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The default maximum Java heap memory of JAVA_OPTS in fe.conf is 4GB. For production environments, we recommend that it be adjusted to more than 8G."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Start FE"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"bin/start_fe.sh --daemon"})}),"\n",(0,s.jsx)(n.p,{children:"The FE process starts and enters the background for execution. Logs are stored in the log/ directory by default. If startup fails, you can view error messages by checking out log/fe.log or log/fe.out."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["For details about deployment of multiple FEs, see the ",(0,s.jsx)(n.a,{href:"https://doris.apache.org/docs/dev/admin-manual/cluster-management/elastic-expansion/",children:"FE scaling"})," section."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"deploy-be",children:"Deploy BE"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Copy the BE deployment file into all nodes that are to deploy BE on"}),"\n",(0,s.jsx)(n.p,{children:"Find the BE folder under the output generated by source code compilation, copy it into to the specified deployment paths of the BE nodes."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Modify all BE configurations"}),"\n",(0,s.jsxs)(n.p,{children:["Modify be/conf/be.conf, which mainly involves configuring ",(0,s.jsx)(n.code,{children:"storage_root_path"}),": data storage directory. By default, under be/storage, the directory needs to be ",(0,s.jsx)(n.strong,{children:"created manually"}),". Use ",(0,s.jsx)(n.code,{children:";"})," to separate multiple paths (do not add ",(0,s.jsx)(n.code,{children:";"})," after the last directory)."]}),"\n",(0,s.jsxs)(n.p,{children:["You may specify the directory storage medium in the path: HDD or SSD. You may also add capacility limit to the end of every path and use ",(0,s.jsx)(n.code,{children:","})," for separation. Unless you use a mix of SSD and HDD disks, you do not need to follow the configuration methods in Example 1 and Example 2 below, but only need to specify the storage directory; you do not need to modify the default storage medium configuration of FE, either."]}),"\n",(0,s.jsx)(n.p,{children:"Example 1:"}),"\n",(0,s.jsxs)(n.p,{children:["Note: For SSD disks, add ",(0,s.jsx)(n.code,{children:".SSD"})," to the end of the directory; for HDD disks, add ",(0,s.jsx)(n.code,{children:".HDD"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"storage_root_path=/home/disk1/doris.HDD;/home/disk2/doris.SSD;/home/disk2/doris"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"1./home/disk1/doris.HDD: The storage medium is HDD;"}),"\n",(0,s.jsx)(n.li,{children:"2./home/disk2/doris.SSD: The storage medium is SSD;"}),"\n",(0,s.jsx)(n.li,{children:"3./home/disk2/doris: The storage medium is HDD (default)."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example 2:"}),"\n",(0,s.jsxs)(n.p,{children:["Note: You do not need to add the ",(0,s.jsx)(n.code,{children:".SSD"})," or ",(0,s.jsx)(n.code,{children:".HDD"})," suffix, but to specify the medium in the ",(0,s.jsx)(n.code,{children:"storage_root_path"})," parameter"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"storage_root_path=/home/disk1/doris,medium:HDD;/home/disk2/doris,medium:SSD"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"1./home/disk1/doris,medium:HDD  :  The storage medium is HDD;"}),"\n",(0,s.jsx)(n.li,{children:"2./home/disk2/doris,medium:SSD  :  The storage medium is SSD."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"BE webserver_port configuration"}),"\n",(0,s.jsxs)(n.p,{children:["If the BE component is installed in hadoop cluster, you need to change configuration ",(0,s.jsx)(n.code,{children:"webserver_port=8040"})," to avoid port used."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Set JAVA_HOME environment variable"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.version,{since:"1.2.0"}),(0,s.jsx)(n.br,{}),"\nJava UDF is supported since version 1.2, so BEs are dependent on the Java environment. It is necessary to set the ",(0,s.jsx)(n.code,{children:"JAVA_HOME"})," environment variable before starting. You can also do this by adding ",(0,s.jsx)(n.code,{children:"export JAVA_HOME=your_java_home_path"})," to the first line of the ",(0,s.jsx)(n.code,{children:"start_be.sh"})," startup script."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Install Java UDF"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.version,{since:"1.2.0"}),"\nBecause Java UDF is supported since version 1.2, you need to download the JAR package of Java UDF from the official website and put them under the lib directory of BE, otherwise it may fail to start."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Add all BE nodes to FE"}),"\n",(0,s.jsxs)(n.p,{children:["BE nodes need to be added in FE before they can join the cluster. You can use mysql-client (",(0,s.jsx)(n.a,{href:"https://dev.mysql.com/downloads/mysql/5.7.html",children:"Download MySQL 5.7"}),") to connect to FE:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"./mysql-client -h fe_host -P query_port -uroot"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"fe_host"})," is the node IP where FE is located;  ",(0,s.jsx)(n.code,{children:"query_port"})," is in fe/conf/fe.conf; the root account is used by default and no password is required in login."]}),"\n",(0,s.jsx)(n.p,{children:"After login, execute the following command to add all the BE host and heartbeat service port:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'ALTER SYSTEM ADD BACKEND "be_host:heartbeat_service_port";'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"be_host"})," is the node IP where BE is located; ",(0,s.jsx)(n.code,{children:"heartbeat_service_port"})," is in be/conf/be.conf."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Start BE"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"bin/start_be.sh --daemon"})}),"\n",(0,s.jsx)(n.p,{children:"The BE process will start and go into the background for execution. Logs are stored in be/log/directory by default. If startup fails, you can view error messages by checking out be/log/be.log or be/log/be.out."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"View BE status"}),"\n",(0,s.jsxs)(n.p,{children:["Connect to FE using mysql-client and execute ",(0,s.jsx)(n.code,{children:"SHOW PROC '/backends'; "})," to view BE operation status. If everything goes well, the ",(0,s.jsx)(n.code,{children:"isAlive"}),"column should be ",(0,s.jsx)(n.code,{children:"true"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"optional-fs_broker-deployment",children:"(Optional) FS_Broker Deployment"}),"\n",(0,s.jsx)(n.p,{children:"Broker is deployed as a plug-in, which is independent of Doris. If you need to import data from a third-party storage system, you need to deploy the corresponding Broker. By default, Doris provides fs_broker for HDFS reading and object storage (supporting S3 protocol). fs_broker is stateless and we recommend that you deploy a Broker for each FE and BE node."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Copy the corresponding Broker directory in the output directory of the source fs_broker to all the nodes that need to be deployed. It is recommended to keep the Broker directory on the same level as the BE or FE directories."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Modify the corresponding Broker configuration"}),"\n",(0,s.jsx)(n.p,{children:"You can modify the configuration in the corresponding broker/conf/directory configuration file."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Start Broker"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"bin/start_broker.sh --daemon"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Add Broker"}),"\n",(0,s.jsx)(n.p,{children:"To let Doris FE and BE know which nodes Broker is on, add a list of Broker nodes by SQL command."}),"\n",(0,s.jsx)(n.p,{children:"Use mysql-client to connect the FE started, and execute the following commands:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'ALTER SYSTEM ADD BROKER broker_name "broker_host1:broker_ipc_port1","broker_host2:broker_ipc_port2",...;'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"broker\\_host"})," is the Broker node ip;  ",(0,s.jsx)(n.code,{children:"broker_ipc_port"})," is in conf/apache_hdfs_broker.conf in the Broker configuration file."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"View Broker status"}),"\n",(0,s.jsxs)(n.p,{children:["Connect any started FE using mysql-client and execute the following command to view Broker status: ",(0,s.jsx)(n.code,{children:"SHOW PROC '/brokers';"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsxs)(n.strong,{children:["Note: In production environments, daemons should be used to start all instances to ensure that processes are automatically pulled up after they exit, such as ",(0,s.jsx)(n.a,{href:"http://supervisord.org/",children:"Supervisor"}),". For daemon startup, in Doris 0.9.0 and previous versions, you need to remove the last ",(0,s.jsx)(n.code,{children:"&"})," symbol in the start_xx.sh scripts"]}),". In Doris 0.10.0 and the subsequent versions, you may just call ",(0,s.jsx)(n.code,{children:"sh start_xx.sh"})," directly to start."]}),"\n",(0,s.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,s.jsx)(n.h3,{id:"process-related-questions",children:"Process-Related Questions"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"How can we know whether the FE process startup succeeds?"}),"\n",(0,s.jsxs)(n.p,{children:["After the FE process starts, metadata is loaded first. Based on the role of FE, you can see ",(0,s.jsx)(n.code,{children:"transfer from UNKNOWN to MASTER/FOLLOWER/OBSERVER"})," in the log. Eventually, you will see the ",(0,s.jsx)(n.code,{children:"thrift server started"})," log and can connect to FE through MySQL client, which indicates that FE started successfully."]}),"\n",(0,s.jsx)(n.p,{children:"You can also check whether the startup was successful by connecting as follows:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"http://fe_host:fe_http_port/api/bootstrap"})}),"\n",(0,s.jsx)(n.p,{children:"If it returns:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'{"status":"OK","msg":"Success"}'})}),"\n",(0,s.jsx)(n.p,{children:"The startup is successful; otherwise, there may be problems."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Note: If you can't see the information of boot failure in fe. log, you may check in fe. out."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"How can we know whether the BE process startup succeeds?"}),"\n",(0,s.jsx)(n.p,{children:"After the BE process starts, if there have been data there before, it might need several minutes for data index loading."}),"\n",(0,s.jsxs)(n.p,{children:["If BE is started for the first time or the BE has not joined any cluster, the BE log will periodically scroll the words ",(0,s.jsx)(n.code,{children:"waiting to receive first heartbeat from frontend"}),", meaning that BE has not received the Master's address through FE's heartbeat and is waiting passively. Such error log will disappear after sending the heartbeat by ADD BACKEND in FE. If the word ",(0,s.jsx)(n.code,{children:"master client', get client from cache failed. host:, port: 0, code: 7"})," appears after receiving the heartbeat, it indicates that FE has successfully connected BE, but BE cannot actively connect FE. You may  need to check the connectivity of rpc_port from BE to FE."]}),"\n",(0,s.jsxs)(n.p,{children:["If BE has been added to the cluster, the heartbeat log from FE will be scrolled every five seconds: ",(0,s.jsx)(n.code,{children:"get heartbeat, host:xx. xx.xx.xx, port:9020, cluster id:xxxxxxx"}),", indicating that the heartbeat is normal."]}),"\n",(0,s.jsxs)(n.p,{children:["Secondly, if the word ",(0,s.jsx)(n.code,{children:"finish report task success. return code: 0"}),"  is scrolled every 10 seconds in the log, that indicates that the BE-to-FE communication is normal."]}),"\n",(0,s.jsxs)(n.p,{children:["Meanwhile, if there is a data query, you will see the rolling logs and the  ",(0,s.jsx)(n.code,{children:"execute time is xxx"})," logs, indicating that BE is started successfully, and the query is normal."]}),"\n",(0,s.jsx)(n.p,{children:"You can also check whether the startup was successful by connecting as follows:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"http://be_host:be_http_port/api/health"})}),"\n",(0,s.jsx)(n.p,{children:"If it returns:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'{"status": "OK","msg": "To Be Added"}'})}),"\n",(0,s.jsx)(n.p,{children:"That means the startup is successful; otherwise, there may be problems."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Note: If you can't see the information of boot failure in be.INFO, you may see it in be.out."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"How can we confirm that the connectivity of FE and BE is normal after building the system?"}),"\n",(0,s.jsxs)(n.p,{children:["Firstly, you need to confirm that FE and BE processes have been started separately and worked normally. Then, you need to confirm that all nodes have been added through ",(0,s.jsx)(n.code,{children:"ADD BACKEND"})," or ",(0,s.jsx)(n.code,{children:"ADD FOLLOWER/OBSERVER"})," statements."]}),"\n",(0,s.jsxs)(n.p,{children:["If the heartbeat is normal, BE logs will show ",(0,s.jsx)(n.code,{children:"get heartbeat, host:xx.xx.xx.xx, port:9020, cluster id:xxxxx"}),"; if the heartbeat fails, you will see ",(0,s.jsx)(n.code,{children:"backend [10001] got Exception: org.apache.thrift.transport.TTransportException"})," in FE's log, or other thrift communication abnormal log, indicating that the heartbeat from FE to 10001 BE fails. Here you need to check the connectivity of the FE to BE host heartbeat port."]}),"\n",(0,s.jsxs)(n.p,{children:["If the BE-to-FE communication is normal, the BE log will display the words ",(0,s.jsx)(n.code,{children:"finish report task success. return code: 0"}),". Otherwise, the words ",(0,s.jsx)(n.code,{children:"master client, get client from cache failed"})," will appear. In this case, you need to check the connectivity of BE to the rpc_port of FE."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"What is the Doris node authentication mechanism?"}),"\n",(0,s.jsxs)(n.p,{children:["In addition to Master FE, the other role nodes (Follower FE, Observer FE, Backend) need to register to the cluster through the ",(0,s.jsx)(n.code,{children:"ALTER SYSTEM ADD"})," statement before joining the cluster."]}),"\n",(0,s.jsx)(n.p,{children:"When Master FE is started for the first time, a cluster_id is generated in the doris-meta/image/VERSION file."}),"\n",(0,s.jsx)(n.p,{children:"When FE joins the cluster for the first time, it first retrieves the file from Master FE. Each subsequent reconnection between FEs (FE reboot) checks whether its cluster ID is the same as that of other existing FEs. If it is not the same, the FE will exit automatically."}),"\n",(0,s.jsxs)(n.p,{children:["When BE first receives the heartbeat of Master FE, it gets the cluster ID from the heartbeat and records it in the ",(0,s.jsx)(n.code,{children:"cluster_id"})," file of the data directory. Each heartbeat after that compares that to the cluster ID sent by FE. If the cluster IDs are not matched, BE will refuse to respond to FE's heartbeat."]}),"\n",(0,s.jsx)(n.p,{children:"The heartbeat also contains Master FE's IP. If the Master FE changes, the new Master FE will send the heartbeat to BE together with its own IP, and BE will update the Master FE IP it saved."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"priority_network"})}),"\n",(0,s.jsxs)(n.p,{children:["priority_network is a configuration item that both FE and BE have. It is used to help FE or BE identify their own IP addresses in the cases of multi-network cards. priority_network uses CIDR notation: ",(0,s.jsx)(n.a,{href:"https://tools.ietf.org/html/rfc4632",children:"RFC 4632"})]}),"\n",(0,s.jsxs)(n.p,{children:["If the connectivity of FE and BE is confirmed to be normal, but timeout still occurs in creating tables, and the FE log shows the error message  ",(0,s.jsx)(n.code,{children:"backend does not find. host:xxxx.xxx.XXXX"}),", this means that there is a problem with the IP address automatically identified by Doris and that the priority_network parameter needs to be set manually."]}),"\n",(0,s.jsxs)(n.p,{children:["The explanation to this error is as follows. When the user adds BE through the ",(0,s.jsx)(n.code,{children:"ADD BACKEND"})," statement, FE recognizes whether the statement specifies hostname or IP. If it is a hostname, FE automatically converts it to an IP address and stores it in the metadata. When BE reports on the completion of the task, it carries its own IP address. If FE finds that the IP address reported by BE is different from that in the metadata, the above error message will show up."]}),"\n",(0,s.jsxs)(n.p,{children:["Solutions to this error: 1) Set ",(0,s.jsx)(n.strong,{children:"priority_network"})," in FE and BE separately. Usually FE and BE are in one network segment, so their priority_network can be set to be the same. 2) Put the correct IP address instead of the hostname in the ",(0,s.jsx)(n.code,{children:"ADD BACKEND"})," statement to prevent FE from getting the wrong IP address."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"What is the number of file descriptors of a BE process?"}),"\n",(0,s.jsxs)(n.p,{children:["The number of file descriptor of a BE process is determined by two parameters: ",(0,s.jsx)(n.code,{children:"min_file_descriptor_number"}),"/",(0,s.jsx)(n.code,{children:"max_file_descriptor_number"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["If it is not in the range [",(0,s.jsx)(n.code,{children:"min_file_descriptor_number"}),", ",(0,s.jsx)(n.code,{children:"max_file_descriptor_number"}),"], error will occurs when starting a BE process. You may use the ulimit command to reset the parameters."]}),"\n",(0,s.jsxs)(n.p,{children:["The default value of ",(0,s.jsx)(n.code,{children:"min_file_descriptor_number"})," is 65536."]}),"\n",(0,s.jsxs)(n.p,{children:["The default value of ",(0,s.jsx)(n.code,{children:"max_file_descriptor_number"})," is 131072."]}),"\n",(0,s.jsxs)(n.p,{children:["For example, the command ",(0,s.jsx)(n.code,{children:"ulimit -n 65536;"})," means to set the number of file descriptors to 65536."]}),"\n",(0,s.jsxs)(n.p,{children:["After starting a BE process, you can use ",(0,s.jsx)(n.strong,{children:"cat /proc/$pid/limits"})," to check the actual number of file descriptors of the process."]}),"\n",(0,s.jsxs)(n.p,{children:["If you have used  ",(0,s.jsx)(n.code,{children:"supervisord"})," and encountered a file descriptor error, you can fix it by modifying  ",(0,s.jsx)(n.code,{children:"minfds"})," in supervisord.conf."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"vim /etc/supervisord.conf\n\nminfds=65535                 ; (min. avail startup file descriptors;default 1024)\n"})}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return d},a:function(){return o}});var r=t(667294);let s={},i=r.createContext(s);function o(e){let n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);