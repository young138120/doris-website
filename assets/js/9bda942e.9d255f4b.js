"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["4559"],{125308:function(e,t,n){n.r(t),n.d(t,{metadata:()=>s,contentTitle:()=>o,default:()=>h,assets:()=>l,toc:()=>d,frontMatter:()=>r});var s=JSON.parse('{"id":"sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-JOB","title":"CREATE-JOB","description":"\x3c!--","source":"@site/docs/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-JOB.md","sourceDirName":"sql-manual/sql-statements/Data-Definition-Statements/Create","slug":"/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-JOB","permalink":"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-JOB","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"CREATE-JOB","language":"en"},"sidebar":"docs","previous":{"title":"CREATE-ASYNC-MATERIALIZED-VIEW","permalink":"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Create/CREATE-ASYNC-MATERIALIZED-VIEW"},"next":{"title":"ALTER-CATALOG","permalink":"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Alter/ALTER-CATALOG"}}'),i=n("785893"),a=n("250065");let r={title:"CREATE-JOB",language:"en"},o=void 0,l={},d=[{value:"CREATE-JOB",id:"create-job",level:2},{value:"Name",id:"name",level:3},{value:"Description",id:"description",level:3},{value:"Job Status",id:"job-status",level:4},{value:"Task status",id:"task-status",level:4},{value:"Permissions",id:"permissions",level:4},{value:"Related Documentation",id:"related-documentation",level:4},{value:"Grammar",id:"grammar",level:3},{value:"Example",id:"example",level:3},{value:"CONFIG",id:"config",level:3},{value:"fe.conf",id:"feconf",level:4},{value:"Best Practice",id:"best-practice",level:3},{value:"Keywords",id:"keywords",level:3}];function c(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"create-job",children:"CREATE-JOB"}),"\n",(0,i.jsx)(t.h3,{id:"name",children:"Name"}),"\n",(0,i.jsxs)(t.admonition,{type:"tip",children:[(0,i.jsx)(t.p,{children:"CREATE JOB"}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"since 2.1"}),"\n"]})]}),"\n",(0,i.jsx)(t.h3,{id:"description",children:"Description"}),"\n",(0,i.jsx)(t.p,{children:"Doris Job is a task that runs according to a predefined schedule, triggering predefined actions at specific times or intervals to help automate certain tasks. In terms of functionality, it is similar to scheduled tasks on operating systems (e.g., cron in Linux, scheduled tasks in Windows).\u21B3"}),"\n",(0,i.jsx)(t.p,{children:"There are two types of Jobs: ONE_TIME and RECURRING. The ONE_TIME type of Job triggers at a specified time point and is mainly used for one-time tasks, while the RECURRING type of Job triggers at specified time intervals and is used for periodically recurring tasks. The RECURRING type of Job can specify a start time and an end time using STARTS\\ENDS. If the start time is not specified, the first execution time is set to the current time plus one scheduling period. If the end time is specified and the task completes execution by reaching the end time (or exceeds it, or the next execution period exceeds the end time), the Job status is updated to FINISHED, and no more Tasks are generated."}),"\n",(0,i.jsx)(t.h4,{id:"job-status",children:"Job Status"}),"\n",(0,i.jsx)(t.p,{children:"A Job has four states (RUNNING, STOPPED, PAUSED, FINISHED), with the initial state being RUNNING. A Job in the RUNNING state generates Tasks based on the specified scheduling period. When a Job completes execution and reaches the end time, the status changes to FINISHED."}),"\n",(0,i.jsx)(t.p,{children:"A Job in the RUNNING state can be paused, which means it will no longer generate Tasks."}),"\n",(0,i.jsx)(t.p,{children:"A Job in the PAUSED state can be resumed by performing the RESUME operation, changing the state to RUNNING."}),"\n",(0,i.jsx)(t.p,{children:"A Job in the STOPPED state is triggered by the user, which cancels the running Job and then deletes it."}),"\n",(0,i.jsx)(t.p,{children:"A Job in the FINISHED state remains in the system for 24 hours and is deleted after that."}),"\n",(0,i.jsx)(t.h4,{id:"task-status",children:"Task status"}),"\n",(0,i.jsx)(t.p,{children:"A Job only describes the job information, and the execution generates Tasks. The Task status can be PENDING, RUNNING, SUCCESS, FAILED, or CANCELED."}),"\n",(0,i.jsx)(t.p,{children:"PENDING indicates that the trigger time has been reached but resources are awaited for running. Once resources are allocated, the status changes to RUNNING. When the execution is successful or fails, the status changes to SUCCESS or FAILED, respectively."}),"\n",(0,i.jsx)(t.p,{children:"CANCELED indicates the cancellation status. The final status of a Task is persisted as SUCCESS or FAILED. Other statuses can be queried while the Task is running, but they become invisible after a restart. Only the latest 100 Task records are retained."}),"\n",(0,i.jsx)(t.h4,{id:"permissions",children:"Permissions"}),"\n",(0,i.jsx)(t.p,{children:"Currently, only users with the ADMIN role can perform this operation."}),"\n",(0,i.jsx)(t.h4,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Alter/PAUSE-JOB",children:"PAUSE-JOB"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Alter/RESUME-JOB",children:"RESUME-JOB"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Drop/DROP-JOB",children:"DROP-JOB"})}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"/docs/dev/sql-manual/sql-functions/table-valued-functions/jobs",children:"VIEW-JOB"}),","]}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"/docs/dev/sql-manual/sql-functions/table-valued-functions/tasks",children:"VIEW-TASKS"})}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"grammar",children:"Grammar"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"CREATE\n     job\n     job_name\n     ON SCHEDULE schedule\n     [COMMENT 'string']\n     DO sql_body;\n\nschedule: {\n    AT timestamp\n    | EVERY interval\n     [STARTS timestamp]\n     [ENDS timestamp ]\n}\n\ninterval:\n     quantity { DAY | HOUR | MINUTE |\n               WEEK | SECOND }\n"})}),"\n",(0,i.jsx)(t.p,{children:"A valid Job statement must contain the following"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["The keyword CREATE JOB plus the job name, which uniquely identifies the event within a database. The job name must be globally unique, and if a JOB with the same name already exists, an error will be reported. We reserve the inner_ prefix for internal use, so users cannot create names starting with ",(0,i.jsx)(t.em,{children:(0,i.jsx)(t.strong,{children:"inner_"})}),"."]}),"\n",(0,i.jsx)(t.li,{children:"The ON SCHEDULE clause, which specifies the type of Job and when and how often to trigger it."}),"\n",(0,i.jsx)(t.li,{children:"The DO clause, which specifies the actions that need to be performed when the Job is triggered."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Here is a minimal example:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"CREATE JOB my_job ON SCHEDULE EVERY 1 MINUTE DO INSERT INTO db1.tbl1 SELECT * FROM db2.tbl2;\n"})}),"\n",(0,i.jsx)(t.p,{children:"This statement means to create a job named my_job to be executed every minute, and the operation performed is to import the data in db2.tbl2 into db1.tbl1."}),"\n",(0,i.jsx)(t.p,{children:"The SCHEDULE statement is used to define the execution time, frequency and duration of the job, which can specify a one-time job or a periodic job."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"AT timestamp"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Format: 'YYYY-MM-DD HH:MM:SS'. Used for one-time events, it specifies that the event should only be executed once at the given date and time. Once the execution is complete, the Job status changes to FINISHED."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"EVERY"}),"\n",(0,i.jsx)(t.p,{children:"Indicates that the operation is repeated periodically, which specifies the execution frequency of the job. After the keyword, a time interval should be specified, which can be days, hours, minutes, seconds, and weeks."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"interval"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Used to specify the Job execution frequency, which can be ",(0,i.jsx)(t.code,{children:"day"}),", ",(0,i.jsx)(t.code,{children:"hour"}),", ",(0,i.jsx)(t.code,{children:"minute"}),", or ",(0,i.jsx)(t.code,{children:"week"}),". For example, 1 ",(0,i.jsx)(t.code,{children:"DAY"})," means the Job will run once every day, 1 ",(0,i.jsx)(t.code,{children:"HOUR"})," means once every hour, 1 ",(0,i.jsx)(t.code,{children:"MINUTE"})," means once every minute, and `1 The CREATE JOB statement is used to create a job in a database. A job is a task that can be scheduled to run at specific times or intervals to automate certain actions."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"STARTS timestamp(optional)"}),"\n",(0,i.jsx)(t.p,{children:"Format: 'YYYY-MM-DD HH:MM:SS'. It is used to specify the start time of the job. If not specified, the job starts executing from the next occurrence based on the current time. The start time must be greater than the current time."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"ENDS timestamp(optional)"}),"\n",(0,i.jsx)(t.p,{children:"Format: 'YYYY-MM-DD HH:MM:SS'. It is used to specify the end time of the job. If not specified, it means the job executes indefinitely. The end date must be greater than the current time. If a start time (\u21B3STARTS) is specified, the end time must be greater than the start time."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"DO"}),"\n",(0,i.jsxs)(t.p,{children:["It is used to specify the operation that needs to be performed when the job is triggered. Currently, all ",(0,i.jsx)(t.em,{children:(0,i.jsx)(t.strong,{children:"INSERT"})})," operations are supported. We will support more operations in the future."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"example",children:"Example"}),"\n",(0,i.jsx)(t.p,{children:"Create a one-time job, which will be executed once at 2020-01-01 00:00:00, and the operation performed is to import the data in db2.tbl2 into db1.tbl1."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"\nCREATE JOB my_job ON SCHEDULE AT '2020-01-01 00:00:00' DO INSERT INTO db1.tbl1 SELECT * FROM db2.tbl2;\n\n"})}),"\n",(0,i.jsx)(t.p,{children:"Create a periodic Job, which will start to execute at 2020-01-01 00:00:00, once a day, and the operation is to import the data in db2.tbl2 into db1.tbl1."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"CREATE JOB my_job ON SCHEDULE EVERY 1 DAY STARTS '2020-01-01 00:00:00' DO INSERT INTO db1.tbl1 SELECT * FROM db2.tbl2 WHERE create_time >= days_add(now(),-1);\n"})}),"\n",(0,i.jsx)(t.p,{children:"Create a periodic Job, which will start to execute at 2020-01-01 00:00:00, and execute once a day. The operation performed is to import the data in db2.tbl2 into db1.tbl1. This Job will be executed in 2020 Ends at -01-01 00:10:00."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"CREATE JOB my_job ON SCHEDULE EVERY 1 DAY STARTS '2020-01-01 00:00:00' ENDS '2020-01-01 00:10:00' DO INSERT INTO db1.tbl1 SELECT * FROM db2.tbl2 create_time >= days_add (now(),-1);\n"})}),"\n",(0,i.jsx)(t.h3,{id:"config",children:"CONFIG"}),"\n",(0,i.jsx)(t.h4,{id:"feconf",children:"fe.conf"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"job_dispatch_timer_job_thread_num: Number of threads used for dispatching scheduled tasks. Default value is 2. If there are a large number of periodically executed tasks, this parameter can be increased."}),"\n",(0,i.jsx)(t.li,{children:"job_dispatch_timer_job_queue_size: Size of the queue used for storing scheduled tasks when there is task accumulation. Default value is 1024. If there are a large number of tasks triggered at the same time, this parameter can be increased. Otherwise, the queue may become full and submitting tasks will be blocked, causing subsequent tasks to be unable to submit."}),"\n",(0,i.jsx)(t.li,{children:"finished_job_cleanup_threshold_time_hour: Time threshold, in hours, for cleaning up completed tasks. Default value is 24 hours."}),"\n",(0,i.jsx)(t.li,{children:"job_insert_task_consumer_thread_num: Number of threads used for executing Insert tasks. The value should be greater than 0, otherwise the default value is 5."}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"best-practice",children:"Best Practice"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Properly manage Jobs to avoid triggering a large number of Jobs simultaneously, which can lead to task accumulation and affect the normal operation of the system."}),"\n",(0,i.jsx)(t.li,{children:"Set the execution interval of tasks within a reasonable range, ensuring that it is at least greater than the task execution time."}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"keywords",children:"Keywords"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"CREATE, JOB, SCHEDULE\n"})})]})}function h(e={}){let{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return o},a:function(){return r}});var s=n(667294);let i={},a=s.createContext(i);function r(e){let t=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);