"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["933021"],{361262:function(e,t,n){n.r(t),n.d(t,{metadata:()=>a,contentTitle:()=>r,default:()=>h,assets:()=>o,toc:()=>d,frontMatter:()=>s});var a=JSON.parse('{"id":"sql-manual/sql-statements/Data-Definition-Statements/Alter/ALTER-TABLE-REPLACE","title":"ALTER-TABLE-REPLACE","description":"\x3c!--","source":"@site/docs/sql-manual/sql-statements/Data-Definition-Statements/Alter/ALTER-TABLE-REPLACE.md","sourceDirName":"sql-manual/sql-statements/Data-Definition-Statements/Alter","slug":"/sql-manual/sql-statements/Data-Definition-Statements/Alter/ALTER-TABLE-REPLACE","permalink":"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Alter/ALTER-TABLE-REPLACE","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"ALTER-TABLE-REPLACE","language":"en"},"sidebar":"docs","previous":{"title":"ALTER-TABLE-RENAME","permalink":"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Alter/ALTER-TABLE-RENAME"},"next":{"title":"ALTER-TABLE-PROPERTY","permalink":"/docs/dev/sql-manual/sql-statements/Data-Definition-Statements/Alter/ALTER-TABLE-PROPERTY"}}'),l=n("785893"),i=n("250065");let s={title:"ALTER-TABLE-REPLACE",language:"en"},r=void 0,o={},d=[{value:"ALTER-TABLE-REPLACE",id:"alter-table-replace",level:2},{value:"Name",id:"name",level:3},{value:"Description",id:"description",level:3},{value:"Theory",id:"theory",level:4},{value:"Notice",id:"notice",level:4},{value:"Example",id:"example",level:3},{value:"Keywords",id:"keywords",level:3},{value:"Best Practice",id:"best-practice",level:3}];function c(e){let t={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.h2,{id:"alter-table-replace",children:"ALTER-TABLE-REPLACE"}),"\n",(0,l.jsx)(t.h3,{id:"name",children:"Name"}),"\n",(0,l.jsx)(t.p,{children:"ALTER TABLE REPLACE"}),"\n",(0,l.jsx)(t.h3,{id:"description",children:"Description"}),"\n",(0,l.jsx)(t.p,{children:"Atomic substitution of two tables. This operation applies only to OLAP tables."}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:"ALTER TABLE [db.]tbl1 REPLACE WITH TABLE tbl2\n[PROPERTIES('swap' = 'true')] FORCE?;\n"})}),"\n",(0,l.jsx)(t.p,{children:"Replace table tbl1 with table tbl2."}),"\n",(0,l.jsxs)(t.p,{children:["If the ",(0,l.jsx)(t.code,{children:"swap"})," parameter is ",(0,l.jsx)(t.code,{children:"true"}),", the data in the table named ",(0,l.jsx)(t.code,{children:"tbl1"})," will be the data in the original table named ",(0,l.jsx)(t.code,{children:"tbl2"})," after the replacement. The data in the table named ",(0,l.jsx)(t.code,{children:"tbl2"})," is the data in the original ",(0,l.jsx)(t.code,{children:"tbl1"})," table. That is, two tables of data have been swapped."]}),"\n",(0,l.jsxs)(t.p,{children:["If the ",(0,l.jsx)(t.code,{children:"swap"})," parameter is ",(0,l.jsx)(t.code,{children:"false"}),", the data in the ",(0,l.jsx)(t.code,{children:"tbl1"})," table will be the data in the ",(0,l.jsx)(t.code,{children:"tbl2"})," table after the replacement. The table named ",(0,l.jsx)(t.code,{children:"tbl2"})," is deleted."]}),"\n",(0,l.jsx)(t.h4,{id:"theory",children:"Theory"}),"\n",(0,l.jsx)(t.p,{children:"The replace table function actually turns the following set of operations into an atomic operation."}),"\n",(0,l.jsxs)(t.p,{children:["If you want to replace table A with table B and ",(0,l.jsx)(t.code,{children:"swap"})," is ",(0,l.jsx)(t.code,{children:"true"}),", do the following:"]}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsx)(t.li,{children:"Rename table B as table A."}),"\n",(0,l.jsx)(t.li,{children:"Rename table A as table B."}),"\n"]}),"\n",(0,l.jsxs)(t.p,{children:["If ",(0,l.jsx)(t.code,{children:"swap"})," is ",(0,l.jsx)(t.code,{children:"false"}),", do as follows:"]}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsx)(t.li,{children:"Delete table A."}),"\n",(0,l.jsx)(t.li,{children:"Rename table B as table A."}),"\n"]}),"\n",(0,l.jsx)(t.h4,{id:"notice",children:"Notice"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["The default ",(0,l.jsx)(t.code,{children:"swap"})," parameter is ",(0,l.jsx)(t.code,{children:"true"}),". That is, a table replacement operation is equivalent to an exchange of data between two tables."]}),"\n",(0,l.jsxs)(t.li,{children:["If the ",(0,l.jsx)(t.code,{children:"swap"})," parameter is set to false, for a period of time, the replaced table (table A) can be recovered through the RECOVER statement. See ",(0,l.jsx)(t.a,{href:"../../../../sql-manual/sql-statements/Database-Administration-Statements/RECOVER",children:"RECOVER"})," statement for details. If you execute command with FORCE, the table will be deleted directly and cannot be recovered, this operation is generally not recommended."]}),"\n",(0,l.jsx)(t.li,{children:"The replacement operation can only occur between two OLAP tables and does not check whether the table structure of the two tables is consistent."}),"\n",(0,l.jsx)(t.li,{children:"The original permission Settings are not changed. Because the permission check is based on the table name."}),"\n"]}),"\n",(0,l.jsx)(t.h3,{id:"example",children:"Example"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["Atomic swap ",(0,l.jsx)(t.code,{children:"tbl1"})," with ",(0,l.jsx)(t.code,{children:"tbl2"})," without dropping any tables(Note: if you delete it, you actually delete tbl1 and rename tbl2 to tbl1.)"]}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:"ALTER TABLE tbl1 REPLACE WITH TABLE tbl2;\n"})}),"\n",(0,l.jsx)(t.p,{children:"or"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:"ALTER TABLE tbl1 REPLACE WITH TABLE tbl2 PROPERTIES('swap' = 'true');\n"})}),"\n",(0,l.jsxs)(t.ol,{start:"2",children:["\n",(0,l.jsxs)(t.li,{children:["Atomic swap ",(0,l.jsx)(t.code,{children:"tbl1"})," with ",(0,l.jsx)(t.code,{children:"tbl2"})," and deleting the ",(0,l.jsx)(t.code,{children:"tbl2"})," table(Keep ",(0,l.jsx)(t.code,{children:"tbl1"})," and the data of the original ",(0,l.jsx)(t.code,{children:"tbl2"}),")"]}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-sql",children:"ALTER TABLE tbl1 REPLACE WITH TABLE tbl2 PROPERTIES('swap' = 'false');\n"})}),"\n",(0,l.jsx)(t.p,{children:"This case data in tb1 data will moved to recycle-bin and can be recovered using recover statement.\nIf you execute command with FORCE, the table data (tb1) will be deleted directly and cannot be recovered, this operation is generally not recommended."}),"\n",(0,l.jsx)(t.h3,{id:"keywords",children:"Keywords"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-text",children:"ALTER, TABLE, REPLACE, ALTER TABLE\n"})}),"\n",(0,l.jsx)(t.h3,{id:"best-practice",children:"Best Practice"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsx)(t.li,{children:"Atomic overlay write operations"}),"\n"]}),"\n",(0,l.jsxs)(t.p,{children:["In some cases, the user wants to be able to rewrite the data of a certain table, but if the data is deleted first and then imported, the data cannot be viewed for a period of time in between. At this time, the user can first use the ",(0,l.jsx)(t.code,{children:"CREATE TABLE LIKE"})," statement to create a new table with the same structure, import the new data into the new table, and use the replacement operation to atomically replace the old table to achieve the goal. Atomic overwrite write operations at the partition level, see ",(0,l.jsx)(t.a,{href:"../../../../advanced/partition/table-temp-partition.md",children:"temp partition documentation"}),"."]})]})}function h(e={}){let{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return r},a:function(){return s}});var a=n(667294);let l={},i=a.createContext(l);function s(e){let t=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);